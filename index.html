<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>åŒ—æµ·é“ã®æ—…</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <link rel="preload" href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;600&display=swap" as="style">
  <link rel="apple-touch-icon" href="images/MeowTrip.png">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600&display=swap">




  <meta name="apple-mobile-web-app-title" content="åŒ—æµ·é“ã®æ—…">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <style>
	

	html {
		margin: 0;
		padding: 0;
		height: 100%;}
	
    body {
		margin: 0;
		background: #F6F9FC;
		font-family:  "Inter","Noto Sans JP"; 
		color: #444;
		height: 100%;}

	body.exchange-mode {
		margin: 0;
		background-color: #FAFAF7;    /* ä½ è¦æ”¹ä»€éº¼éƒ½å¯ä»¥ */
		font-family: "Inter", "Noto Sans JP"; 
		color: #444;/* æˆ–æ˜¯ 100vhã€120vh éƒ½èƒ½ç”¨ */
		padding-bottom: 0px;}


	:root{
		  --topbar-h: 0px;
		  --bottom-nav-h: 0px;
		}

	
    hr{
		width: 100%;
		height: 0.5px;
		border: 0;
		margin: 2rem auto;
		margin-bottom:1rem;
		background-color: #e3e3e3;}

	.ticket-divider{
		width: 100%;
    	height: 1px;
    	border: 0;
    	background-color: #e3e3e3;}
	  
	.container {
		padding: 0 20px;
		max-width: 600px;
		margin: 0 auto;
		padding-top: 65px;
		position: relative;
		background-color: #F6F9FC;
		
		padding-bottom: calc(var(--bottom-nav-h) + env(safe-area-inset-bottom));}

    .day-tabs {
		display: flex;
		gap: 10px;
		border-bottom: 1px solid #e0e0e0;
		margin-bottom: 20px;
		padding-bottom: 6px;
		min-width: max-content;
		margin-top: 0.5rem;}

    .day-tab {
		background: none;
		border: none;
		font-size: 16px;
		color: #999;
		cursor: pointer;
		position: relative;
		transition: color 0.2s ease;
		white-space: nowrap;
		flex-shrink: 0;
		padding: 5px 17px;
		scroll-snap-align: start;}

	button{
		font-family:  "Inter","Noto Sans JP"; 
	}

	
	.day-tab:hover {
		color: #3A7AFE;}

    .day-tab.active {
		color: #3A7AFE;
		font-weight: 600;}

    .day-tab.active::after {
		content: "";
		position: absolute;
		bottom: -7px;
		left: 0;
      	width: 100%;
      	height: 3px;
      	background: #3A7AFE;
      	border-radius: 1px;}
		
	.day-section {
		margin-top: 0.3rem;
		display: none;
		opacity: 1;}

    .day-label {
		font-size: 14px;
		color: #999;
		margin-bottom: 0.7rem;
		padding-left: 0.3rem;
		letter-spacing: 1.2px;
		pointer-events: none;}

    .activity-card {
		display: flex;
		align-items: center;
		background: #fff;
		border-radius: 12px;
		box-shadow:0 0px 3px rgb(0 0 0 / 10%);
		padding: 7px;
		margin-bottom: 12px;
		transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;}

    .activity-card:hover {
		transform: translateY(-2px);
		box-shadow: 0 0px 5px rgb(0 0 0 / 10%);
		background: #fdfdfc;}

    .activity-card img {
		width: 115px;
		height:115px;
		border-radius: 7px;
		object-fit: cover;
		margin-right: 15px;
		background: #ddd;}

    .info {
		margin-left:0.3rem;
		flex: 1;
		display: flex;
		flex-direction: column;}

    .title {
		font-size: 20px;
		font-weight: 600;
		color: #333;}

	.titlep {
		font-size: 22px;
		font-weight: 600;
		color: #333;}

    .time {
		font-size: 18px;
		color: #a87f30;
		margin-bottom: 5px;}

    .note {
		font-size: 15px;
		color: #999;
		letter-spacing: 0.5px;}

    .transport-info {
		display: flex;
		align-items: flex-end;
		gap: 6px;
		font-size: 14px;
		color: #999;
		margin: 15px 0 15px 40px;
		position: relative;
		letter-spacing: 1px;
		align-items: center;}

    .transport-info::before {
		content: "";
		position: absolute;
		left: -20px;
		top: -8px;
		bottom: -8px;
		width: 2px;
		background: repeating-linear-gradient(to bottom,#ccc,#ccc 2px,transparent 2px,transparent 5px);}

    a {
		text-decoration: none;
		display: block;}

	.day-tabs-wrapper {
		position: relative;}

	.day-tabs-scroll {
		overflow-x: auto;
		-webkit-overflow-scrolling: touch; /* iOS æ…£æ€§æ»¾å‹• */
		scroll-behavior: auto; /* å°æ‰‹æŒ‡æ»‘å‹•ç„¡æ•ˆï¼Œå¯çœç•¥ */
		touch-action: pan-x; /* æ˜ç¢ºå…è¨±æ°´å¹³æ»‘å‹• */
		scroll-snap-type: x mandatory;}
		
	.day-tabs-scroll::-webkit-scrollbar {
		display: none;}
	
	
	.day-tabs-arrow {
		position: absolute;
		top: 0;
		bottom: 0;
		width: 30px;
		display: flex;
		align-items: center;
		justify-content: center;
		color: #cccccc00;
		font-size: 16px;
		pointer-events: none;
		z-index: 1;
		opacity: 0;
		transition: opacity 0.3s ease;}
	
	.day-tabs-arrow.left {
		left: 0;}
	
	.day-tabs-arrow.right {
		right: 0;}
		
	.day-tab::after {
		transition: all 0.3s ease;}
	
	.scroll-top-button {
		position: fixed;
	    bottom: 120px;
	    right: 19px;
	    font-size: 28px;
	    border: 1px solid #3a7afe;
	    border-radius: 50px;
	    background-color: #ffffffa8;
	    color: #3a7afe;
	    opacity: 0;
	    pointer-events: none;
	    padding: 10px;
	    transition: 0.3s ease;
	    cursor: pointer;
	    transition: opacity 0.3s ease, visibility 0.3s ease;
	    justify-content: center;
	    display: inline-flex;
	    align-items: center;
	    justify-content: center;
		max-width: max-content;
	    white-space: nowrap;
	    z-index: 1000;}
		  
	
	
	
	.scroll-top-button.show {
		opacity: 1;
	  	visibility: visible;
	  	pointer-events: auto;}
		
	
	/* é¡¯ç¤ºæŒ‰éˆ•çš„æ¨£å¼ */
	.scroll-top-button.show {
	  	display: flex;  /* é¡¯ç¤ºæŒ‰éˆ• */}
		
		
	.day-section.fade-in {
		opacity: 1;
		transform: translateY(0);}
	
	.exchange-page {
		display: none;
		position: relative;
		top: 3.8rem;
		min-height:680px;
		text-align: center;
		padding: 0px 20px;
		animation: fadeIn 0.4s ease;}

	.converter {
		margin-top: 35px;
		display: flex;
		flex-direction: column;
		align-items: flex-start;
		gap: 12px;}
	
	.input-group {
		width:100%;
		display: flex;
		align-items: center;
		gap: 10px;}
	
	input[type="number"] {
		width: 180px;
		padding: 8px;
		font-size: 18px;
		text-align: right;}
	
	select {
		padding: 8px;
		font-size: 16px;}
	
	#swap-btn {
		font-size: 22px;
		border: none;
		background: #3a7afe;
		color: #fff;
		width: 50px;
		height: 50px;
		border-radius: 50%;
		cursor: pointer;
		transition: transform 0.2s ease;}
	
	#swap-btn:hover {
		transform: rotate(180deg);}
	
	
	@keyframes fadeIn {
	  	from { opacity: 0; transform: translateY(10px); }
	  	to { opacity: 1; transform: translateY(0); }}
	
	.toggle-switch {
	  	display: flex;
	  	align-items: center;
	  	gap: 10px;
	  	font-size:18px;
	  	cursor: pointer;
	  	margin: 10px 0;}
	
	.toggle-track {
	  	position: relative;
	  	width: 57px;
	  	height: 27px;
	  	background: #ccc;
	  	border-radius: 15px;
	  	transition: background 0.3s ease;}
	
	.toggle-thumb {
	  	position: absolute;
	  	top: 0px;
	  	left: 0px;
	  	width: 27px;
	  	height: 27px;
	  	background: #3a7afe;
	  	border-radius: 50%;
	  	transition: left 0.3s ease;}
	
	.toggle-switch.active .toggle-thumb {
	  	left: 30px;}
	
	.toggle-switch.active .toggle-track {
	  	background: #a3c1ff;}
		
	.input-wrapper {
	  	width: calc(100%); /* âœ… å·¦å³å„ç•™ 1rem */
	  	margin: 0 auto;            /* âœ… æ°´å¹³ç½®ä¸­ */
	  	position: relative;}
	
	.input-wrapper input[type="number"] {
	  	width: 100%;
	  	padding: 1rem; /* âœ… å·¦å³å…§è·ï¼šå³å´ç•™ç©ºçµ¦å¹£åˆ¥æç¤º */
	  	font-size: 20px;
	  	text-align: left;
	  	border: 1px solid #ddd;
	  	color:#222;
	 	border-radius: 8px;
	  	box-sizing: border-box;}
	
	
	.currency-label {
	  	position: absolute;
	 	right: 10px;
	  	top: 50%;
	  	transform: translateY(-50%);
	  	font-size: 14px;
	  	color: #888;
	  	pointer-events: none;}
		
	.num-pad {
	   	max-width: 400px;
		margin: 0 auto;
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		margin-top: 25px;
		gap: 8px;
		width: 100%;}
	
	.num-pad .key {
	  	padding: 18px 0;
	  	font-size: 26px;
	  	border: none;
	  	border-radius: 8px;
	  	background: #e6e6e6;
	  	color: #333;
	  	cursor: pointer;
	  	transition: 0.2s;}
	
	.num-pad .key.orange {
	  	background: #ff9f47;
	  	color: white;}
	
	.num-pad .key:active {
	  	transform: scale(0.95);}
		
		
	/* åŒ¯ç‡æ›ç®—è¼¸å…¥æ¡†ï¼ˆä¿®æ­£ç‰ˆï¼‰*/
	
	.input-wrapper {
	  	position: relative;
	  	width: 100%;
	  	max-width: 400px;
	  	margin: 0 auto;}
	
	.input-wrapper input {
	  	width: 100%;
	  	padding: 30px 16px;
	  	padding-right: 70px; /* â­ é ç•™å³é‚Šç©ºé–“çµ¦ã€Œï½œå¹£åˆ¥ã€ */
	  	font-size: 24px;
	  	border: 1px solid #ddd;
	  	border-radius: 8px;
	  	background: #fff;
	  	color: #222;
	  	box-sizing: border-box;
		-moz-appearance: textfield;}
	
	.input-wrapper input:focus {
	  	outline: none;
	  	border-color: #3A7AFE;
	  	box-shadow: 0 0 0 2px rgba(58,122,254,0.15);}
	
	
	input[type="text"]::-webkit-inner-spin-button,
	input[type="text"]::-webkit-outer-spin-button {
	  	-webkit-appearance: none;
	  	margin: 0;}
	
	/* å¹£åˆ¥æ–‡å­—ï¼ˆå³é‚Šï¼‰ */
	.currency-label {
	  	position: absolute;
	  	right: 16px;
	  	top: 50%;
	  	transform: translateY(-50%);
	  	font-size: 20px;
	  	color: #888;
	  	pointer-events: none;}
		
	
	.exchange-inner {
	  	padding-bottom: 0px;   /* â­ æ‰€æœ‰åŒ¯ç‡é çš„ padding æ”¾é€™é‚Š */
	  	max-width: 500px;
	 	margin: 0 auto;}
	  
	.packing-page {
	  	padding: 20px;
	  	padding-top: 95px;
		background-color: #F6F9FC;
		animation: fadeIn 0.4s ease;
		margin-bottom: 3rem;}
	
	/* æ•´é«”å¤–æ¡† */
	.packing-group {
	  	background: #fff;
		border-radius: 8px;
		padding: 20px 18px;
		margin: 20px 0;
		margin-top: 10px;
		margin-bottom: 30px;
		box-shadow:0 0px 3px rgb(0 0 0 / 10%);}
		
	/* æ¨™é¡Œåˆ— */
	.packing-group-header {
	  	display: flex;
	  	align-items: center;
	  	justify-content: space-between; /* å³é‚Šç®­é ­å›ºå®šåœ¨æœ€å³ */
	  	gap: 6px;
		font-weight: 600;
	  	font-size: 16px;
	  	cursor: pointer;}
	
	.packing-group-actions {
		display: flex;
		gap: 10px;}
	
	/* åˆ—è¡¨ */
	.packing-list {
	  	list-style: none;
	  	padding: 0;
	  	margin: 0;
		margin-top: 10px;}

	.packing-item:last-child {
	  	border-bottom: none;}
	
	/* checkbox */
	.packing-checkbox {
	  	width: 25px;
	  	height: 25px;
	  	border: 2px solid #d95380;
	  	border-radius: 4px;
	  	margin-right: 10px;
	  	cursor: pointer;
	  	position: relative;}
		
	.packing-checkbox.checked {
	  	background: #d95380;}
		
	.packing-checkbox.checked::after {
	  	content: "âœ“";
	    position: absolute;
	    color: #fff;
	    font-size: 20px;
	    font-weight: 600;
	    left: 7px;
	    top: -2px;}
	
	/* åˆªé™¤æŒ‰éˆ• */
	.delete-item {
	  	margin-left: auto;
	  	background: none;
	  	border: none;
	  	color: #bbb;
	  	font-size: 18px;
	  	cursor: pointer;
		opacity: 0;
	  	pointer-events: none;
	  	transition: opacity .25s ease;
		color: #e95959;
	  	cursor: pointer;}
	
	
	/* æ–°å¢æŒ‰éˆ• */
	.add-item-btn {
	  	width: 100%;
	  	background: none;
	  	border: none;
	  	font-size: 18px;
	  	color: #d95380;
	  	text-align: left;
	  	padding: 15px 0 0;
	  	cursor: pointer;}
	
	
	@keyframes modalPop {
	  	from { transform: scale(0.9); opacity: 0; }
	  	to   { transform: scale(1); opacity: 1; }}
	
	.packing-item.edit-mode .delete-item {
	  	opacity: 1;
	  	pointer-events: auto;}

		
	/* è¡Œææ¸…å–®é èƒŒæ™¯ */
	body.packing-mode {
	  	background: #f1f1f1 !important;}
	
	/* å³ä¸Šè§’åˆªé™¤åˆ†é¡ */
	.delete-group-btn {
		background: none;
	  	border: none;
	  	color: #d95380;
	  	font-size: 20px;
	  	font-weight: 600;
	  	cursor: pointer;
	  	margin-right: 8px;
		display: none;}
		
	.count-status {
		font-size: 14px;
		color: #bbb;
		font-weight: normal;}
		
	/* å±•é–‹ç®­é ­ */
	.arrow {
	  	color: #444;
		font-size: 20px;
	  	transition: transform 0.25s;}
		
	.packing-group.open .arrow {
	  	transform: rotate(180deg);}

	
	/* å°é …ç›®æ–‡å­— */
	.packing-item span {
	  	flex: 1;
	  	font-size: 18px;}
	
	/* å°é …ç›®åˆªé™¤éµï¼ˆæ°¸é é¡¯ç¤ºï¼‰ */
	.item-delete-btn {
		background: none;
		border: none;
		color: #c7c7c7;
		font-size: 24px;
		cursor: pointer;}
	
	
	/* + æ–°å¢åˆ†é¡å¤–æ¡† */
	.add-category {
		background: #fff;
	  	border-radius: 8px;
	  	border: 1px solid #d95380;
	  	padding: 15px 18px;
		color: #d95380;
	  	text-align: center;
	  	margin: 10px 0;
		margin-bottom: 5rem;
	  	cursor: pointer;
		font-size: 20px;}
		
	/* Modal */
	.modal-overlay {
	  	position: fixed;
	  	inset: 0;
	  	background: rgba(0,0,0,0.35);
	  	display: none;
	  	justify-content: center;
	  	align-items: center;
	  	z-index: 3000;}
	
	.modal-box {
	  	background: #fff;
	  	width: 80%;
	  	max-width: 330px;
	  	border-radius: 8px;
	  	padding: 28px 20px;
	  	text-align: center;}
	
	.modal-box input {
		width: 90%;
		padding: 14px;
		border: 1px solid #ddd;
		border-radius: 6px;
		font-size: 15px;
		margin-bottom: 14px;}
	
	.modal-buttons {
	  	display: flex;
	  	gap: 10px;}
	
	.modal-buttons button {
	  	flex: 1;
	  	padding: 10px 0;
	  	border: none;
	 	border-radius: 6px;
	  	font-size: 15px;}
	
	#modalCancel { 
		background: #ddd; }
		
	#modalOK { 
		background: #d95380; color: white; }
		
	.packing-group-header .left-group {
	  	display: flex;
	  	align-items: center;
	  	gap: 6px;}
	
	.packing-group-header .title {
	  	flex-shrink: 0;}
	
	.packing-group-header .count-status {
	  	font-size: 16px;
	  	color: #999;
	  	flex-shrink: 0;}
		
	/* === çµ±ä¸€ç‰ˆ packing-item === */
	.packing-item {
	  	position: relative;
	  	display: flex;
	  	align-items: center;
	  	gap: 5px;
		padding: 13px 0;         /* å»ºè­°çš„å®‰å…¨ padding */
	  	border-bottom: 1px solid #eee;
		background: #fff;
		font-size: 15px;}
		
	/* æ‹–æ›³æ™‚çš„åŠé€æ˜æ¨£å¼ */
	.drag-ghost {
	  	opacity: 0.3;
	 	background: #f7f7f7 !important;}
	
	.ticket-page {
	  	background: #F6F9FC;
	  	min-height: 430px;
	  	padding: 24px 20px;
		padding-top:87px;
		padding-bottom: 120px;
		animation: fadeIn 0.4s ease;}
	
	
	/* é¡åˆ¥å€å¡Š */
	.ticket-category-list {
	  	display: flex;
	  	flex-direction: column;
	  	gap: 3px;
	 	animation: fadeIn 0.4s ease;}
	
	/* å–®ä¸€å¡ç‰‡ */
	.ticket-category {
		animation: fadeIn 0.4s ease;
		background: #fff;
		border-radius: 8px;
		margin: 20px 0;
		margin-top: 8px;
		margin-bottom: 3px;
		padding: 24px 14px;
	  	display: flex;
	  	align-items: center;
	  	gap: 10px;
	  	cursor: pointer;
		position: relative;
		box-shadow:0 0px 3px rgb(0 0 0 / 10%);}
		
	.ticket-category span {
	  	position: relative;
	  	z-index: 2;}
	
	/* å…§å®¹é  */
	.ticket-content.hidden {
	  	display: none;}
		
	
	.ticket-back {
	 	background: none;
	  	border: none;
	  	font-size: 16px;
	  	color: #007AFF;
	  	margin-bottom: 12px;
	  	cursor: pointer;}

	.ticket-content img {
		border-radius: 12px;
		margin: 12px 0;}
		
	.ticket-category:active {
	  	transform: scale(0.97);}
	
	/* å·¦å´ iconï¼ˆç„¡èƒŒæ™¯ï¼‰ */
	.ticket-category .icon {
	  	width: 40px;
	  	height: 40px;
	  	flex-shrink: 0;
		padding:0.5rem;
	  	display: flex;
	  	align-items: center;
	  	justify-content: center;}
	
	.ticket-category .icon img {
	  	width: 45px;
	  	height: 45px;
	  	object-fit: contain;}
	
	/* æ–‡å­— */
	.ticket-category .text {
	  	flex: 1;}
	
	.ticket-category .title {
	  	font-size: 20px;
	  	font-weight: 600;
		color: #333;}
	
	/* å³å´ä¸‰é» */
	.ticket-category .more {
	  	font-size: 24px;
	  	color: #8E8E93;
	  	padding: 4px 6px;}
	
	.ticket-content {
	  	animation: fadeIn .3s ease;
		margin-top: 20px;}

	#ticketContentTitle {
	  	font-size: 20px;
	  	font-weight: 600;
	  	margin-bottom: 12px;}
		
	.pdf-list {
	  	display: flex;
	  	flex-direction: column;
	  	gap: 14px;
	  	margin-top: 20px;}
	
	.pdf-item {
	  	display: flex;
	  	align-items: center;
	  	gap: 14px;
	  	padding: 30px 14px;
	  	background: #fff;
	  	border-radius: 8px;
	  	text-decoration: none;
	  	color: #222;}
	
	.pdf-item:active {
	  	transform: scale(0.97);}
	
	.pdf-icon {
	  	width: 50px;
	  	height: 50px;}
	
	.pdf-title {
	  	font-size: 20px;
	  	font-weight: 600;}
	
	.pdf-sub {
		font-size: 16px;
		color: #888;}
		
	/* ===== ä½å®¿ç¾¤çµ„ ===== */
	.hotel-group {
	  	display: flex;
	  	flex-direction: column;
	 	gap: 15px;
	  	margin-top: 10px;
	  	animation: fadeIn 0.4s ease-out;}
	
	/* å–®ä¸€ä½å®¿å¡ç‰‡ */
	.hotel-item {
	  	background: #fff;
	  	border-radius: 8px;
	  	box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	  	overflow: hidden;
		margin-bottom: 0.5rem;}
	
	/* æ¨™é¡Œåˆ— */
	.hotel-header {
		display: flex;
		justify-content: space-between;
		align-items: center;
		font-size: 16px;
		cursor: pointer;
		border-radius: 8px 8px 0px 0px;
		background-color: #e6e6e6;
		border-bottom: 1px solid #e0e0e0;
		color: #444;
		padding: 8px 20px;}
	
	.hotel-arrow {
	  	font-size: 20px;
	  	color: #bbb;
	  	transition: transform .25s ease;}
		
	.flight-group {
	 	animation: fadeIn 0.4s ease-out;}
		
	/* å±•é–‹ç‹€æ…‹ */
	.hotel-item.open .hotel-arrow {
	  	transform: rotate(90deg);}
	
	/* PDF æ¸…å–®ï¼ˆé è¨­æ”¶åˆï¼‰ */
	.hotel-pdf-list {
	  	display: none;
	  	flex-direction: column;
		padding: 5px 5px 5px 5px;}
	
	.hotel-item.open .hotel-pdf-list {
	  	display: flex;}
	
	/* èˆªç­å€å¡Š */
	
	.flight-card {
		background: #fff;
		border-radius: 8px;
		margin: 20px 0;
		margin-top: 10px;
		margin-bottom: 3px;
		box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);}
		
	.flight-header {
	  	display: flex;
	  	flex-direction: column;
	  	gap: 6px;
	  	margin-bottom: 14px;}
	
	.flight-route {
	  	font-size: 15px;      /* æ¯”åŸæœ¬å†å¤§ä¸€é» */
	  	font-weight: 600;
	  	color: #111;}
	
	.flight-info {
		font-size: 24px;
		color: #6e6e73;}
	
	.flight-docs {
		display: grid;
	  	grid-template-columns: repeat(2, 1fr);
		padding: 15px 12px 5px 12px;
	  	display: flex;
	  	justify-content: space-between;}
	
	.flight-doc {
		border-radius: 8px;
		padding: 6px 8px;         /* â¬…ï¸ é—œéµï¼šç¸® padding */
		text-align: center;
		box-shadow: inset 0 0 0 1px #e6e9f0;
		transition: background 0.15s ease;
		margin-bottom: 8px;
		width: 100%;}

	.flight-doc:active {
	  	background: #eef3ff;
	  	transform: scale(0.97);}
		
	.flight-doc .doc-name {
	 	font-size: 14px; 
		margin-bottom: 2px;}
	
	.flight-doc .doc-type {
		font-size: 18px;           /* æ›´åƒé™„ä»¶èªªæ˜ */
		color: #8e8e93;}
	
	.flight-doc::after {
	  	font-size: 10px;
	  	top: 6px;
	  	right: 8px;
	  	opacity: 0.45;}
	
	a,
	a:visited,
	a:hover,
	a:active {
	  	color: inherit !important;
	  	text-decoration: none !important;}
	
	/* 1. é¡è‰²å€å¡Šï¼ˆè‰²å¸¶ï¼‰ */
	.flight-pass-bar {
		border-radius: 8px 8px 0px 0px;
		background-color: #e6e6e6;
		border-bottom: 1px solid #e0e0e0;
		color: #444;
		padding: 8px 15px;
		display: flex;
		justify-content: space-between;}
	
	.pass-title {
	 	font-size: 16px;
		font-weight: bold;
		padding-top: 0.2rem;}
	
	.pass-checkin {
		font-size: 16px;}
	
	/* 2. èˆªç©ºå…¬å¸èˆ‡èˆªç­ç·¨è™Ÿ */
	.flight-airline {
	  	padding: 8px 16px;
	  	padding-bottom:0;}
	
	.flight-no {
	  	font-size: 18px;
	  	font-weight: bold;}
	
	.flight-dates {
	  	display: flex;
		padding: 0.4rem 0;
	  	justify-content: space-between;
	  	margin-top: 0px;}
	
	.date-depart, .date-arrive {
	  	font-size: 16px;
	  	color: #b9b9b9;}
	
	/* 3. èˆªç­æ™‚é–“ */
	.flight-main {
	  	display: flex;
	  	justify-content: space-between;
	  	align-items: center;
	  	padding: 0px 16px;}
	
	.time1 {
	  	font-size: 30px;
		padding: 0.4rem 0;
	  	font-weight: bold;
	  	color:#a87f30;}
	
	.terminal {
	  	font-size: 12px;
	  	color: #999;}
	
	
	.flight-doc {
		background-color: #f1f1f1;
		border-radius: 6px;
		padding: 10px 0px;
	  	text-decoration: none;
	  	color: #333;
	  	font-weight: bold;}
	
	.flight-doc:hover {
	  	background-color: #e0e0e0;}	
	
	.doc-name {
	  	font-size: 14px;}
	
	/* å°å°ºå¯¸è™•ç†ï¼šå°‡PDFå¡ç‰‡è®Šå° */
	@media (max-width: 768px) {
	.flight-docs {
		flex-direction: column;
		align-items: center;}
	
	.flight-time,.flight-line {
		display: flex;
		justify-content: space-between;
		margin-top: 0px;}
	
	
	.airport {
	 	font-size: 16px;
	  	color: #777;}
	
	/* é£›æ©Ÿåœ–æ¨™èˆ‡è·¯ç·šé¡¯ç¤ºæ¨£å¼ï¼ˆä½æ–¼å¡ç‰‡å¤–é¢ï¼‰*/
	.flight-card-wrapper {
	  	position: relative;
	  	font-size:18px;
		margin-top:0.5rem;}
		
	.route{
		padding-left:0.5rem;}
		
	/* ===== PDF é–‹å•Ÿéæ¸¡å‹•ç•« ===== */
	.ticket-opening {
	  	animation: ticketFadeOut 0.25s ease forwards;}
	
	@keyframes ticketFadeOut {
	from {
		opacity: 1;
		transform: scale(1);}
	  to {
		opacity: 0.85;
		transform: scale(0.96);}}
		
	
	
	/* Splash æ•´é«” */
	#app-splash {
	  	position: fixed;
	  	inset: 0;
	  	background-color:#3A7AFE;
	  	z-index: 9999;
	  	display: flex;
	  	flex-direction: column;
	  	justify-content: center;
	  	align-items: center;}
	
	/* âœˆï¸ é£›æ©Ÿ */
	.plane {
	  	width: 95px;
	 	animation: taxi 0.8s ease-out forwards,takeoff 1.2s ease-in forwards 0.8s;}
	
	@keyframes taxi {
	  from { transform: translateX(-40px); }
	  to   { transform: translateX(0); }}
	
	@keyframes takeoff {
	  to {
		transform: translate(120px, -120px) rotate(-15deg);
		opacity: 0;}}
	
	/* æ–‡å­— */
	.splash-text {
	  	margin-top: 16px;
	  	font-size: 18px;
		padding-left:0.3rem;
	  	color: #fff;
	  	animation: blink 1s ease-in-out infinite alternate;}
	
	@keyframes blink {
	  from { opacity: 0.4; }
	  to   { opacity: 1; }}
	
	/* Splash æ¶ˆå¤± */
	#app-splash.hide {
	  	opacity: 0;
	  	pointer-events: none;
	  	transition: opacity 0.4s ease;}
	
	/* ä¸»å…§å®¹ */
	#app-root {
	  	opacity: 0;
		display: none;
	  	margin: 0;  /* ç¢ºä¿æ²’æœ‰é¡å¤–çš„ margin */
	  	padding: 0;  /* ç¢ºä¿æ²’æœ‰é¡å¤–çš„ padding */
	  	position: relative;
		touch-action: pan-y;}
		
	#app-root.show {
	  	animation: fadeIn 0.4s ease forwards;
		display: block;
	  	
	  	top: 0;  /* ç¢ºä¿é é¢å¾é ‚éƒ¨é–‹å§‹ */
	  	left: 0;
	  	width: 100%;  /* ä¿è­‰å¯¬åº¦å æ»¿æ•´å€‹è¦–å£ */
	  	
		overflow: hidden;}
		
	.topbar {
	  	background: #3A7AFE;
	  	color: white;
	  	padding: 25px;
	  	position: fixed;
	  	top: 0;
	  	left: 0;
	  	right: 0;
	  	z-index: 1000;
	  	transition: top 0.3s ease;
		text-align: center;
      	box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      	margin-bottom: 24px;}
	
	.ios-full-menu {
	  	display: none;
	  	position: fixed;
	  	top: 0;
	  	left: 0;
	  	right: 0;
	  	bottom: 0;
	  	background: #3a7afeed;
	  	z-index: 999;
	  	justify-content: center;
	  	align-items: center;
	  	flex-direction: column;
		transition: 0.3s;
		transition: opacity 0.4s ease, transform 0.4s ease;}
	
	.ios-full-menu .menu-content {
		border-radius: 10px;
	  	padding: 20px;
	  	text-align: center;}
	
	.ios-full-menu ul {
	  	list-style: none;
	  	padding: 0;
	  	margin: 0;}
	
	.ios-full-menu li {
		padding: 15px;
	  	cursor: pointer;
	  	font-size: 18px;}
	
	.menu-close {
	  	position: absolute;
	  	top: 20px;
	  	right: 20px;
	  	font-size: 30px;
	  	background: none;
	  	border: none;
	  	color: white;
	  	cursor: pointer;}
	
	.menu-btn {
	 	background: none;
		border: none;
		position: relative;
		width: 43px;
		font-size: 30px;
		height: 31px;
		cursor: pointer;
		display: flex;
		flex-direction: column;
		justify-content: space-between;
		padding: 0;}
	
	/* å‰µå»ºä¸‰æ¢ç·šï¼Œä¸¦çµ¦æ¯æ¢ç·šåŠ é™°å½± */
	.menu-btn::before,
	.menu-btn::after,
	.menu-btn div {
	 	content: "";
		position: absolute;
		width: 100%;
		height: 5px;
		BORDER-RADIUS: 100PX;
		background-color: white;
		transition: transform 0.3s ease;}
	
	/* å‡å‹»é–“éš”çš„ä¸‰æ¢ç·š */
	.menu-btn::before {
	  	top: 0;}
	
	.menu-btn div {
	  	top: 50%;
	  	transform: translateY(-50%);}
	
	.menu-btn::after {
	  	bottom: 0;}
	
	/* ç•¶é¸å–®é–‹å•Ÿæ™‚ï¼Œå°‡ç·šæ¢æ—‹è½‰ï¼Œä¸¦éš±è—ä¸­é–“çš„ç·š */
	.menu-btn.open::before {
	  	transform: rotate(45deg);
	  	top: 50%;}
	
	.menu-btn.open::after {
	  	transform: rotate(-45deg);
	  	bottom: 50%;}
	
	.menu-btn.open div {
	  	opacity: 0; /* ä¸­é–“çš„ç·šæœƒéš±è— */}

		
		/* === è¿”å›æ¨¡å¼ === */
	.menu-btn.back::before {
	  top: 50%;
	  transform: rotate(-45deg) translate(-4px, -4px);
	  width: 12px;
	}
	
	.menu-btn.back::after {
	  bottom: 50%;
	  transform: rotate(45deg) translate(-4px, 4px);
	  width: 12px;
	}
	
	.menu-btn.back div {
	  opacity: 0; /* ä¸­é–“é‚£æ¢éš±è— */
	}
		

	.ios-full-menu.show {
	  	display: flex; /* é¡¯ç¤ºé¸å–® */
	  	opacity: 1; /* ä½¿é¸å–®é¡¯ç¤º */}/* é¸å–®é …ç›® */
		
	.menu-content ul {
	  	display: flex;
	  	flex-direction: column;
		list-style: none;
	  	padding: 0;
	  	gap: 0px; /* é …ç›®ä¹‹é–“çš„é–“è· */}
	
	.menu-content li {
	  	padding: 20px;}
	
	/* é é¢éš±è— */
	.content-page {
	  	display: none;
	  	opacity: 0;
	  	transition: opacity 0.3s ease-in-out;}
	
	/* ç•¶é é¢æœ‰ active é¡åˆ¥æ™‚é¡¯ç¤º */
	.content-page.active {
	  	display: block;
	  	opacity: 1;}

	
	.menu-content ul li {
	  	margin: 18px 0;
	 	font-size: 24px;
	  	color: #fff;
	  	cursor: pointer;}
	
		
	.container,
	.packing-page,
	.ticket-page,
	.exchange-page {
	  	display: none;}
	
	.container.active,
	.packing-page.active,
	.ticket-page.active,
	.exchange-page.active {
	  	display: block;}
		
	/* ===== å„é é¢é¡¯ç¤ºæ™‚çš„ padding-topï¼ˆæœ€çµ‚ç‰ˆï¼‰ ===== */
	#home-page.active {
		padding-top: 90px;}
		
	#packing-page.active {
		padding-top: 94px;}
	
	#ticket-page.active {
		padding-top: 72px;}
	
	#exchange-page.active {
		padding-top: 0px;}
		
	/* è®“ home-page æœ¬èº«æˆç‚ºæ»¾å‹•å®¹å™¨ */
	#home-page{
	  height: calc(120dvh - var(--topbar-h) - var(--bottom-nav-h));
	  overflow-y: auto;
	  -webkit-overflow-scrolling: touch;
	  
	  box-sizing: border-box;
	/* â­ é—œéµï¼šçœŸçš„ç•™ä¸€æ®µåº•éƒ¨å¯æ²å‹•ç©ºé–“ */
	  padding-bottom: calc(
	    var(--bottom-nav-h)
	    + env(safe-area-inset-bottom)
	    + 16px
	  );
	}
	
	

		
	/* ===== åº•éƒ¨å›ºå®šé¸å–® ===== */
	.bottom-nav {
  		position: fixed;              /* â­ é—œéµ */
		left: 0;
		right: 0;
		bottom: 0;
		height: 80px;
		display: flex;
		justify-content: space-around;
		align-items: center;
		background:#fdfdfd;
		backdrop-filter: blur(10px);
		border-top: 1px solid rgba(0,0,0,0.06);
		box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		z-index: 999;                 /* è¦æ¯”å…§å®¹é«˜ */
		padding:5px 10px 20px 10px;
	}

	/* æ¯ä¸€å€‹æŒ‰éˆ• */
	.bottom-nav button {
		
		height: 100%;
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		background: none;
		border: none;
		padding: 0;
		color: #888;
		cursor: pointer;
	}
	
	/* iconï¼ˆè·Ÿä½  transport-info åŒç³»çµ±ï¼‰ */
	.bottom-nav span[class^="icon-"] {
	  	font-size: 30px;
	  	line-height: 1;
	  	font-weight: normal;          /* â­ è§£æ±ºç²—ç´°ä¸ä¸€ */
	  	display: block;
	  	-webkit-font-smoothing: antialiased;
	}
	
	/* æ–‡å­— */
	.bottom-nav .label {
	  	font-size: 14px;
	  	margin-top: 5px;
	}
	
	/* Active ç‹€æ…‹ï¼ˆä¸æ•´å¡Šã€ä¸é†œï¼‰ */
	.bottom-nav button.active {
	  	color: #3a7afe;
	}
	
	.bottom-nav button.active::after {
	  	content: "";
	  	width: 30px;
	  	height: 2px;
	  	margin-top: 4px;
	  	border-radius: 2px;
	  	background: #3a7afe;
	}

	@keyframes shake {
	  	0%   { transform: translateX(0); }
	  	20%  { transform: translateX(-4px); }
	  	40%  { transform: translateX(4px); }
	  	60%  { transform: translateX(-3px); }
	  	80%  { transform: translateX(3px); }
	  	100% { transform: translateX(0); }
	}
	
	.vibrate {
	  	animation: navShake 0.25s ease;
	}

	#weather-page {
    	padding: 20px;
		padding-top:90px;
		animation: fadeIn 0.4s ease;
	}
	
	.region-switcher button {
	    margin: 10px;
	}
	
	.weather-section {
	    display: flex;
	    justify-content: space-between;
	}
	
	.weather-time {
	    margin: 5px;
	    text-align: center;
	}
	
	.weather-time img {
	    width: 50px;
	    height: 50px;
	}
		
	#backBtn {
	    background: none;
	    border: none;
	    font-size: 25px;
	    cursor: pointer;
	    position:fixed;
		top:12px;
		right:15px;
		color:white;
		visibility: hidden;
	}
		
	/* é¡¯ç¤ºæ™‚ */
	#backBtn.show {
	    visibility: visible !important; /* é¡¯ç¤º */
	    opacity: 1;
	    transition: visibility 0s 0s, opacity 0.3s ease;
	}
	
	.hidden{
		display:none;
	}
		
	.menu-btn.back::before {
	  	content: "\e900"; /* âŒ ä¸ç”¨é€™å€‹ï¼Œä¸‹é¢æœƒç”¨ span æ–¹å¼ */
	}
	
	/* è¿”å›æ¨¡å¼ï¼šå¾¹åº•éš±è—æ¼¢å ¡ç·š */
	.menu-btn.back::before,
	.menu-btn.back::after,
	.menu-btn.back > div {
	  	display: none !important;
	}
	
	/* ç”¨ ::after é¡¯ç¤º icon */
	.menu-btn.back::after {
	  	display: block;
	  	content: "";
	}
	/* è¿”å›ç®­é ­æ¨£å¼ */
	.menu-btn.back .icon-arrow-left {
	  	position: absolute;
	  	left: -7px;        /* ğŸ‘‰ å¾€å·¦/å³èª¿æ•´ */
	  	top: 50%;
	  	transform: translateY(-50%);
		font-size: 50px;   /* ğŸ‘‰ ç®­é ­å¤§å° */
	  	color: white;      /* ğŸ‘‰ ç®­é ­é¡è‰² */
	}

	/* åŸºæœ¬åˆ‡é éæ¸¡ï¼ˆæ·¡å…¥ + å°ä½ç§»ï¼‰ */
	.content-pages > .container,
	.content-pages > .packing-page,
	.content-pages > .ticket-page,
	.content-pages > .exchange-page,
	.content-pages > .weather-page{
	  	opacity: 0;
	  	transform: translateX(10px);
	  	animation: fadeIn 0.4s ease;
	  	will-change: opacity, transform;
	}
	
	.content-pages > .page-active{
	  	opacity: 1;
	  	transform: translateX(0);
	}

	/* Day åˆ‡æ›ï¼šæ»‘å…¥å‹•ç•« */
	@keyframes daySlideInFromRight {
	  from { opacity: 0; transform: translateX(18px); }
	  to   { opacity: 1; transform: translateX(0); }
	}
	
	@keyframes daySlideInFromLeft {
	  from { opacity: 0; transform: translateX(-18px); }
	  to   { opacity: 1; transform: translateX(0); }
	}
	
	.day-anim-right { animation: daySlideInFromRight .42s cubic-bezier(.2, .9, .2, 1); }
	.day-anim-left  { animation: daySlideInFromLeft  .42s cubic-bezier(.2, .9, .2, 1); 
					}
	/* iOS Full Screen Menu éæ¸¡æ•ˆæœ */
	#iosFullMenu{
	  display: none;                 /* å¹³å¸¸ä¸é¡¯ç¤º */
	  opacity: 0;
	  transform: translateY(-12px);
	  transition: opacity .22s ease, transform .22s ease;
	  pointer-events: none;          /* é—œé–‰æ™‚ä¸èƒ½é» */
	}
	
	/* æ‰“é–‹ç‹€æ…‹ */
	#iosFullMenu.menu-open{
	  opacity: 1;
	  transform: translateY(0);
	  pointer-events: auto;
	}


/* ========== Weather iPhone-like UI ========== */
/* =========================================================
   Weather Page â€“ Full CSS (Optimized)
   - Layout / text / icons / cards
   - 4 time backgrounds
   - Snow-only effects: snow-lite (default) / snow-heavy (when snowing)
========================================================= */

/* -------------------------
   Root helpers (optional)
-------------------------- */
:root{
  --wx-maxw: 520px;

  /* cards */
  --wx-card-bg: rgba(255,255,255,0.16);
  --wx-card-border: rgba(255,255,255,0.18);

  /* text */
  --wx-text: rgba(255,255,255,0.95);
  --wx-text-soft: rgba(255,255,255,0.9);

  /* spacing */
  --wx-pad-x: 18px;
}

/* =========================================================
   Page container
========================================================= */
.weather-page{
  /* è®“èƒŒæ™¯å‹•ç•«èƒ½å®Œæ•´é‹ªåº• */
  min-height: calc(146dvh - var(--topbar-h) - var(--bottom-nav-h));
  padding-top: 92px; /* topbar å›ºå®šé«˜åº¦ï¼Œè‡ªè¡Œå¾®èª¿ */
  padding-left: var(--wx-pad-x);
  padding-right: var(--wx-pad-x);
  padding-bottom: calc(var(--bottom-nav-h) + env(safe-area-inset-bottom) + 18px);
  box-sizing: border-box;

  position: relative;
  overflow: hidden;

  /* èƒŒæ™¯åˆ‡æ›æ›´é † */
  transition: background 600ms ease;
}

/* å…§å®¹å±¤ï¼šæ°¸é è“‹åœ¨æ•ˆæœå±¤ä¹‹ä¸Š */
.weather-page .wx-wrap{
  position: relative;
  z-index: 2;
  max-width: var(--wx-maxw);
  margin: 0 auto;
}

/* è¼‰å…¥ä¸­ï¼šé¿å…ç™½åº•é–ƒä¸€ä¸‹ï¼ˆä½  JS å¯åŠ /ç§»é™¤é€™å€‹ classï¼‰ */
.weather-page.is-loading{
  background: linear-gradient(180deg, #0b2444 0%, #071427 100%);
}

/* =========================================================
   4 Time backgrounds (ä½ åªè¦æ”¹é€™è£¡å°±èƒ½æ›æ¼¸å±¤)
========================================================= */
/* æ—¥å‡ºï¼ˆæ™¨æ›¦ï¼‰ */
.weather-page.bg-sunrise{
  background: linear-gradient(180deg, #8fbaff 0%, #254873 55%, #00133b 100%);
}

/* ç™½å¤©ï¼ˆæ·ºè— â†’ æ·±è—ï¼‰ */
.weather-page.bg-day{
  background: linear-gradient(180deg, #d3dfff 0%, #6faaff 55%, #0f64df 100%);
}

/* æ—¥è½ï¼ˆé»ƒæ˜ï¼‰ */
.weather-page.bg-sunset{
  background:linear-gradient(180deg, #8fbaff 0%, #254873 55%, #00133b 100%);
}

/* é»‘å¤œï¼ˆæ·± â†’ æ›´é»‘ï¼‰ */
.weather-page.bg-night{
  background: linear-gradient(180deg, #0b2444 0%, #071427 55%, #040a14 100%);
}

/* =========================================================
   Snow-only background effects
   - default: snow-lite
   - snowing : snow-heavy
========================================================= */

/* ä¸è¦é›²ï¼š::before å®Œå…¨ä¸ä½¿ç”¨ */
.weather-page::before{
  content:"";
  display:none;
}

/* é£„é›ªå±¤ï¼ˆå…±ç”¨åŸºåº•ï¼‰ */
.weather-page::after{
  content:"";
  position:absolute;
  inset:-20%;
  pointer-events:none;
  z-index: 1;

  opacity: 0;
  transition: opacity .25s ease;

  /* è®“é›ªé»æŸ”ä¸€é» */
  filter: blur(.35px) drop-shadow(0 0 1.5px rgba(255,255,255,.25));
}

/* â­ éä¸‹é›ªï¼šé è¨­å¾®å¾®é£„é›ªï¼ˆå°‘ã€æ…¢ã€ç´°ï¼‰ */
.weather-page.snow-lite::after{
  opacity: .55;
  background-image:
    radial-gradient(1.3px 1.3px at 20% 20%, rgba(255,255,255,.55), transparent 60%),
    radial-gradient(1.1px 1.1px at 60% 40%, rgba(255,255,255,.50), transparent 60%),
    radial-gradient(1.0px 1.0px at 80% 70%, rgba(255,255,255,.45), transparent 60%);
  background-size: 280px 280px, 320px 320px, 240px 240px;
  background-repeat: repeat;
  animation: snowFallLite 40s linear infinite;
}

/* â­ ä¸‹é›ªï¼šé£„é›ªæ›´æ˜é¡¯ï¼ˆè¼ƒå¤šã€è¼ƒå¤§ã€è¼ƒå¿«ï¼‰ */
.weather-page.snow-heavy::after{
  opacity: .9;
  background-image:
    radial-gradient(2.6px 2.6px at 15% 15%, rgba(255,255,255,.80), transparent 60%),
    radial-gradient(2.4px 2.4px at 50% 40%, rgba(255,255,255,.75), transparent 60%),
    radial-gradient(2.1px 2.1px at 80% 60%, rgba(255,255,255,.70), transparent 60%),
    radial-gradient(1.5px 1.5px at 30% 75%, rgba(255,255,255,.62), transparent 60%),
    radial-gradient(1.2px 1.2px at 65% 85%, rgba(255,255,255,.55), transparent 60%);
  background-size: 190px 190px, 230px 230px, 210px 210px, 170px 170px, 150px 150px;
  background-repeat: repeat;
  animation: snowFallHeavy 26s linear infinite;
}

/* é£„é›ªå‹•ç•«ï¼šé¿å…å¤ªç›´ç·šï¼ˆè½ä¸‹ + å¾®å·¦å³é£„ï¼‰ */
@keyframes snowFallLite{
  0%   { transform: translate3d(0,-220px,0) translateX(0); }
  50%  { transform: translate3d(0,360px,0) translateX(18px); }
  100% { transform: translate3d(0,920px,0) translateX(-10px); }
}
@keyframes snowFallHeavy{
  0%   { transform: translate3d(0,-260px,0) translateX(0); }
  50%  { transform: translate3d(0,480px,0) translateX(26px); }
  100% { transform: translate3d(0,1250px,0) translateX(-16px); }
}

/* ç„¡éšœç¤™ï¼šåå¥½æ¸›å°‘å‹•ç•« */
@media (prefers-reduced-motion: reduce){
  .weather-page::after{ animation:none !important; }
}

/* =========================================================
   Dots (city switch)
========================================================= */
.wx-dots{
  display:flex;
  gap:8px;
  justify-content:center;
  align-items:center;
  margin-top: 15px;
  margin-bottom: 10px;
  z-index: 3;
}
.wx-dot{
  width:5px;
  height:5px;
  border-radius:999px;
  background: rgba(255,255,255,0.45);
  border: 1px solid rgba(255,255,255,0.35);
  transition: transform .2s ease, background .2s ease;
  cursor: pointer;
}
.wx-dot.active{
  background: rgba(255,255,255,0.92);
  transform: scale(1.22);
}

/* =========================================================
   Header (hero)
========================================================= */
.wx-hero{
  text-align:center;
  color: var(--wx-text);
  margin: 2rem 0;
  text-shadow: 0 6px 22px rgba(0,0,0,0.18);
}
.wx-city{
  font-size: 22px;
  
  letter-spacing: .5px;
}
.wx-temp-center{
  font-size: 74px;
  
  line-height: 1.05;
  margin-top: 8px;
  margin-bottom: 6px;
  display: inline-block;
  position: relative;
  
}
.wx-temp-center::after{
  content: "Â°";
  position:absolute;
 
  top: 6px;
  font-size: 34px;
  opacity: 0.95;
}
#wxTemp{ display:inline-block; min-width: 40px; }

.wx-desc{
  font-size: 16px;
  opacity: 0.95;
}
.wx-hilo{
  font-size: 16px;
  opacity: 0.9;
  
}

/* =========================================================
   Cards
========================================================= */
.wx-card{
  background: var(--wx-card-bg);
  border: 1px solid var(--wx-card-border);
  border-radius: 16px;
  padding: 10px 14px 5px 14px;
  backdrop-filter: blur(10px);
  box-shadow: 0 10px 25px rgba(0,0,0,0.12);
  margin-top: 1rem;
 
}
.wx-card-title{
  font-size: 13px;
  letter-spacing: 1px;
  opacity: .95;
  color: var(--wx-text);
  margin-bottom: 10px;
  border-bottom: 1px solid #ffffff57;
  padding-bottom: 0.4rem;
  padding-left: 0.3rem;
}
.wx-hourly-note{
  font-size: 13px;
  letter-spacing: 1px;
  opacity: .95;
  color: var(--wx-text);
  margin-bottom: 5px;
  padding-left: 0.3rem;
  border-bottom: 1px solid #ffffff57;
  padding-bottom: 0.4rem;
  padding-left: 0.3rem;
}

/* å›ºå®šæœ€å°é«˜åº¦ï¼šé¿å…åˆ‡åŸå¸‚è¼‰å…¥æ™‚é«˜åº¦é–ƒå‹• */
#wxHourly { min-height: 92px; }
#wxWeek   { min-height: 220px; }

/* =========================================================
   24h (horizontal)
========================================================= */
.wx-hourly{
  display:flex;
  gap: 17px;
  overflow-x: auto;
  
  -webkit-overflow-scrolling: touch;
}
.wx-hourly::-webkit-scrollbar{ display:none; }

.wx-hour{
  flex: 0 0 auto;
  width: 65px;
  padding: 5px 3px 0px 3px;
  text-align:center;
  scroll-snap-align: start;
}
.wx-hour-time{
  font-size: 14px;
  opacity: 0.95;
  color: var(--wx-text);
  margin-bottom: 6px;
}

/* âœ… icon æ¨£å¼ï¼ˆä½ èªªæˆ‘å‰›å‰›æ²’è£œï¼‰ */
.wx-hour-icon{
  width: 28px;
  height: 28px;
  object-fit: contain;
  margin: 0 auto 6px;
  display:block;
  filter: drop-shadow(0 4px 10px rgba(0,0,0,.15));
}

.wx-hour-temp{
  font-size: 18px;
  
  color: var(--wx-text);
}

/* =========================================================
   Week (7 days)
========================================================= */
.wx-week{
  display:flex;
  flex-direction: column;
  gap: 8px;
}
.wx-week-row{
  display:grid;
  grid-template-columns: 54px 30px 38px 1fr 42px;
  gap: 10px;
  align-items:center;
  margin: 0.4rem 0;
  color: var(--wx-text);
}
.wx-week-day{
  font-size: 16px;
  opacity: .95;
  text-align: center;
}
.wx-week-icon{
  width: 25px;
  height: 25px;
  object-fit: contain;
  display:block;
  opacity: .98;
  filter: drop-shadow(0 6px 10px rgba(0,0,0,.16));
}
.wx-week-min, .wx-week-max{
  font-size: 16px;
  opacity: .95;
  text-align: center;
}
.wx-week-bar{
  height: 5px;
  border-radius: 999px;
  background: rgba(255,255,255,0.18);
  position: relative;
  overflow: hidden;
}
.wx-week-bar > span{
  position:absolute;
  top:0;
  height: 5px;
  border-radius: 999px;
  background: linear-gradient(90deg, #afffff, #caf8ff);
}

/* Small spacing helper */
.wx-spacer{ height:18px; }

/* âœ… å…§å®¹åœ¨é›ªå±¤ä¸Šé¢ */
.weather-page { position: relative; overflow: hidden; }
.weather-page .wx-wrap { position: relative; z-index: 2; }

/* âœ… é›ªå±¤ï¼ˆæ°¸é å­˜åœ¨ï¼Œç”¨ class æ§åˆ¶å¼·åº¦ï¼‰ */
.weather-page::after{
  content:"";
  position:absolute;
  inset:-25%;
  pointer-events:none;
  z-index:1;
  opacity:0;                 /* ç”± snow-light / snow-strong é–‹å•Ÿ */
  background-repeat: repeat;
  filter: blur(.15px) drop-shadow(0 0 2px rgba(255,255,255,.22));
}

/* ---------------- å¾®é›ªï¼šä¸€å±¤ã€ç¨€ç–ã€æ…¢ ---------------- */
.weather-page.snow-light::after{
  opacity: .26;

  /* åªæœ‰ 1 å±¤ï¼Œé¡†ç²’å°‘ */
  background-image:
    radial-gradient(2.0px 2.0px at 12% 18%, rgba(255,255,255,.50) 60%, transparent 61%),
    radial-gradient(1.6px 1.6px at 40% 55%, rgba(255,255,255,.42) 60%, transparent 61%),
    radial-gradient(1.2px 1.2px at 72% 30%, rgba(255,255,255,.34) 60%, transparent 61%),
    radial-gradient(1.0px 1.0px at 88% 75%, rgba(255,255,255,.30) 60%, transparent 61%);

  /* å¤§å°ºå¯¸ = ç¨€ç– */
  background-size: 520px 480px;

  animation: snowLightDrift 26s linear infinite;
}

/* ---------------- å¤§é›ªï¼šä¸‰å±¤ã€å¯†åº¦é«˜ã€å¿«ï¼‹ä¸åŒé€Ÿ ---------------- */
.weather-page.snow-strong::after{
  opacity: .72;

  /* ä¸‰å±¤é›ªï¼ˆå°é¡†è¶…å¤š + ä¸­é¡† + å°‘é‡å¤§é¡†ï¼‰ */
  background-image:
    /* å¤§é¡†ï¼ˆå°‘é‡ï¼‰ */
    radial-gradient(2.8px 2.8px at 18% 22%, rgba(255,255,255,.72) 60%, transparent 61%),
    radial-gradient(2.6px 2.6px at 76% 28%, rgba(255,255,255,.66) 60%, transparent 61%),

    /* ä¸­é¡†ï¼ˆä¸­å¯†ï¼‰ */
    radial-gradient(2.0px 2.0px at 35% 60%, rgba(255,255,255,.58) 60%, transparent 61%),
    radial-gradient(1.8px 1.8px at 62% 48%, rgba(255,255,255,.52) 60%, transparent 61%),
    radial-gradient(1.7px 1.7px at 90% 72%, rgba(255,255,255,.48) 60%, transparent 61%),

    /* å°é¡†ï¼ˆé«˜å¯†ï¼‰ */
    radial-gradient(1.2px 1.2px at 8%  40%, rgba(255,255,255,.42) 60%, transparent 61%),
    radial-gradient(1.1px 1.1px at 22% 85%, rgba(255,255,255,.38) 60%, transparent 61%),
    radial-gradient(1.0px 1.0px at 45% 18%, rgba(255,255,255,.34) 60%, transparent 61%),
    radial-gradient(1.1px 1.1px at 70% 35%, rgba(255,255,255,.32) 60%, transparent 61%),
    radial-gradient(1.0px 1.0px at 82% 92%, rgba(255,255,255,.30) 60%, transparent 61%);

  /* å°å°ºå¯¸ = å¯†åº¦çˆ†å¢ï¼ˆé‡é»ï¼‰ */
  background-size:
    260px 240px, 300px 270px,  /* å¤§é¡†å±¤ */
    220px 200px, 240px 215px, 260px 235px, /* ä¸­é¡†å±¤ */
    160px 145px, 170px 150px, 155px 140px, 175px 160px, 165px 150px; /* å°é¡†å±¤ */

  animation: snowStrongDrift 14s linear infinite;
}

/* å¾®é›ªï¼šæ…¢ï¼‹æ¼‚ç§»å° */
@keyframes snowLightDrift{
  0%   { transform: translate3d(-10px,-160px,0); }
  50%  { transform: translate3d( 18px, 280px,0); }
  100% { transform: translate3d(-6px, 760px,0); }
}

/* å¤§é›ªï¼šå¿«ï¼‹æ¼‚ç§»æ›´å¤§ */
@keyframes snowStrongDrift{
  0%   { transform: translate3d(-30px,-220px,0); }
  50%  { transform: translate3d( 45px, 420px,0); }
  100% { transform: translate3d(-15px,1080px,0); }
}
#bgCanvas{
  position: fixed;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}
#nowBroadcast, #hourly{
  position: relative;
  z-index: 5;
}
.hour-item{
  padding: 10px 12px;
  border-radius: 12px;
  margin: 8px 0;
  backdrop-filter: blur(8px);
}
.hour-top{
  display:flex;
  justify-content: space-between;
  align-items:center;
}
.sun-tag{
  font-size: 12px;
  padding: 2px 8px;
  border-radius: 999px;
}
.hour-mid{
  display:flex;
  align-items:center;
  gap: 10px;
  margin-top: 6px;
}
.hour-icon{
  width: 28px;
  height: 28px;
}
.hour-temp{
  font-size: 18px;
  font-weight: 600;
}
.hour-desc{
  font-size: 12px;
  opacity: .85;
  margin-top: 4px;
}
.weather-page::after{
  display:none !important;
  animation:none !important;
  opacity:0 !important;
  background-image:none !important;
}
		.wx-hour-marker{
  font-size: 12px;
  line-height: 14px;
  color: rgba(255,255,255,0.92);
  opacity: .95;
  margin-bottom: 4px;
}
.wx-hour-marker--empty{
  opacity: 0;
}
/* å³æ™‚æ’­å ±æ’ç‰ˆ */
#wxHourlyNote,
#nowBroadcast,
#wxNowBroadcast{
  display: flex;
  align-items: flex-start;
}

/* icon æœ¬é«” */
.icon-information-outline{
  font-size: 14px;
  opacity: .9;
  margin-top: 2px; /* å°é½Šç¬¬ä¸€è¡Œæ–‡å­— */
  flex-shrink: 0;
}

/* ä¸€æ ¼ç©ºç™½ï¼ˆä½ æŒ‡å®šè¦çš„ï¼‰ */
.wx-broadcast-space{
  width: 6px;
  display: inline-block;
}

/* æ–‡å­—æœ¬é«” */
.wx-broadcast-text{
  line-height: 1.45;
}
		
#wxHourly{
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
}

/* é è¨­ï¼šé¡¯ç¤ºæ¼¢å ¡ã€éš±è—è¿”å› */
#menuBtn { display: flex; }
#backBtn { display: none; }

/* é€²å…¥ç¬¬äºŒå±¤ï¼šé¡¯ç¤ºè¿”å›ã€éš±è—æ¼¢å ¡ */
.nav-back #menuBtn { display: none; }
.nav-back #backBtn { display: flex; }
/* é è¨­ï¼šè¿”å› icon éš±è— */
#menuBtn .icon-arrow-left{
  display: none;
}

/* âœ… é€²å…¥ back æ¨¡å¼ï¼šéš±è—ä¸‰æ¢ç·šï¼ˆbefore / div / afterï¼‰ï¼Œé¡¯ç¤ºè¿”å› icon */
body.nav-back #menuBtn::before,
body.nav-back #menuBtn::after,
body.nav-back #menuBtn > div{
  opacity: 0;
  visibility: hidden;
}

body.nav-back #menuBtn .icon-arrow-left{
  display: inline-flex;
  opacity: 1;
  visibility: visible;
}

/* å¯é¸ï¼šè®“ icon å‚ç›´ç½®ä¸­ */
#menuBtn{
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* 1) back æ¨¡å¼æ™‚ï¼Œè®“ menuBtn æœ‰è¶³å¤ çš„å°ºå¯¸èˆ‡å°é½Š */
body.nav-back #menuBtn{
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: visible;          /* é¿å…è£åˆ‡ icon */
}

/* 2) è®“ arrow icon æœ‰æ˜ç¢ºå¤§å° */
body.nav-back #menuBtn .icon-arrow-left{
  display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 54px;
        color: white;
        margin-left: -1rem;
        line-height: 1;
        width: 24px;
        height: 24px;
}

/* 3) é˜²æ­¢è¢«å…¶ä»–å…ƒç´ /ç·šæ¢è“‹ä½ */
body.nav-back #menuBtn .icon-arrow-left{
  position: relative;
  z-index: 10;
}

/* 4) back æ¨¡å¼æŠŠä¸‰æ¢ç·šå¾¹åº•éš±è—ï¼ˆåŒ…å«ä½ ä¸­é–“é‚£æ¢ divï¼‰ */
body.nav-back #menuBtn::before,
body.nav-back #menuBtn::after,
body.nav-back #menuBtn > div{
  opacity: 0 !important;
  visibility: hidden !important;
}
.wx-loading {
  position: absolute;
  inset: 0;
  z-index: 5;
  display: none;
  align-items: center;
  justify-content: center;
}

/* èƒŒæ™¯è‰²æœƒè·Ÿè‘— bg-day / bg-night */
#weather-page.bg-day .wx-loading {
  background: linear-gradient(180deg, #9fd4ff, #eaf6ff);
}
#weather-page.bg-night .wx-loading {
  background: linear-gradient(180deg, #0b1a2a, #142a45);
}

.wx-loading-box {
  text-align: center;
  color: #fff;
   transform: translateY(-100px); /* æƒ³å¾€ä¸Šå°±è² ã€å¾€ä¸‹å°±æ­£ */
}

.wx-loading-spinner {
  width: 28px;
  height: 28px;
  border: 3px solid rgba(255,255,255,.3);
  border-top-color: #fff;
  border-radius: 50%;
  margin: 0 auto 10px;
  animation: spin 0.9s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* è¼‰å…¥ä¸­æ™‚ï¼Œéš±è—æ‰€æœ‰å¤©æ°£å…§å®¹ */
#weather-page.is-loading .wx-content {
  visibility: hidden;
}
#weather-page.is-loading .wx-loading {
  display: flex;
}

/* è¼‰å…¥ä¸­æ™‚ï¼šæ•´å€‹å¤©æ°£å…§å®¹ç›´æ¥æ¶ˆå¤± */
#weather-page.is-loading .wx-content {
  display: none !important;
}

#weather-page.is-loading .wx-loading {
  display: flex;
}

/* éè¼‰å…¥ä¸­æ™‚ */
#weather-page .wx-loading {
  display: none;
}

/* =========================================================
   Shopping List â€“ FINAL CSS (Top Upload + Fixed Total)
========================================================= */

/* åº•éƒ¨ bottom-nav é«˜åº¦ï¼ˆä¾ä½ å¯¦éš›é«˜åº¦å¾®èª¿ï¼‰ */
:root{
  --bottom-nav-h: 72px;
  --total-bar-gap: 10px;
}

/* -------------------------
   Page wrap
-------------------------- */
.shopping-page-wrap{
  padding: 15px;
  
 
  background: #F6F9FC;
  min-height: 50dvh;
  position: relative;
}

/* -------------------------
   Top bar (Upload button fixed in normal flow)
-------------------------- */
.shop-topbar{
  margin-bottom: 16px;
}

.shop-upload-btn{

  display:flex;
  justify-content:center;
  align-items:center;

  padding: 14px 12px;
  border-radius: 8px;
  border: 1px dashed #3A7AFE;
  background: #ffffff;
  color: #3A7AFE;

  font-size: 16px;
  cursor: pointer;
}

/* -------------------------
   List
-------------------------- */
.shop-list{
  display:flex;
  flex-direction: column;
  gap: 12px;

  /* é ç•™å›ºå®šåˆè¨ˆ bar çš„ç©ºé–“ï¼Œé¿å…æœ€å¾Œä¸€ç­†è¢«è“‹ä½ */
  padding-bottom:calc(var(--bottom-nav-h) + 30px);
}

/* -------------------------
   Card + Swipe shell
-------------------------- */
.shop-swipe{
  position: relative;
  overflow: hidden;
  border-radius: 8px;
}

/* èƒŒå¾Œå±¤ï¼ˆå¦‚æœä½ è¦æ”¾æç¤ºæ–‡å­—/åœ–ç¤ºå¯ç”¨ï¼‰ */
.shop-swipe-bg{
  position: absolute;
  inset: 0;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding-right: 16px;
  user-select: none;
}

/* å‰æ™¯ï¼šå¯æ»‘å‹•å¡ç‰‡ */
.shop-swipe-fg{
  will-change: transform;
  transition: transform 180ms ease;
}

/* æ‰‹æ©Ÿæ»‘å‹•ç©©å®š */
.shop-swipe,
.shop-swipe-fg{
  touch-action: pan-y;
  user-select: none;
}

/* -------------------------
   Card style
-------------------------- */
.shop-card{
  background:#fff;
  border-radius: 8px;
  box-shadow: 0 0px 3px rgb(0 0 0 / 10%);
  padding: 0 12px;

  display:flex;
  gap: 15px;
  align-items:flex-start;
}

.shop-thumb{
  width: 100px;
  height: 120px;
  border-radius:8px;
  object-fit: cover;
  margin: auto;
  background: #eee;
  flex-shrink: 0;
}

.shop-fields{
  flex:1;
  display:flex;
  flex-direction: column;

  /* ä½ åŸæœ¬çš„è¦–è¦ºè·é›¢ */
  margin: 2rem auto;
  gap: 8px;
}

/* -------------------------
   Fields (icon left)
-------------------------- */
.shop-field{
  display:flex;
  align-items:center;
  gap:10px;
  min-width: 0;
}

.shop-icon{
  width: 18px;
  flex: 0 0 18px;
  text-align:center;
  color:#d95380;
  font-size:20px;
}

.shop-input{
  width: 100%;
  padding: 7px 10px;
  border: 1px solid #e6e6e6;
  border-radius: 5px;
  font-size: 16px;
  box-sizing: border-box;
}

.shop-field .shop-input{
  flex: 1 1 auto;
  min-width: 0;
}

/* åœ°é» + åƒ¹æ ¼åŒåˆ— */
.shop-row{
  display:flex;
  gap:12px;
}

.shop-field-location{ flex: 3 !important; }  /* åœ°é»å¯¬ */
.shop-field-price{    flex: 2 !important; }  /* åƒ¹æ ¼çª„ */

/* åƒ¹æ ¼æ¬„ä½æ–‡å­—å°é½Šï¼ˆä½ ç¾åœ¨å¸Œæœ› left å°± leftï¼‰ */
.shop-field-price .shop-input{ text-align: left; }

/* -------------------------
   Bought state (å®Œæˆæ¡è²·)
-------------------------- */
.shop-card.is-bought{
  border: 1px solid #d95380ab;
  background: #ffffff; /* ä¿æŒç™½åº•ï¼›ä½ æƒ³è¦æ·¡è‰²ä¹Ÿå¯ä»¥åŠ  */
}

.shop-card.is-bought .shop-thumb{
  opacity: 0.9;
}

/* -------------------------
   Fixed Total Bar (bottom) â€“ ONLY total
-------------------------- */
.shop-bottom-bar{
  position: fixed;
  left: 20px;
  right: 20px;
  bottom: calc(var(--bottom-nav-h) + var(--total-bar-gap));
  z-index: 999;

  display:flex;
  justify-content:flex-end;

  padding: 10px 12px;
  background: rgba(255,255,255,0.96);
  backdrop-filter: blur(6px);
  border-radius: 8px;
  box-shadow: 0 6px 18px rgba(0,0,0,0.10);
}

.shop-bottom-bar .shop-total{
  font-size: 16px;
  color:#444;
  text-align:right;
}

/* -------------------------
   Empty hint (optional)
-------------------------- */
.shop-empty{
  padding: 18px 6px;
  color: #777;
  text-align: center;
}

#shopTotal{margin: 1rem 0.3rem;}
/* Swipe å¤–å±¤ï¼šè² è²¬å¤–è§€ï¼ˆåœ“è§’ + é™°å½±ï¼‰ï¼ŒåŒæ™‚è£åˆ‡æ»‘å‹•å…§å®¹ */
.shop-swipe{
  position: relative;
  overflow: hidden;
  border-radius: 8px;

  /* âœ… æŠŠé™°å½±æ”¾åˆ°æœ€å¤–å±¤ï¼Œé™°å½±å°±ä¸æœƒè¢«å…§éƒ¨è£åˆ‡ */
  box-shadow: 0 0px 3px rgb(0 0 0 / 10%);
  background: transparent;
}

/* å¡ç‰‡æœ¬é«”ï¼šåªè² è²¬ç™½åº•èˆ‡å…§å®¹ï¼Œä¸è¦é™°å½± */
.shop-card{
  background:#fff;
  border-radius: 8px;  /* è®“å…§å®¹è§’è½ä¸€è‡´ */
  box-shadow: none;     /* âœ… ç§»é™¤åŸæœ¬é™°å½±ï¼Œé¿å…è¢«è£åˆ‡å¹²æ“¾ */
  padding: 0 12px;

  display:flex;
  gap: 20px;
  align-items:flex-start;
}

/* å‰æ™¯æ»‘å‹•å±¤ */
.shop-swipe-fg{
  will-change: transform;
  transition: transform 180ms ease;
}

/* å·²å®Œæˆç‹€æ…‹ï¼šåœ¨æœ€ä¸Šå±¤åŠ åŠé€æ˜é®ç½© */
.shop-swipe.is-bought::after{
  content: "";
  position: absolute;
  inset: 0;

  /* åŠé€æ˜å®Œæˆæ„Ÿï¼ˆå¯è‡ªè¡Œèª¿è‰²ï¼‰ */
  background: rgba(255, 255, 255, 0.9);

  /* è·Ÿå¡ç‰‡åœ“è§’ä¸€è‡´ */
  border-radius: 12px;

  /* è“‹åœ¨å…§å®¹ä¸Šï¼Œä½†ä¸æ“‹äº’å‹• */
  pointer-events: none;

  /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
  z-index: 2;
}


/* å·²è²·ç‹€æ…‹ï¼šå…§å±¤ä¸è¦å†ç•«é‚Šç·šï¼ˆé¿å…é›™æ¡†ï¼‰ */
.shop-card.is-bought{
  border: none;
}

#shopTotalTop{margin:1rem 0;}

/* ===== åœ–ç‰‡å…¨è¢å¹•é è¦½ ===== */
.shop-image-viewer{
  position: fixed;
  inset: 0;
  z-index: 2000;
}

.shop-image-viewer-bg{
  position: absolute;
  inset: 0;
  margin-top: -0.5rem;
  background: rgba(0,0,0,.7);
}

.shop-image-viewer-img{
  position: absolute;
        top: 30%;
        left: 50%;
        max-width: 92vw;
        max-height: 92vh;
        transform: translate(-50%, -50%);
        border-radius: 12px;
        box-shadow: 0 12px 40px rgba(0, 0, 0, .4);
}

/* é»æ“Šå¯é—œé–‰ */
.shop-image-viewer{
  cursor: zoom-out;
}
.shop-card.is-bought{
  opacity: 0.35 !important;
}

/* =========================================================
   Photo Pageï¼ˆå‡ºç‰‡åƒæ•¸ï¼‰- Swipe Gallery
========================================================= */
.photo-page{
  display:none;
  padding: 20px;
  padding-top: 90px;
  padding-bottom: 120px;
  background: #F6F9FC;
  animation: fadeIn 0.4s ease;
}

.photo-page .photo-title{
  font-size: 22px;
  font-weight: 700;
  color: #333;
  margin: 0 0 12px 0;
}

.photo-swiper{
  width: 100%;
  overflow-x: auto;
  display: flex;
  gap: 12px;
  scroll-snap-type: x mandatory;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-x;
  padding-bottom: 6px;
}

.photo-swiper::-webkit-scrollbar{ display:none; }

.photo-slide{
  flex: 0 0 100%;
  scroll-snap-align: center;
  background: #fff;
  margin-top: 0.5rem;
  border-radius: 8px;
  box-shadow: 0 0px 3px rgb(0 0 0 / 10%);
  overflow: hidden;
}

.photo-slide img{
  width: 100%;
  height: 320px;
  object-fit: cover;
  display: block;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  user-select: none;
  -webkit-user-drag: none;
}


.photo-meta{
  padding: 12px 14px;
}

.photo-meta .photo-name{
  font-size: 18px;
  font-weight: 700;
  color:#333;
  margin: 0 0 6px 0;
}

.photo-meta .photo-desc{
  font-size: 14px;
  color:#8e8e93;
  line-height: 1.5;
  margin: 0;
}

.photo-dots{
  display:flex;
  gap: 8px;
  justify-content:center;
  margin-top: 12px;
  margin-bottom: 1.5rem;
}


/* =========================================================
   Photo Page â€“ Video Links (text list)
========================================================= */
.photo-section-box{
  background:#fff;
  border-radius: 12px;
  box-shadow: 0 0px 3px rgb(0 0 0 / 10%);
  padding: 14px 14px;
  margin-top: 14px;
}
.photo-section-box .section-title{
  font-size: 16px;
  font-weight: 700;
  color:#333;
  margin: 0 0 10px 0;
}
.video-link-list{
  list-style: none;
  padding: 0;
  margin: 0.7rem 0 2rem 0;
  color: #333;
  display:flex;
  flex-direction: column;
  gap: 10px;
}
.video-link-list li a{
 display: block;
        padding: 14px 14px;
        border-radius: 8px;
        background: #ffffff;
        color: #333;
        box-shadow: 0 0px 3px rgb(0 0 0 / 10%);
        text-decoration: none;
        line-height: 1.35;
}
.video-link-list li a:active{
  transform: scale(0.99);
}
.video-link-sub{
  display:block;
  font-size: 12px;
  color:#8e8e93;
  margin-top: 4px;
}
.photo-dot{
  width: 8px;
  height: 8px;
  border-radius: 999px;
  background: rgba(0,0,0,0.18);
}

.photo-dot.active{
  background: rgba(58,122,254,0.9);
}

@media (max-width: 480px){
  .photo-slide img{ height: 260px; }
}

/* =========================================================
   Photo Viewer (Fullscreen)
========================================================= */
.photo-slide img{ cursor: zoom-in; }

.photo-viewer{
  position: fixed;
  inset: 0;
  z-index: 9999;
  display: none;
  /* ä»¥ viewport ç‚ºåŸºæº–ç½®ä¸­ï¼ˆæ‰‹æ©Ÿ/PWA æœ€ç©©ï¼‰ */
  align-items: center;
  justify-content: center;
}
.photo-viewer.is-open{ display: flex; }

.photo-viewer-bg{
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.85);
}

.photo-viewer-content{
  position: fixed;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  /* âœ… ä»¥ã€æ•´å€‹æ‰‹æ©Ÿå¯è¦–é«˜åº¦ã€ç½®ä¸­ï¼ˆä¸æ‰£ topbar/bottom navï¼‰ */
  box-sizing: border-box;
  padding: calc(env(safe-area-inset-top) + 12px) 12px calc(env(safe-area-inset-bottom) + 12px);
}

.photo-viewer-img{
  max-width: 100vw;
  /* âœ… ä»¥å‹•æ…‹ viewport é«˜åº¦ç‚ºæº–ï¼Œé¿å… iOS ä½å€åˆ—ä¼¸ç¸®é€ æˆåç§» */
  max-height: calc(100dvh - env(safe-area-inset-top) - env(safe-area-inset-bottom) - 24px);
  width: auto;
  height: auto;
  object-fit: contain;
  
  box-shadow: 0 18px 60px rgba(0,0,0,0.45);
  touch-action: pinch-zoom;
}

.photo-viewer-close{
          position: absolute;
        top: calc(var(--topbar-h) + env(safe-area-inset-top) + 12px);
        right: 14px;
        width: 44px;
        height: 44px;
        font-family: math;
        border-radius: 999px;
        border: none;
        background: rgba(255, 255, 255, 0.18);
        color: #fff;
        font-size: 25px;
        line-height: 44px;
        text-align: center;
        cursor: pointer;
        -webkit-tap-highlight-color: transparent;
}
.photo-viewer-close:active{ transform: scale(0.98); }


.photo-section-title{
          margin: 3rem 0 0.2rem 0;
        font-weight: 700;
        font-size: 18px;
        margin-top: 2rem;
}

..video-card-list{
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.video-card{
  display: block;
  padding: 16px 14px;
  border-radius: 14px;
  background: rgba(255,255,255,.75);
  box-shadow: 0 6px 18px rgba(0,0,0,.06);
  text-decoration: none;
  color: inherit;
}

.video-card:active{
  transform: scale(.98);
  box-shadow: 0 3px 10px rgba(0,0,0,.08);
}

.video-card-title{
  font-size: 14px;
  font-weight: 600;
  letter-spacing: .2px;
}


/* =========================
   iOS-like Photo Action Sheet (centered alert)
========================= */
.ios-alert-mask{
  position: fixed;
  inset: 0;
  z-index: 10001;
  display: none; /* open -> flex */
  align-items: center;
  justify-content: center;
  padding: 18px;
  background: rgba(0,0,0,.35);
  -webkit-tap-highlight-color: transparent;
}

.ios-alert{
         width: min(290px, 92vw);
        background: rgba(255, 255, 255, .95);
  border-radius: 14px;
  overflow: hidden;
  box-shadow: 0 12px 30px rgba(0,0,0,.25);
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);
}

.ios-alert-body{
  padding: 18px 16px 14px;
  text-align: center;
}

.ios-alert-title{
  font-size: 17px;
  font-weight: 700;
  line-height: 1.25;
  margin-bottom: 6px;
  color: #000;
}

.ios-alert-desc{
  font-size: 13px;
  line-height: 1.35;
  color: rgba(0,0,0,.65);
}

.ios-alert-btn{
  width: 100%;
  border: 0;
  background: transparent;
  padding: 15px 0;
	border-top: 1px solid rgba(0, 0, 0, .10);
  font-size: 17px;
  color: #007AFF;
  cursor: pointer;
  outline: none;
}

.ios-alert-btn + .ios-alert-btn{
  border-top: 1px solid rgba(0,0,0,.10);
}

.ios-alert-btn:active{
  background: rgba(0,0,0,.06);
}



.ios-alert-mask.is-open .ios-alert{
  animation: iosAlertIn .16s ease-out;
}

@keyframes iosAlertIn{
  from{ transform: scale(.98); opacity: 0; }
  to  { transform: scale(1);   opacity: 1; }
}

.section-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}

.btn-add-photo{
          border: 1px solid #007aff;
        background: rgba(255, 255, 255, .85);
        border-radius: 7px;
        padding: 4px 10px;
        font-size: 13px;
        color: #007aff;
        font-family: fangsong;
        cursor: pointer;
}

.btn-add-photo:active{
  background:rgba(0,0,0,.06);
}
#photo-page .photo-meta {
  display: none !important;
}



/* ===== Photo header actions (Add/Remove) ===== */
.section-head{display:flex;align-items:center;justify-content:space-between;gap:12px;}
.photo-section-actions{display:flex;gap:8px;align-items:center;}
.btn-remove-photo{
color: #d95380;
        border: 1px solid #d95380;
        background: rgba(255, 255, 255, .85);
        border-radius: 7px;
        padding: 4px 10px;
        font-size: 13px;
        /* color: #007aff; */
        font-family: fangsong;
        cursor: pointer;
}
.btn-remove-photo:active{background:rgba(0,0,0,.06);}

/* éš±è—ç…§ç‰‡ä¸‹æ–¹è³‡è¨Šï¼ˆphoto-metaï¼‰ */
#photo-page .photo-meta{display:none !important;}
		
.btn-add-video{        border: 1px solid #007aff;
        background: rgba(255, 255, 255, .85);
        border-radius: 7px;
        padding: 4px 10px;
        font-size: 16px;
        color: #007aff;
        font-family: fangsong;
        cursor: pointer;}

.btn-remove-video{
	        color: #d95380;
        border: 1px solid #d95380;
        background: rgba(255, 255, 255, .85);
        border-radius: 7px;
        padding: 4px 10px;
        font-size: 16px;
        /* color: #007aff; */
        font-family: fangsong;
        cursor: pointer;
}
</style>
</head>
<body>
	<div class="topbar" id="topbar">
  		<button class="menu-btn" id="menuBtn" aria-label="menu">
    		<div></div> <!-- é€™æ˜¯ä¸­é–“çš„ç·š -->
			<span class="icon-arrow-left"></span>
  		</button>
		
	</div>
	<nav class="bottom-nav">
		<button data-page="home-page" class="active">
		    <span class="icon-clipboard"></span>
		    <span class="label">è¡Œç¨‹</span>
		</button>
		<button data-page="flight-page">
		    <span class="icon-airplane"></span>
		    <span class="label">èˆªç­</span>
		</button>
		<button data-page="ticket-page">
		    <span class="icon-ticket"></span>
		    <span class="label">ç¥¨æ“š</span>
		</button>
		<button data-page="exchange-page">
		    <span class="icon-calculator"></span>
		    <span class="label">åŒ¯ç‡</span>
		</button>
		<button data-page="weather-page">
		    <span class="icon-leaf"></span>
		    <span class="label">å¤©æ°£</span>
		</button>
	</nav>

	<!-- iOS Full-Screen Menu -->
	<div class="ios-full-menu" id="iosFullMenu">
		<div class="menu-content">
			<ul>
              
              <li data-target="packing-page">è¡Œææ¸…å–®</li>
			  <li data-target="shopping-page">è³¼ç‰©æ¸…å–®</li>
              <li data-target="ticket-page">é›»å­ç¥¨æ“š</li>
              <li data-target="photo-page">å‡ºç‰‡åƒæ•¸</li>
              
			  <li data-target="weather-page">å¤©æ°£é å ±</li>
	    	</ul>
	  	</div>
		<button class="menu-close" id="menuClose">âœ•</button>
	</div>

	<!-- âœˆï¸ App å•Ÿå‹•ç•«é¢ -->
	<div id="app-splash">
		<div class="runway"></div>
 		<img src="images/flight.png" class="plane">
		<div class="splash-text">ç™½ã„å­£ç¯€ã«ã€æ‹ã‚’ã™ã‚‹</div>
	</div>

	<!-- åŸæœ¬æ•´å€‹ç¶²ç«™åŒ…èµ·ä¾† -->

	<div id="app-root">
		<button id="scrollToTop" class="scroll-top-button" aria-label="å›åˆ°é ‚éƒ¨">
			<span class="icon-arrow-thin-up"></span>
		</button>
		<div class="content-pages">
			<div id="home-page" class="container">
				<div class="day-tabs-wrapper">
					<div class="day-tabs-arrow left" id="arrow-left"><span class="icon-arrow-left"></span></div>
					<div class="day-tabs-scroll" id="dayTabsScroll">
                        <div class="day-tabs">
                            <button class="day-tab active" onclick="showDay(1)">ç¬¬ 1 å¤©</button>
                            <button class="day-tab" onclick="showDay(2)">ç¬¬ 2 å¤©</button>
                            <button class="day-tab" onclick="showDay(3)">ç¬¬ 3 å¤©</button>
                            <button class="day-tab" onclick="showDay(4)">ç¬¬ 4 å¤©</button>
                            <button class="day-tab" onclick="showDay(5)">ç¬¬ 5 å¤©</button>
                            <button class="day-tab" onclick="showDay(6)">ç¬¬ 6 å¤©</button>
                            <button class="day-tab" onclick="showDay(7)">ç¬¬ 7 å¤©</button>
                        </div>
                    </div>
					<div class="day-tabs-arrow right" id="arrow-right"><span class="icon-arrow-right"></span></div>
				</div>

    
    
                <!-- Day 1 -->
                <div class="day-section" id="day-1" style="display:block;">
                    <div class="day-label">2026.02.09ï¼ˆä¸€ï¼‰</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ¡ƒåœ’æ©Ÿå ´&travelmode=driving" target="_blank">
						<div class="activity-card">
                            <img src="images/1.png">
                            <div class="info">
                                <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;00:10</div>
                                <div class="title">æ¡ƒåœ’æ©Ÿå ´T1</div>
                                <div class="note">22:10&nbsp;&nbsp;å ±åˆ°è¨—é‹</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-airplane"></span> 2  å°æ™‚  30  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç¾½ç”°æ©Ÿå ´&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/2.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;04:00</div>
                              <div class="title">ç¾½ç”°æ©Ÿå ´T3</div>
                              <div class="note">06:15&nbsp;&nbsp;å ±åˆ°è¨—é‹</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-airplane"></span> 1  å°æ™‚  30  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ–°åƒæ­²æ©Ÿå ´&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/3.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;09:45</div>
                              <div class="title">æ–°åƒæ­²æ©Ÿå ´</div>
                              <div class="note">é ç•™1å°æ™‚å…¥å¢ƒ</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ä¸€å¹»æ‹‰éºµ æ–°åƒæ­²æ©Ÿå ´åº—, æ—¥æœ¬ã€’066-0012 Hokkaido, Chitose, Bibi, ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ“ãƒ« Domestic Terminal New Chitose Airport, 3F&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/4.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;11:00</div>
                              <div class="title">ä¸€å¹»æ‹‰éºµ</div>
                              <div class="note">åœç•™1å°æ™‚ç”¨é¤</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Kinotoya New Chitose Airport Factory, 2F Bibi, Chitose City, Hokkaido 066-0012&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/5.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;12:00</div>
                              <div class="title">Kinotoyaå†°æ·‡æ·‹</div>
                              <div class="note">æ­¥è¡Œè‡³2Fè³¼è²·</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-bus"></span> 1  å°æ™‚  20  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œç”±ç·£æº«æ³‰æ—…é¤¨ æ—¥æœ¬ã€’060-0001 Hokkaido, Sapporo, Chuo Ward, Kita 1 Jonishi, 7 Chomeâˆ’ï¼–&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/6.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;13:30</div>
                              <div class="title">ç”±ç·£æº«æ³‰æ—…é¤¨</div>
                              <div class="note">Checkin&å¯„æ”¾è¡Œæ</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-train"></span> 20  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=åŒ—æµ·é“å¤§å­¸&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/7.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;14:30</div>
                              <div class="title">åŒ—æµ·é“å¤§å­¸</div>
                              <div class="note">é›ªä¸­æ ¡åœ’æ•£æ­¥åŠæ‹ç…§</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-train"></span> 15  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ¹¯å’–å–± å¥¥èŠå•†åº— ç«™å‰å‰µæˆå¯º æ—¥æœ¬ã€’060-0004 Hokkaido, Sapporo, Chuo Ward, Kita 4 Jonishi, 1 Chome ãƒ›ã‚¯ãƒ¬ãƒ³ãƒ“ãƒ« B1F ãƒ‘ãƒ¼ãƒ«ã‚¿ã‚¦ãƒ³&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/8.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;17:00</div>
                              <div class="title">å¥§èŠå’–å“©</div>
                              <div class="note">åœç•™1å°æ™‚ç”¨é¤</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-bus"></span> 15  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œç”±ç·£æº«æ³‰æ—…é¤¨ æ—¥æœ¬ã€’060-0001 Hokkaido, Sapporo, Chuo Ward, Kita 1 Jonishi, 7 Chomeâˆ’ï¼–&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/9.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;18:30</div>
                              <div class="title">ç”±ç·£æº«æ³‰æ—…é¤¨</div>
                              <div class="note">å›æ—…é¤¨æ³¡æº«æ³‰ä¼‘æ¯</div>
                            </div>
                        </div>
                    </a>
                    
                </div> 
                
                
                <!-- Day 2 -->
                <div class="day-section" id="day-2" style="display:none;">
					<div class="day-label">2026.02.10ï¼ˆäºŒï¼‰</div>
                    <div class="activity-card">
                    	<img src="images/10.png">
                    	<div class="info">
                    		<div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;08:00</div>
                            <div class="title">æ—…é¤¨æ—©é¤</div>
                            <div class="note">éœ€æå‰åŠ è³¼ï¿¥3300</div>
                        </div>
                    </div>
                    <div class="transport-info"><span class="icon-travel-car"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œå¸‚ä¸­å¤®å€åŒ—ä¸€æ¢è¥¿1ä¸ç›®6è™Ÿ Sapporo Sosei Square åœ°ä¸‹2æ¨“&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/11-1.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;09:00</div>
                              <div class="title">Timesç§Ÿè»Š</div>
                              <div class="note">æ”œå¸¶ç§Ÿè»Šç›¸é—œæ–‡ä»¶åŠé§•ç…§</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 40  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=åœ‹ç‡Ÿç€§é‡éˆ´è˜­ä¸˜é™µå…¬åœ’ æ—¥æœ¬ã€’005-0862 Hokkaido, Sapporo, Minami Ward, Takino, 247&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/12.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;10:00</div>
                              <div class="title">ç€§é‡éˆ´è˜­ä¸˜é™µå…¬åœ’</div>
                              <div class="note">åœç•™4å°æ™‚éŠç©</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 35  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œé›»è¦–å¡” æ—¥æœ¬ã€’060-0042 Hokkaido, Sapporo, Chuo Ward, Odorinishi, 1 Chome&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/13.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;15:00</div>
                              <div class="title">æœ­å¹Œé›»è¦–å¡”</div>
                              <div class="note">åœç•™åŠå°æ™‚æ‹ç…§æ‰“å¡</div>
                            </div>
                        </div>
                    </a>
                     <div class="transport-info"><span class="icon-travel-walk"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œå¸‚æ™‚è¨ˆå° æ—¥æœ¬ã€’060-0001 Hokkaido, Sapporo, Chuo Ward, Kita 1 Jonishi, 2 Chome&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/14.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;15:30</div>
                              <div class="title">æœ­å¹Œè¨ˆæ™‚å°</div>
                              <div class="note">åœç•™åŠå°æ™‚æ‹ç…§æ‰“å¡</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=å¤§é€šå…¬åœ’ æ—¥æœ¬ã€’060-0042 Hokkaido, Sapporo, Chuo Ward, Odorinishi, ï¼‘ã€œï¼‘ï¼’ä¸ç›®&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/15.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;16:00</div>
                              <div class="title">å¤§é€šå…¬åœ’(æœ­å¹Œé›ªç¥­)</div>
                              <div class="note">åœç•™1å°æ™‚æ‹ç…§æ‰“å¡</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç‰›ã—ã‚ƒã¶ ç‰›ã™ã ç¦…, æ—¥æœ¬ã€’060-0062 Hokkaido, Sapporo, Chuo Ward, Minami 2 Jonishi, 1 Chome, å±±å£ä¸­å¤®ãƒ“ãƒ«åœ°ä¸‹&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/16.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;17:00</div>
                              <div class="title">ç‰›ã—ã‚ƒã¶ç¦ª</div>
                              <div class="note">å’Œç‰›æ”¾é¡Œ/å–®é»å£½å–œç‡’</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 6  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç‹¸å°è·¯å•†åº—è¡— æ—¥æœ¬ã€’060-0062 Hokkaido, Sapporo, Chuo Ward, å—2ãƒ»3æ¡è¥¿1ï½7ä¸ç›®&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/17.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;19:00</div>
                              <div class="title">ç‹¸å°è·¯å•†åº—è¡—</div>
                              <div class="note">åœç•™2å°æ™‚é€›è¡—æ¡è³¼</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-walk"></span> 6  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Parfaiteria Pal, å—ï¼”è¥¿ï¼’ãƒ“ãƒ« 6F 2 Chome-10-1 Minami 4 Jonishi, Chuo Ward, Sapporo, Hokkaido 064-0804æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/61.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;21:00</div>
                              <div class="title">å¤œãƒ‘ãƒ•ã‚§</div>
                              <div class="note">ä½è—¤å¥å»éçš„æ·±å¤œç”œé»åº—</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œç”±ç·£æº«æ³‰æ—…é¤¨ æ—¥æœ¬ã€’060-0001 Hokkaido, Sapporo, Chuo Ward, Kita 1 Jonishi, 7 Chomeâˆ’ï¼–&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/18.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;22:00</div>
                              <div class="title">ç”±ç·£æº«æ³‰æ—…é¤¨</div>
                              <div class="note">å›æ—…é¤¨ä¼‘æ¯</div>
                            </div>
                        </div>
                    </a>
                   
                </div>
                <!-- Day 3 -->
                <div class="day-section" id="day-3" style="display:none;">
                	<div class="day-label">2026.02.11ï¼ˆä¸‰ï¼‰</div>
                    <div class="activity-card">
                    	<img src="images/19.png">
                        <div class="info">
                        	<div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;07:00</div>
                            <div class="title">ç”±ç·£æº«æ³‰æ—…é¤¨</div>
                            <div class="note">å¯æå‰æº–å‚™è¶…å•†æ—©é¤</div>
                        </div>
                    </div>
                    <div class="transport-info"><span class="icon-travel-car"></span> 3  å°æ™‚</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç¾ç‘›ç¥ç¤¾ æ—¥æœ¬ã€’071-0213 Hokkaido, Kamikawa District, Biei, Higashimachi, 4 Chomeâˆ’1âˆ’1&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/20.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;10:00</div>
                              <div class="title">ç¾ç‘›ç¥ç¤¾</div>
                              <div class="note">åœç•™1å°æ™‚åƒæ‹œæ‹ç…§</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-car"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Biei 2 go, æ—¥æœ¬ã€’071-0203 Hokkaido, Kamikawa District, Biei, Nishimachi, 1 Chomeâˆ’2âˆ’10&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/22.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;11:30</div>
                              <div class="title">Biei2GOè¼•é£Ÿ</div>
                              <div class="note">æ¨è±¬æ’ä¸‰æ˜æ²»è·Ÿç„—çƒ¤éºµï¼</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Christmas tree, Bibaushi, Biei, Kamikawa District, Hokkaido, æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/23.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;13:00</div>
                              <div class="title">ç¾ç‘›è–èª•æ¨¹</div>
                              <div class="note">åœç•™1å°æ™‚æ‹ç…§æ‰“å¡</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 30  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç™½é¬šç€‘å¸ƒ æ—¥æœ¬ã€’071-0235 Hokkaido, Kamikawa District, Biei, Shirogane&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/24.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;15:00</div>
                              <div class="title">ç™½é¬šç€‘å¸ƒ</div>
                              <div class="note">åœç•™åŠå°æ™‚æ‹ç…§æ‰“å¡</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-car"></span> 3  å°æ™‚</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ—­å·æˆå‰æ€æ±—å¤§é»‘å±‹ æœ­å¹Œ1è™Ÿåº— æ—¥æœ¬ã€’064-0804 Hokkaido, Sapporo, Chuo Ward, Minami 4 Jonishi, 2 Chomeâˆ’10âˆ’1 å—ï¼”è¥¿ï¼’ãƒ“ãƒ« 2éš&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/26.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;20:00</div>
                              <div class="title">æˆå‰æ€æ±—å¤§é»‘å±‹</div>
                              <div class="note">æœ­å¹Œè‘—åçƒ¤ç¾Šè‚‰</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 8  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œç”±ç·£æº«æ³‰æ—…é¤¨ æ—¥æœ¬ã€’060-0001 Hokkaido, Sapporo, Chuo Ward, Kita 1 Jonishi, 7 Chomeâˆ’ï¼–&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/27.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;21:30</div>
                              <div class="title">ç”±ç·£æº«æ³‰æ—…é¤¨</div>
                              <div class="note">å›æ—…é¤¨ä¼‘æ¯</div>
                            </div>
                        </div>
                    </a>
                    
                </div>
            
                <!-- Day 4 -->
				 <div class="day-section" id="day-4" style="display:none;">
                	<div class="day-label">2026.02.12ï¼ˆå››ï¼‰</div>
                    <div class="activity-card">
                    	<img src="images/28.png">
                        <div class="info">
                        	<div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;10:00</div>
                            <div class="title">ç”±ç·£æº«æ³‰æ—…é¤¨</div>
            				<div class="note">Checkout</div>
                        </div>
                    </div>
                    <div class="transport-info"><span class="icon-travel-car"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ãƒ™ãƒƒã‚»ãƒ«ãƒ›ãƒ†ãƒ«ã‚«ãƒ³ãƒ‘ãƒ¼ãƒŠã™ã™ãã® æ—¥æœ¬ã€’064-0805 Hokkaido, Sapporo, Chuo Ward, Minami 5 Jonishi, 6 Chomeâˆ’16ç•ªåœ°1&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/29.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;10:30</div>
                              <div class="title">Vessel Hotel</div>
                              <div class="note">å¯„æ”¾è¡Œæ</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-car"></span> 18  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=åŒ—æµ·é“ç¥å®® æ—¥æœ¬ã€’064-0959 Hokkaido, Sapporo, Chuo Ward, Miyagaoka, 474&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/42.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;11:00</div>
                              <div class="title">åŒ—æµ·é“ç¥å®®</div>
                              <div class="note">åœç•™1å°æ™‚æ‹ç…§æ‰“å¡</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-car"></span> 8  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=è¿´è½‰å£½å¸ Toriton åœ“å±±åº— æ—¥æœ¬ã€’064-0824 Hokkaido, Sapporo, Chuo Ward, Kita 4 Jonishi, 23 Chomeâˆ’2âˆ’17&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/72.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;13:00</div>
                              <div class="title">Toriton åœ“å±±åº—</div>
                              <div class="note">åƒåƒè¿´è½‰å£½å¸</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-car"></span> 13  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ—­å±±ç´€å¿µå…¬åœ’ æ—¥æœ¬ã€’064-0943 Hokkaido, Sapporo, Chuo Ward, Sakaigawa, 4 Chomeâˆ’1âˆ’3&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/71.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;14:30</div>
                              <div class="title">æ—­å±±ç´€å¿µå…¬åœ’</div>
                              <div class="note">è˜‡å…ˆç”ŸæŒ‡å®šæ™¯é»</div>
                            </div>
                        </div>
                    </a>
                    
					<div class="transport-info"><span class="icon-travel-car"></span> 20  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç™½è‰²æˆ€äººå…¬åœ’ æ—¥æœ¬ã€’063-0052 Hokkaido, Sapporo, Nishi Ward, Miyanosawa 2 Jo, 2 Chomeâˆ’11âˆ’36&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/70.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;17:00</div>
                              <div class="title">ç™½è‰²æˆ€äººå…¬åœ’</div>
                              <div class="note">åœ’å€æ‹æ‹ç…§è²·ç´€å¿µå“</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-car"></span> 30  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ãƒ™ãƒƒã‚»ãƒ«ãƒ›ãƒ†ãƒ«ã‚«ãƒ³ãƒ‘ãƒ¼ãƒŠã™ã™ãã® æ—¥æœ¬ã€’064-0805 Hokkaido, Sapporo, Chuo Ward, Minami 5 Jonishi, 6 Chomeâˆ’16ç•ªåœ°1&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/45.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;20:00</div>
                              <div class="title">Vessel Hotel</div>
                              <div class="note">å›æ—…é¤¨ä¼‘æ¯</div>
                            </div>
                        </div>
                   </a>
                   <div class="transport-info"><span class="icon-travel-walk"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ç‚¸è±¬æ’ æª æœ­å¹Œè–„é‡åº— æ—¥æœ¬ã€’060-0063 Hokkaido, Sapporo, Chuo Ward, Minami 3 Jonishi, 2 Chomeâˆ’7-1&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/73.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;20:00</div>
                              <div class="title">ç‚¸è±¬æ’æª</div>
                              <div class="note">æ™šé¤åƒåƒè±¬æ’è®šå•¦</div>
                            </div>
                        </div>
                    </a>
                    
                    
                    
                </div>
               
                 
                <!-- Day 5 -->
	            <div class="day-section" id="day-5" style="display:none;">
                	<div class="day-label">2026.02.13ï¼ˆäº”ï¼‰</div>
                    <div class="activity-card">
                    	<img src="images/39.png">
                        <div class="info">
                            <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;08:30</div>
                            <div class="title">Vessel Hotel</div>
                            <div class="note">æ–°çš„ä¸€å¤©åˆé–‹å§‹äº†ï¼</div>
                        </div>
                    </div>
					<div class="transport-info"><span class="icon-travel-car"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œå¸‚ä¸­å¤®å€åŒ—ä¸€æ¢è¥¿1ä¸ç›®6è™Ÿ Sapporo Sosei Square åœ°ä¸‹2æ¨“&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/11-1.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;09:00</div>
                              <div class="title">Timesç§Ÿè»Š</div>
                              <div class="note">éœ€æå‰åŠ å¥½æ²¹å†é‚„è»Š</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-bus"></span> 1  å°æ™‚</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ—¥æœ¬åŒ—æµ·é“å°æ¨½å¸‚ Asari, 1 Chomeâˆ’5, æœé‡Œé§…&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/30.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;10:00</div>
                              <div class="title">å°æ¨½æœé‡Œç«™</div>
                              <div class="note">æœ­å¹Œè»Šç«™æ­JR</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 50  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ°‘å®¿ é’å¡šé£Ÿå ‚ 3 Chome-210 Shukutsu, Otaru, Hokkaido 047-0047æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/31.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;12:00</div>
                              <div class="title">é’å¡šé£Ÿå ‚</div>
                              <div class="note">å®¶åº­å¼å±…é…’å±‹åƒåˆé¤</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=å°æ¨½æ°´æ—é¤¨ æ—¥æœ¬ã€’047-0047 Hokkaido, Otaru, Shukutsu, 3 Chomeâˆ’303&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/32.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;13:00</div>
                              <div class="title">å°æ¨½æ°´æ—é¤¨</div>
                              <div class="note">ä¼éµæ•£æ­¥13:30/14:40å ´æ¬¡</div>
                            </div>
                        </div>
                    </a>
                    
                    <div class="transport-info"><span class="icon-travel-bus"></span> 25  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Sakaimachi Street, 6-11 Sakaimachi, Otaru, Hokkaido 047-0027æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/34.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;16:30</div>
                              <div class="title">å°æ¨½å•†åº—è¡—</div>
                              <div class="note">é™„è¿‘æœ‰éŸ³æ¨‚ç›’å ‚é€›é€›</div>
                            </div>
                        </div>
                    </a>
                    
                    <div class="transport-info"><span class="icon-travel-walk"></span> 10  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=å°æ¨½é‹æ²³, æ—¥æœ¬åŒ—æµ·é“å°æ¨½å¸‚&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/36.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;18:00</div>
                              <div class="title">å°æ¨½é‹æ²³</div>
                              <div class="note">é™å®šé›ªç‡ˆä¹‹è·¯ç¥­å…¸</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-car"></span> 70  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ãƒ™ãƒƒã‚»ãƒ«ãƒ›ãƒ†ãƒ«ã‚«ãƒ³ãƒ‘ãƒ¼ãƒŠã™ã™ãã® æ—¥æœ¬ã€’064-0805 Hokkaido, Sapporo, Chuo Ward, Minami 5 Jonishi, 6 Chomeâˆ’16ç•ªåœ°1&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/37.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;20:30</div>
                              <div class="title">Vessel Hotel</div>
                              <div class="note">å›æ—…é¤¨ä¼‘æ¯</div>
                            </div>
                        </div>
                    </a>
                   <div class="transport-info"><span class="icon-travel-walk"></span> 5  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=VESSEL HOTEL CAMPANA SUSUKINO, 6 Chome-16ç•ªåœ°1 Minami 5 JÅnishi, ä¸­å¤®å€æœ­å¹Œå¸‚åŒ—æµ·é“æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/69.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;21:00</div>
                              <div class="title">é¤ƒå­ã®å±±å²¡å®¶</div>
                              <div class="note">å‡ºé–€è¦“é£Ÿå®µå¤œ</div>
                            </div>
                        </div>
                    </a>
                    
                 </div>
                <!-- Day 6 -->
                <div class="day-section" id="day-6" style="display:none;">
                	<div class="day-label">2026.02.14ï¼ˆå…­ï¼‰</div>
                    <div class="activity-card">
                    	<img src="images/56.png">
                        <div class="info">
                            <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;09:00</div>
                            <div class="title">Vessel Hotel</div>
                            <div class="note">é£¯åº—è‡ªåŠ©æ—©é¤(ï¿¥2300)</div>
                    	</div>
                    </div>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 2  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Jozankei Daiichi Hotel Suizantei, å®šå±±æ¸“ç¬¬ä¸€å¯¶äº­ç•™ç¿ å±±äº­ å†…1éš 3 Chome-105 Jozankeionsennishi, Minami Ward, Sapporo, Hokkaido 061-2303æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/62.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;10:38</div>
                              <div class="title">è–„é‡ç«™</div>
                              <div class="note">ç›´é”ç¬¬ä¸€é£¯åº—å‰</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-bus"></span> 60  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=Jozankei Daiichi Hotel Suizantei, å®šå±±æ¸“ç¬¬ä¸€å¯¶äº­ç•™ç¿ å±±äº­ å†…1éš 3 Chome-105 Jozankeionsennishi, Minami Ward, Sapporo, Hokkaido 061-2303æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/63.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;12:00</div>
                              <div class="title">Jozankei Daiichi</div>
                              <div class="note">é ç´„åˆ¶ç§æ¹¯(ï¿¥8800)</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-travel-walk"></span> 2  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ãµã‚‹å· æœæ—¥ J.glacÃ©e, æ—¥æœ¬ã€’061-2303 Hokkaido, Sapporo, Minami Ward, JÅzankei, è¥¿4ä¸ç›®356ç•ªåœ°&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/64.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;14:30</div>
                              <div class="title">J.glacÃ©e</div>
                              <div class="note">æœ‰åçš„è˜‹æœæ´¾ç”œé»åº—</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-walk"></span> 3  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=å®šå±±æºªäºŒè¦‹å…¬åœ’ æ—¥æœ¬ã€’061-2303 Hokkaido, Sapporo, Minami Ward, Jozankeionsennishi, 4 Chome&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/62.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;15:00</div>
                              <div class="title">äºŒè¦‹å…¬åœ’</div>
                              <div class="note">æ²¿é€”æ•£æ­¥åˆ°åŠæ©‹</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-walk"></span> 0  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=å®šå±±æ¸“å¤§æ©‹ 2 Chome Jozankeionsenhigashi, Minami Ward, Sapporo, Hokkaido 061-2303æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/65.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;16:08</div>
                              <div class="title">å®šå±±æºªå¤§æ©‹</div>
                              <div class="note">æå‰ååˆ†é˜ç­‰æ¥é§å·´å£«</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-bus"></span> 60  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æœ­å¹Œè»Šç«™ 4 Chome Kita 6 Jonishi, Kita Ward, Sapporo, Hokkaido 060-0806æ—¥æœ¬&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/66.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;17:30</div>
                              <div class="title">æœ­å¹Œè»Šç«™</div>
                              <div class="note">é€›é€›+åƒé»å¿ƒ</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-train"></span> 15  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=ãƒ™ãƒƒã‚»ãƒ«ãƒ›ãƒ†ãƒ«ã‚«ãƒ³ãƒ‘ãƒ¼ãƒŠã™ã™ãã® æ—¥æœ¬ã€’064-0805 Hokkaido, Sapporo, Chuo Ward, Minami 5 Jonishi, 6 Chomeâˆ’16ç•ªåœ°1&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/45.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;19:30</div>
                              <div class="title">Vessel Hotel</div>
                              <div class="note">å›æ—…é¤¨ä¼‘æ¯</div>
                            </div>
                        </div>
                    </a>
					<div class="transport-info"><span class="icon-travel-walk"></span> 1  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=RAZAN Charcoal-Grilled Wagyu Yakiniku Susukino Branch&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/46.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;20:00</div>
                              <div class="title">RAZAN ç‚­ç«ç‡’è‚‰</div>
                              <div class="note">å°šæœªè¨‚ä½</div>
                            </div>
                        </div>
                    </a>
                </div>
                <!-- Day 7 -->
                <div class="day-section" id="day-7" style="display:none;">
                	<div class="day-label">2026.02.15ï¼ˆæ—¥ï¼‰</div>
                    <div class="activity-card">
                    	<img src="images/47.png">
                        <div class="info">
                        	<div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;07:30</div>
                            <div class="title">Vessel Hotel</div>
                            <div class="note">æº–å‚™æ”¶æ‹¾è¡Œæå›å®¶å•¦</div>
                        </div>
                    </div>
                    <div class="transport-info"><span class="icon-travel-bus"></span> 1  å°æ™‚ 20 åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=æ–°åƒæ­²æ©Ÿå ´&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/3.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;08:00</div>
                              <div class="title">æ–°åƒæ­²æ©Ÿå ´</div>
                              <div class="note">æå‰è‡³æ©Ÿå ´æœ€å¾Œæ¡è³¼</div>
                            </div>
                        </div>
                    </a>
                    <div class="transport-info"><span class="icon-airplane"></span> 4  å°æ™‚ 55  åˆ†</div>
                    <a href="https://www.google.com/maps/dir/?api=1&destination=è‡ºç£æ¡ƒåœ’åœ‹éš›æ©Ÿå ´&travelmode=driving" target="_blank">
                        <div class="activity-card">
                            <img src="images/1.png">
                            <div class="info">
                              <div class="time"><span class="icon-watch"></span>&nbsp;&nbsp;16:05</div>
                              <div class="title">æ¡ƒåœ’æ©Ÿå ´T2</div>
                              <div class="note">æ­¡è¿æ­¸åœ‹ï¼Œå¿«æ¨‚è¿æ¥éå¹´ï¼</div>
                            </div>
                        </div>
                    </a>
                    
                </div>
				
            </div>
	
            <!-- ================================
                   åŒ¯ç‡æ›ç®—é é¢ï¼ˆæ•´ç†å¾Œï¼‰
            ================================ -->
            <div id="exchange-page" class="exchange-page">
            	<div class="exchange-inner">
          			<div class="converter">
						<!-- â­ å¹£åˆ¥åˆ‡æ›é–‹é—œ -->
                        <div class="toggle-switch" id="currencyToggle">
 							<div class="toggle-track">
								<div class="toggle-thumb"></div>
							</div>
							<span class="toggle-label" id="toggle-label">JPY</span>
						</div>
	
						<!-- â­ è¼¸å…¥é‡‘é¡ï¼ˆå·²ä¿®æ­£ï¼‰ -->
                        <div class="input-group">
							<div class="input-wrapper">
								<input type="text" id="input-amount" placeholder="è¼¸å…¥é‡‘é¡" inputmode="numeric" autocomplete="off">
								<span class="currency-label" id="input-label">ï½œ æ—¥åœ“</span>
							</div>
                        </div>
	
                        <!-- â­ æ›ç®—çµæœï¼ˆå·²ä¿®æ­£ï¼‰ -->
                        <div class="input-group">
							<div class="input-wrapper">
								<input type="text" id="output-amount" placeholder="æ›ç®—çµæœ" readonly>
                            	<span class="currency-label" id="output-label">ï½œ å°å¹£</span>
							</div>
                        </div>
					</div>
	
					<!-- â­ æ•¸å­—éµç›¤ -->
					<div class="num-pad">
						<button class="key">1</button>
                        <button class="key">2</button>
                        <button class="key">3</button>
                    
                        <button class="key">4</button>
                        <button class="key">5</button>
                        <button class="key">6</button>
                    
                        <button class="key">7</button>
                        <button class="key">8</button>
                        <button class="key">9</button>
                    
                        <button class="key gray">0</button>
                        <button class="key orange">C</button>
                        <button class="key orange">â†</button>
					</div>
				</div>
			</div>
            
            <!-- ================================
                  è¡Œææ¸…å–®é é¢
            ================================ -->
            <div id="packing-page" class="packing-page" ></div>
            <div id="packing-edit-bar" style="display:flex;justify-content:flex-end;margin-bottom: 5px;margin-top: 5px;"></div>
            
            <!-- === è¡Œææ¸…å–®é€šç”¨ Modalï¼ˆè«‹å‹™å¿…æ”¾åœ¨ body æœ€åº•éƒ¨ï¼‰ === -->
            <div id="itemModal" class="modal-overlay" style="display:flex; display:none;">
				<div class="modal-box">
                    <h3 id="modalTitle">æ–°å¢é …ç›®</h3>
                    <input id="modalInput" type="text" placeholder="è¼¸å…¥åç¨±â€¦" />
                    <div class="modal-buttons">
						<button id="modalCancel">å–æ¶ˆ</button>
						<button id="modalOK">ç¢ºå®š</button>
  					</div>
				</div>
            </div>


			<!-- === é›»å­æ†‘è­‰ï¼ˆè«‹å‹™å¿…æ”¾åœ¨ body æœ€åº•éƒ¨ï¼‰ === -->
            <div id="ticket-page" class="ticket-page">
				<div class="ticket-category-list">
					
						<div class="ticket-category bg-blue" data-target="hotel" id="hotel">
							<div class="icon">
								<img src="images/57.png" alt="folder">
							</div>
							<div class="text">
								<span class="title">é£¯åº—ä½å®¿</span>
							</div>
							<div class="more">â‹®</div>
						</div>
					
					
					<div class="ticket-category bg-red" data-target="schedule">
						<div class="icon">
							<img src="images/59.png" alt="folder">
						</div>
						<div class="text">
							<span class="title">ä¸€æ—¥è¡Œç¨‹</span>
						</div>
						<div class="more">â‹®</div>
					</div>
					<div class="ticket-category bg-green" data-target="rentcar">
						<div class="icon">
							<img src="images/60.png" alt="folder">
						</div>
						<div class="text">
							<span class="title">ç§Ÿè»Šé è¨‚</span>
						</div>
						<div class="more">â‹®</div>
                    </div>
					<div class="ticket-category bg-purple" data-target="entry">
						<div class="icon">
							<img src="images/67.png" alt="folder">
						</div>
						<div class="text">
							<span class="title">å…¥å¢ƒå¯©æŸ¥</span>
						</div>
						<div class="more">â‹®</div>
					</div>
					<div class="ticket-category bg-yellow" data-target="restaurant">
						<div class="icon">
							<img src="images/58.png" alt="folder">
						</div>
						<div class="text">
							<span class="title">é¤å»³é è¨‚</span>
						</div>
						<div class="more">â‹®</div>
					</div>
				</div>
				<!-- å…§å®¹é  -->
				<div id="ticketContent" class="ticket-content hidden">
					<h3 id="ticketContentTitle"></h3>
					<div id="ticketContentBody"></div>
				</div>
            </div>
			<div id="flight-page" class="ticket-page" style="display:none;">
				<div class="ticket-category-list" id="flightStandalone"></div>
			</div>
			
            <!-- Photo Page (å‡ºç‰‡åƒæ•¸) -->
            <div id="photo-page" class="photo-page" style="display:none;">
				<div class="section-head">
				  <div class="photo-section-title" style="margin: 0.5rem 0 0.2rem 0;">Dazzæ¿¾é¡</div>
				  <div class="photo-section-actions">
  <button class="btn-add-photo" type="button" data-add-album="1">ï¼‹ æ–°å¢</button>
  <button class="btn-remove-photo" type="button" data-remove-album="1">ç§»é™¤</button>
</div>
				</div>

				
				<div id="photoSwiper" class="photo-swiper" aria-label="ç›¸ç‰‡ç€è¦½å™¨">
                    <!-- âœ… ä½ è¦æ”¾çš„åœ–ç‰‡ï¼šåœ¨ä¸‹æ–¹ JS çš„ PHOTO_ITEMS ç›´æ¥åŠ /æ”¹å³å¯ -->
                </div>
                <div id="photoDots" class="photo-dots" aria-label="é é¢æŒ‡ç¤º"></div>
				<!-- Photo Viewer (full screen) -->
            	<div id="photoViewer" class="photo-viewer" aria-hidden="true">
              		<div class="photo-viewer-bg" data-close="1"></div>
              		<div class="photo-viewer-content">
                		<img id="photoViewerImg" class="photo-viewer-img" src="" alt="">
                		<button class="photo-viewer-close" type="button" aria-label="é—œé–‰" data-close="1">Ã—</button>
              		</div>
            	</div>
				<!-- ç¬¬äºŒå€‹ç›¸ç°¿ï¼ˆæ–°å¢ï¼‰ -->
				<div class="photo-section">
					<div class="section-head">
					  <div class="photo-section-title">æ§‹åœ–åƒè€ƒ</div>
					  <div class="photo-section-actions">
  <button class="btn-add-photo" type="button" data-add-album="2" style="margin-top: 1.3rem;">ï¼‹ æ–°å¢</button>
  <button class="btn-remove-photo" type="button" data-remove-album="2" style="margin-top: 1.3rem;">ç§»é™¤</button>
</div>
					</div>
					
					<div id="photoSwiper2" class="photo-swiper"></div>
					<div id="photoDots2" class="photo-dots"></div>
				</div>
				<!-- å½±ç‰‡ç›¸ç°¿ï¼ˆæ–°å¢ï¼‰ -->
				<div class="section-head">
					<div class="photo-section-title">çŸ­å½±éŸ³åƒè€ƒ</div>
					<div class="video-section-actions">
  						<button class="photo-btn-action btn-add-video" type="button">ï¼‹ æ–°å¢</button>
  						<button class="photo-btn-action danger btn-remove-video" type="button">ç§»é™¤</button>
					</div>
				</div>
				<ul id="videoLinkList" class="video-link-list"></ul>
			<!-- é•·æŒ‰æ›´æ›åœ–ç‰‡ç”¨ï¼ˆéš±è—é¸åœ–ï¼‰ -->
			<input id="photoReplaceInput" type="file" accept="image/*" hidden>
			<!-- æ–°å¢åœ–ç‰‡ç”¨ï¼ˆéš±è—é¸åœ–ï¼Œå¯å¤šé¸ï¼‰ -->
			<input id="photoAddInput" type="file" accept="image/*" multiple hidden>


			</div>
			
			<!-- Shopping Page -->
	      	<div id="shopping-page" class="content-page shopping-page">
				<div id="shoppingRoot" style="    margin-top: 5rem;"></div>
			</div>
			
			<!-- Weather Page -->
			<div id="weather-page" class="weather-page" style="display:none;">
				<div id="wxLoading" class="wx-loading">
					<div class="wx-loading-box">
						<div class="wx-loading-spinner"></div>
						<div class="wx-loading-text">å¤©æ°£è¼‰å…¥ä¸­â€¦</div>
					</div>
				</div>
				<div class="wx-content">
				  	<div class="wx-wrap">
						<div class="wx-dots" id="wxDots" aria-label="åˆ‡æ›åœ°å€"></div>
						<div class="wx-hero">
					    	<div class="wx-city" id="wxCity">æœ­å¹Œå¸‚</div>
							<div class="wx-temp-center">
					        	<span id="wxTemp">--</span>
							</div>
							<div class="wx-desc" id="wxDesc">--</div>
							<div class="wx-hilo" id="wxHiLo">æœ€é«˜ --Â° / æœ€ä½ --Â°</div>
						</div>
						<div class="wx-card">
							<div class="wx-hourly-note" id="wxHourlyNote">è¼‰å…¥ä¸­â€¦</div>
							<div class="wx-hourly" id="wxHourly"></div>
						</div>
						<div class="wx-card">
							<div class="wx-card-title"><span class="icon-calendar1"></span> æœ¬é€±å¤©æ°£é å ±</div>
							<div class="wx-week" id="wxWeek"></div>
						</div>
						<div style="height:18px;"></div>
					</div>
				</div>
			</div>

			
		</div>
		
        
</div>	
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
<!-- Firebase compat (NON-module) -->
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore-compat.js"></script>


 
<script>
		let isFirstHomeRender = true;
		let originalTicketCategoryHTML = "";
		let navMode = "menu"; // menu | back

		
		document.addEventListener("DOMContentLoaded", () => {
			navBtn = document.getElementById("navBtn");
			const list = document.querySelector(".ticket-category-list");
			if (list) {
				originalTicketCategoryHTML = list.innerHTML;
			}
		
			getExchangeRate();
			showDay(1);
			updateArrows();
		});
		
		
		// ===========================
		// 1. è¡Œç¨‹åˆ‡æ›
		// ===========================
		function showDay(dayNumber, dir = "right") {
			  const sections = document.querySelectorAll(".day-section");
			  const tabs = document.querySelectorAll(".day-tab");
			
			  sections.forEach((section, index) => {
			    if (index === dayNumber - 1) {
			      section.style.display = "block";
			
			      // å…ˆæ¸…æ‰èˆŠå‹•ç•« classï¼Œç¢ºä¿å¯é‡æ’­
			      section.classList.remove("day-anim-right", "day-anim-left");
			      void section.offsetWidth;
			
			      // ä¾æ–¹å‘å¥—å‹•ç•«
			      section.classList.add(dir === "left" ? "day-anim-left" : "day-anim-right");
			
			    } else {
			      section.style.display = "none";
			      section.classList.remove("day-anim-right", "day-anim-left");
			    }
			  });
			
			  // ä¸Šæ–¹ tab active
			  tabs.forEach((tab, index) => {
			    tab.classList.toggle("active", index === dayNumber - 1);
			  });
			
			  // â­ å¦‚æœä½ æœ‰åŠ æˆ‘å‰é¢é‚£å€‹ syncDayTabsï¼Œè¨˜å¾—ä¿ç•™
			  if (typeof syncDayTabs === "function") syncDayTabs(dayNumber);
			
			 const home = document.getElementById("home-page");
			if (home) home.scrollTo({ top: 0, behavior: "smooth" });

		}

		
		function syncDayTabs(dayNumber) {
			  const scrollEl = document.getElementById("dayTabsScroll");
			  const tabs = document.querySelectorAll("#dayTabsScroll .day-tab");
			  if (!tabs.length) return;
			
			  // 1) active æ¨£å¼åŒæ­¥
			  tabs.forEach((tab, idx) => tab.classList.toggle("active", idx === dayNumber - 1));
			
			  // 2) æ²åˆ°å¯è¦–ç¯„åœï¼ˆç½®ä¸­ï¼‰
			  const activeTab = tabs[dayNumber - 1];
			  if (scrollEl && activeTab) {
			    const left = activeTab.offsetLeft - (scrollEl.clientWidth / 2) + (activeTab.clientWidth / 2);
			    scrollEl.scrollTo({ left: Math.max(0, left), behavior: "smooth" });
			  }
			
			  // 3) ä½ æœ‰å·¦å³ç®­é ­çš„è©±ï¼Œé †ä¾¿æ›´æ–°
			  if (typeof updateArrows === "function") updateArrows();
			}

		// ===========================
		// 2. Day Tabs å·¦å³ç®­é ­
		// ===========================
		const scrollEl  = document.getElementById("dayTabsScroll");
		const arrowLeft = document.getElementById("arrow-left");
		const arrowRight = document.getElementById("arrow-right");
		
		function updateArrows() {
			
			if (!scrollEl || !arrowLeft || !arrowRight) return;  // âœ… åŠ é€™è¡Œ
			const max = scrollEl.scrollWidth - scrollEl.clientWidth;
			arrowLeft.style.opacity  = scrollEl.scrollLeft > 10 ? "1" : "0";
			arrowRight.style.opacity = scrollEl.scrollLeft < max - 10 ? "1" : "0";
		}
		
		if (scrollEl) {
			scrollEl.addEventListener("scroll", updateArrows);
			window.addEventListener("resize", updateArrows);
		}
		
		
		// ===========================
		// 4. åŒ¯ç‡æ›ç®—
		// ===========================
		let currentRate = 0;
		let isJPYtoTWD = true;
		
		const inputField  = document.getElementById("input-amount");
		const outputField = document.getElementById("output-amount");
		const toggleBtn   = document.getElementById("currencyToggle");
		const toggleLabel = document.getElementById("toggle-label");
		const inputLabel  = document.getElementById("input-label");
		const outputLabel = document.getElementById("output-label");
		
		async function getExchangeRate() {
			try {
				const res  = await fetch("https://open.er-api.com/v6/latest/JPY");
				const data = await res.json();
				currentRate = data.rates.TWD;
				updateConversion();
			} catch (err) {
				console.error("åŒ¯ç‡æŠ“å–å¤±æ•—:", err);
			}
		}
		
		function addComma(s) { return s.replace(/\B(?=(\d{3})+(?!\d))/g, ","); }
		function removeComma(s) { return s.replace(/,/g, ""); }
		function updateConversion() {
			if (!currentRate) return;
			let raw = removeComma(inputField.value);
			if (!raw || isNaN(raw)) {
		    outputField.value = "";
		    return;
			}
			let val = parseInt(raw, 10);
			let result = isJPYtoTWD ? val * currentRate : val / currentRate;
			outputField.value = addComma(Math.round(result).toString());
		}
		
		toggleBtn.addEventListener("click", () => {
			isJPYtoTWD = !isJPYtoTWD;
			toggleBtn.classList.toggle("active", !isJPYtoTWD);
			toggleLabel.textContent = isJPYtoTWD ? "JPY" : "TWD";
			inputLabel.textContent  = isJPYtoTWD ? "ï½œ æ—¥åœ“" : "ï½œ å°å¹£";
			outputLabel.textContent = isJPYtoTWD ? "ï½œ å°å¹£" : "ï½œ æ—¥åœ“";
			updateConversion();
		});
		
		inputField.addEventListener("input", () => {
			let raw = removeComma(inputField.value);
			if (!raw || isNaN(raw)) {
				inputField.value = "";
				outputField.value = "";
				return;
			}
			inputField.value = addComma(raw);
			updateConversion();
		});
		
		// æ•¸å­—éµç›¤
		document.querySelectorAll(".num-pad .key").forEach(btn => {
			btn.addEventListener("click", () => {
				let raw = removeComma(inputField.value);
				const key = btn.textContent;
				if (key === "C") {
					inputField.value = "";
					outputField.value = "";
					return;
				}
		
				if (key === "â†") {
					raw = raw.slice(0, -1);
					inputField.value = raw ? addComma(raw) : "";
					updateConversion();
					return;
				}
		
				raw += key;
		    	raw = raw.replace(/^0+/, "");
		    	if (!raw) raw = "0";
				inputField.value = addComma(raw);
				updateConversion();
			});
		});
		
		
		let packingData = JSON.parse(localStorage.getItem("packingData")) || {
			groups: {
				documents: {
					name: "é‡è¦æ–‡ä»¶",
					items: [
						{ text: "è­·ç…§", done: false },
						{ text: "èº«åˆ†è­‰", done: false },
						{ text: "Esim", done: false },
						{ text: "ä¿¡ç”¨å¡", done: false },
						{ text: "äº¤é€šå¡", done: false },
						{ text: "å°å¹£ / æ—¥å¹£", done: false },
						{ text: "æ—…éŠä¿éšª", done: false }
					]
				},
		
			personal: {
				name: "å€‹äººç”¨å“",
				items: [
					{ text: "å£ç½©", done: false },
					{ text: "é¦™æ°´", done: false },
					{ text: "é›¢å­å¤¾", done: false },
					{ text: "å¸¸å‚™è—¥å“", done: false },
					{ text: "æ—…è¡Œæ´—æ¼±åŒ…", done: false },
					{ text: "æ—…è¡ŒåŒ–å¦åŒ…", done: false },
					{ text: "è¡›ç”Ÿç´™ / æ¿•ç´™å·¾", done: false }
				]
			},
		
		    clothes: {
				name: "æœè£ç”¨å“",
				items: [
					{ text: "å…æ´—å…§è¡£è¤²*6", done: false },
					{ text: "ç¡è¡£è¤²*1", done: false },
					{ text: "ç™¼ç†±è¡£*2", done: false },
					{ text: "ä¸Šè¡£*4", done: false },
					{ text: "ä¸­å±¤å¤–å¥—*1", done: false },
					{ text: "ä¸‹èº«*5", done: false },
					{ text: "ç–Šç©¿è£™*3", done: false },
					{ text: "å…§æ­è¤²*2", done: false },
					{ text: "ç™¼ç†±è¤²*2", done: false },
					{ text: "å¤–å¥—*3", done: false },
					{ text: "ç¾Šæ¯›è¥ª*3", done: false },
					{ text: "è¥ªå¥—*2", done: false },
					{ text: "é‹å­*2", done: false },
					{ text: "å¸½å­*3", done: false },
					{ text: "æ‰‹å¥—*2", done: false },
					{ text: "åœå·¾*3", done: false }   
				]
		    },
		
		    electronics: {
				name: "3C è¨­å‚™",
				items: [
					{ text: "æ‰‹æ©Ÿ", done: false },
					{ text: "æ‰‹æ©Ÿæ›ç¹©", done: false },
					{ text: "è€³æ©Ÿ", done: false },
					{ text: "è…³æ¶", done: false },
					{ text: "å……é›»å™¨", done: false },
					{ text: "è¡Œå‹•é›»æº", done: false },
					{ text: "ç›¸æ©Ÿ / é›»æ±  / è¨˜æ†¶å¡", done: false }
				]
			}
		}
		};
		
		
		/* å„²å­˜ */
		function savePacking() {
			localStorage.setItem("packingData", JSON.stringify(packingData));
		}
		
		/* å¿«é€Ÿé¸å– */
		function qs(s, r=document){ return r.querySelector(s); }
		function qsa(s, r=document){ return [...r.querySelectorAll(s)]; }
		
		/* ============================================================
		   å»ºç«‹åˆ†é¡ DOM
		============================================================ */
		function createGroupDOM(key, group) {
			return `
		    <div class="packing-group" data-group="${key}">
				<div class="packing-group-header">
					<div class="left-group">
						<span class="titlep">${group.name}</span>
		          		<span class="count-status">
		            		${group.items.filter(i=>i.done).length}/${group.items.length}
		          		</span>
		        	</div>
		       		<button class="delete-group-btn">Ã—</button>
				</div>
				<ul class="packing-list"></ul>
				<button class="add-item-btn" data-additem="${key}">ï¼‹ æ–°å¢é …ç›®</button>
			</div>
			`;
		}
		
		/* ============================================================
		   ä¸»æ¸²æŸ“ï¼ˆæ°¸é å±•é–‹ï¼‰
		============================================================ */
		function renderPackingPage() {
			const container = qs("#packing-page");
			container.innerHTML = "";
			Object.keys(packingData.groups).forEach(key => {
		    	container.innerHTML += createGroupDOM(key, packingData.groups[key]);
			});
			container.innerHTML += `<div id="add-category" class="add-category">ï¼‹ æ–°å¢åˆ†é¡</div>`;
			fillItems();
			bindEvents();
			enableDrag();
		}
		/* ============================================
		   ğŸŸ¦ å•Ÿç”¨æ‹–æ›³æ’åºï¼ˆæ¯å€‹åˆ†é¡å„è‡ªç¨ç«‹ sortï¼‰
		============================================ */
		function enableDrag() {
			qsa(".packing-list").forEach(ul => {
				const groupKey = ul.closest(".packing-group").dataset.group;
				Sortable.create(ul, {
					animation: 150,
					ghostClass: "drag-ghost",   // æ‹–æ›³æ™‚çš„é€æ˜å¤–æ¡†
					onEnd: function (evt) {
						const items = packingData.groups[groupKey].items;
						const movedItem = items.splice(evt.oldIndex, 1)[0];
						items.splice(evt.newIndex, 0, movedItem);
						savePacking();
						renderPackingPage(); // é‡æ–°æ¸²æŸ“
					}
				});
			});
		}
		
		/* ============================================================
		   å¡«å…¥é …ç›®
		============================================================ */
		function fillItems() {
			qsa(".packing-group").forEach(groupEl => {
		    	const key = groupEl.dataset.group;
		    	const ul = qs(".packing-list", groupEl);
				ul.innerHTML = "";
				packingData.groups[key].items.forEach((item, idx) => {
		      		const li = document.createElement("li");
					li.className = "packing-item";
					li.innerHTML = `
					<div class="packing-checkbox ${item.done ? "checked" : ""}" data-index="${idx}"></div>
					<span>${item.text}</span>
					<button class="item-delete-btn" data-index="${idx}">Ã—</button>
					`;
		      		ul.appendChild(li);
				});
				ul.style.display = "block";
			});
		}
		
		/* ============================================================
		   æ‰€æœ‰äº‹ä»¶
		============================================================ */
		function bindEvents() {
			qsa(".packing-checkbox").forEach(cb => {
				cb.onclick = (e) => {
					e.stopPropagation();
					const li = cb.closest(".packing-item");
					const groupKey = li.closest(".packing-group").dataset.group;
					const index = Number(cb.dataset.index);
					packingData.groups[groupKey].items[index].done =
					!packingData.groups[groupKey].items[index].done;
					savePacking();
					renderPackingPage();
				};
			});
		
			/* åˆªé™¤é …ç›® */
			qsa(".item-delete-btn").forEach(btn => {
				btn.onclick = (e) => {
					e.stopPropagation();
					const li = btn.closest(".packing-item");
					const groupKey = li.closest(".packing-group").dataset.group;
					const index = Number(btn.dataset.index);
					packingData.groups[groupKey].items.splice(index, 1);
					savePacking();
					renderPackingPage();
				};
			});
		
			/* æ–°å¢é …ç›® */
			qsa(".add-item-btn").forEach(btn => {
				btn.onclick = () => {
					currentGroupKey = btn.dataset.additem;
					openModal("æ–°å¢é …ç›®");
				};
			});
		
			/* æ–°å¢åˆ†é¡ */
			qs("#add-category").onclick = () => {
				currentGroupKey = null;
				openModal("æ–°å¢åˆ†é¡");
			};
		
			/* åˆªé™¤åˆ†é¡ */
			qsa(".delete-group-btn").forEach(btn => {
				btn.onclick = (e) => {
					e.stopPropagation();
					const key = btn.closest(".packing-group").dataset.group;
		      		delete packingData.groups[key];
					savePacking();
		      		renderPackingPage();
				};
			});
		}
		
		/* ============================================================
		   Modal
		============================================================ */
		let currentGroupKey = null;
		function openModal(title) {
			const modal = qs("#itemModal");
			const titleEl = qs("#modalTitle");
			const input = qs("#modalInput");
			
			if (title === "æ–°å¢åˆ†é¡") {
				titleEl.style.display = "none";
			} else {
				titleEl.style.display = "block";
				titleEl.textContent = title;
			}
		
			modal.style.display = "flex";
			input.value = "";
			setTimeout(()=>input.focus(),50);
		}
		
		qs("#modalCancel").onclick = () => {
			qs("#itemModal").style.display = "none";
		};
		
		qs("#modalOK").onclick = () => {
			const val = qs("#modalInput").value.trim();
			if (!val) return;
			if (currentGroupKey) {
				packingData.groups[currentGroupKey].items.push({
					text: val,
					done: false
				});
			} else {
				const id = "cat" + Date.now();
				packingData.groups[id] = {
					name: val,
				  	items: []
				};
			}
			savePacking();
		  	renderPackingPage();
		  	qs("#itemModal").style.display = "none";
		};
		
		/* åˆå§‹åŒ– */
		renderPackingPage();
		
		// =============== é›»å­æ†‘è­‰åˆ†é¡å…§å®¹ ===============
		let ticketLevel = "list"; 
		const ticketData = {
			hotel: {
				body: `
				<div class="hotel-group">
					<div class="hotel-item open">
						<div class="hotel-header">
					  		<span>ONSEN RYOKAN YUEN</span>
						</div>
						<div class="hotel-pdf-list">
						  	<a href="pdf/hotel-reservation.pdf" target="_blank" class="pdf-item">
								<img src="images/57.png" class="pdf-icon">
								<div class="pdf-info">
							  		<div class="pdf-title">Hotel Reservation</div>
							  		<div class="pdf-sub">ä½å®¿è¨‚æˆ¿ç¢ºèª</div>
								</div>
						  	</a>
					  		<span class="ticket-divider"></span>
					  		<a href="pdf/hotel-receipt.pdf" target="_blank" class="pdf-item">
								<img src="images/57.png" class="pdf-icon">
								<div class="pdf-info">
						  			<div class="pdf-title">Payment Receipt</div>
						  			<div class="pdf-sub">ä»˜æ¬¾æ”¶æ“š</div>
								</div>
					  		</a>
						</div>
					</div>
					<div class="hotel-item open">
						<div class="hotel-header">
							<span>VESSEL HOTEL</span>
						</div>
						<div class="hotel-pdf-list">
						  	<a href="pdf/hotel-reservation2.pdf" target="_blank" class="pdf-item">
								<img src="images/57.png" class="pdf-icon">
								<div class="pdf-info">
							  		<div class="pdf-title">Hotel Reservation</div>
							  		<div class="pdf-sub">ä½å®¿è¨‚æˆ¿ç¢ºèª</div>
								</div>
						  	</a>
							<span class="ticket-divider"></span>
		         			<a href="pdf/hotel-receipt2.pdf" target="_blank" class="pdf-item">
		            			<img src="images/57.png" class="pdf-icon">
		            			<div class="pdf-info">
		              				<div class="pdf-title">Payment Receipt</div>
		              				<div class="pdf-sub">ä»˜æ¬¾æ”¶æ“š</div>
		            			</div>
		          			</a>
		        		</div>
		      		</div>
				</div>
		  		`
			},
			flight: {
				body: `
				  	<div class="flight-group">
						<div class="flight-card-wrapper">
							<div class="flight-info-header">
								<span class="icon-airplane"></span>
								<span class="route">æ¡ƒåœ’ â€” æ±äº¬</span>
							</div>
						</div>
					<div class="flight-card">
						<div class="flight-top">
							<div class="flight-pass-bar">
								<span class="pass-title">BOARDING PASS</span>
								<span class="pass-checkin">å ±åˆ°æ™‚é–“ï½œ22:10</span>
							</div>
						</div>
						<div class="flight-airline">
							<div class="flight-no">IT216</div>
								<div class="flight-dates">
									<span class="date-depart">2026 å¹´ 2 æœˆ 9 æ—¥</span>
									<span class="date-arrive">2026 å¹´ 2 æœˆ 9 æ—¥</span>
								</div>
								 <div class="flight-time">
									<span class="time1">00:10</span>
									<span class="time1">04:00</span>
								</div>
								<div class="flight-line">
								  <span class="airport">TPE T2</span>
								  <span class="airport">HND T3</span>
								</div>
							</div>
							<div class="flight-docs">
								<a class="flight-doc" href="pdf/ichentiger.pdf" target="_blank">
								  <div class="doc-name">CHUANG ICHEN</div>
								</a>
								<a class="flight-doc" href="pdf/boruitiger.pdf" target="_blank">
								  <div class="doc-name">SU BORUI</div>
								</a>
							</div>
						</div>
						
						<hr>
						
						<div class="flight-card-wrapper" style="margin-top: 1.2rem;">
							<div class="flight-info-header">
								<span class="icon-airplane"></span>
								<span class="route">æ±äº¬ â€” æ–°åƒæ­²</span>
							</div>
						</div>
						<div class="flight-card">
							<div class="flight-top">
								<div class="flight-pass-bar">
									<span class="pass-title">BOARDING PASS</span>
									<span class="pass-checkin">å ±åˆ°æ™‚é–“ï½œ06:15</span>
								</div>
							</div>
							<div class="flight-airline">
								<div class="flight-no">HD015</div>
								<div class="flight-dates">
									<span class="date-depart">2026 å¹´ 2 æœˆ 9 æ—¥</span>
									<span class="date-arrive">2026 å¹´ 2 æœˆ 9 æ—¥</span>
								</div>
								<div class="flight-time">
									<span class="time1">08:15</span>
									<span class="time1">09:45</span>
								</div>
								<div class="flight-line">
									<span class="airport">HND T2</span>
									<span class="airport">CTS</span>
								</div>
							</div>
							<div class="flight-docs">
								<a class="flight-doc" href="pdf/ichenido.pdf" target="_blank">
									<div class="doc-name">CHUANG ICHEN</div>
								</a>
								<a class="flight-doc" href="pdf/boruiido.pdf" target="_blank">
									<div class="doc-name">SU BORUI</div>
								</a>
							</div>
						</div>
						
						<hr>
						
						<div class="flight-card-wrapper" style="margin-top: 1.2rem;">
							<div class="flight-info-header">
								<span class="icon-airplane"></span>
								<span class="route">æ–°åƒæ­² â€” æ¡ƒåœ’</span>
							</div>
						</div>
						<div class="flight-card">
							<div class="flight-top">
								<div class="flight-pass-bar">
									<span class="pass-title">BOARDING PASS</span>
									<span class="pass-checkin">å ±åˆ°æ™‚é–“ï½œ10:10</span>
								</div>
							</div>
							<div class="flight-airline">
								<div class="flight-no">BR165</div>
								<div class="flight-dates">
									<span class="date-depart">2026 å¹´ 2 æœˆ 15 æ—¥</span>
									<span class="date-arrive">2026 å¹´ 2 æœˆ 15 æ—¥</span>
								</div>
								<div class="flight-time">
									<span class="time1">12:10</span>
									<span class="time1">16:05</span>
								</div>
								<div class="flight-line">
								  	<span class="airport">CTS</span>
								  	<span class="airport">TPE T2</span>
								</div>
							</div>
							<div class="flight-docs">
								<a class="flight-doc" href="pdf/icheneva.pdf" target="_blank">
									<div class="doc-name">CHUANG ICHEN</div>
								</a>
								<a class="flight-doc" href="pdf/boruieva.pdf" target="_blank">
									<div class="doc-name">SU BORUI</div>
								</a>
							</div>
						</div>
					</div>
					<span style="display: flex;height: 2rem;"></span>
				`
				}
			};
		
			// âœ… èˆªç­è³‡è¨Šï¼ˆç¨ç«‹ä¸»é ï¼‰ï¼šæŠŠåŸæœ¬ ticketData.flight.body ç›´æ¥æ¸²æŸ“é€²å»
			function renderFlightStandalone() {
				const host = document.getElementById("flightStandalone");
				if (!host || !ticketData || !ticketData.flight) return;
				host.innerHTML = ticketData.flight.body || "";
			}
			// åªè¦ DOM ready å°±å…ˆæ¸²æŸ“ä¸€æ¬¡ï¼ˆè³‡æ–™æ˜¯éœæ…‹å­—ä¸²ï¼Œä¸éœ€è¦ç­‰å…¶ä»– APIï¼‰
			document.addEventListener("DOMContentLoaded", renderFlightStandalone);

			// é»åˆ†é¡ â†’ é¡¯ç¤ºå…§å®¹é 
			document.addEventListener("click", function (e) {
				const card = e.target.closest(".ticket-category");
				if (!card) return;
				const key = card.dataset.target;
				if (key === "rentcar") {
					card.classList.add("ticket-opening");
					setTimeout(() => {
						window.open("pdf/carreservation.pdf", "_blank");
						card.classList.remove("ticket-opening");
					}, 250);
				return;
			}
		
		  	// â­ å…¥å¢ƒï¼šç›´æ¥é–‹ PDF
		 	if (key === "entry") {
		  		card.classList.add("ticket-opening");
				setTimeout(() => {
					window.open("pdf/vjw.pdf", "_blank");
					card.classList.remove("ticket-opening");
				}, 250);
				return;
			}
			
		 	// â­ è¡Œç¨‹ï¼šç›´æ¥é–‹ PDF
		 	if (key === "schedule") {
		  		card.classList.add("ticket-opening");
				setTimeout(() => {
					window.open("pdf/klook.pdf", "_blank");
					card.classList.remove("ticket-opening");
		  		}, 250);
				return;
			}

			// â­ é¤å»³ï¼šç›´æ¥é–‹ PDF
		 	if (key === "restaurant") {
		  		card.classList.add("ticket-opening");
				setTimeout(() => {
					window.open("pdf/restaurant.pdf", "_blank");
					card.classList.remove("ticket-opening");
		  		}, 250);
				return;
			}
			
		  	// â­ é£¯åº—ï¼šç•™åœ¨é›»å­æ†‘è­‰é ï¼ˆç¬¬äºŒå±¤ï¼‰
			if (key === "hotel") {
			  	const list = document.querySelector(".ticket-category-list");
			  	document.getElementById("ticketContent").style.display = "none";
			  	list.style.display = "flex";
			  	list.innerHTML = ticketData[key].body;
			  	playFadeIn(list);
			  	ticketLevel = key;
			  	// é£¯åº—ç¬¬äºŒå±¤éœ€è¦è¿”å›
			  	setNavBack();
			  	return;
			}

			// âœ… èˆªç­ï¼šæ”¹ç‚ºã€Œç¨ç«‹ä¸»é ã€ï¼Œä¸å•Ÿç”¨è¿”å›ã€ä¸å›åˆ°é›»å­ç¥¨æ“š
			if (key === "flight") {
				renderFlightStandalone();
				showPage("flight-page");
				return;
			}


		
		  	// â­ å…¶ä»–åˆ†é¡ï¼šå…§å®¹é æ¨¡å¼
		  	document.getElementById("ticketContentTitle").textContent =
		  	ticketData[key].title || "";
			document.getElementById("ticketContentBody").innerHTML =
		    ticketData[key].body || "";
			const content = document.getElementById("ticketContent");
			content.classList.remove("fade-in");
		
			// å¼·åˆ¶ reflowï¼Œè®“ animation å¯ä»¥é‡æ’­
			void content.offsetWidth;
			content.classList.add("fade-in");
			document.querySelector(".ticket-category-list").style.display = "none";
		  	document.getElementById("ticketContent").style.display = "block";
			ticketLevel = "content";
		});

		
		function resetTicketPage() {
		  	const list = document.querySelector(".ticket-category-list");
		  	const content = document.getElementById("ticketContent");
		
			if (list) {
				list.innerHTML = originalTicketCategoryHTML;
				list.style.display = "flex";
			}
			if (content) {
		    	content.style.display = "none";
		  	}
			ticketLevel = "list";
		}
		
		function playFadeIn(el) {
			if (!el) return;
		  	el.classList.remove("fade-in");
		  	void el.offsetWidth; // å¼·åˆ¶ reflow
		  	el.classList.add("fade-in");
		}
		
		function showTicket() {
		    isMainPage = false;
		
		    document.querySelector(".container").style.display = "none";
		    document.getElementById("exchange-page").style.display = "none";
		    document.getElementById("packing-page").style.display = "none";
		    const ticketPage = document.getElementById("ticket-page");
		    ticketPage.style.display = "block";
		    ticketPage.classList.remove("fade-in");
		    void ticketPage.offsetWidth;
		    ticketPage.classList.add("fade-in");
		    scrollBtn.classList.remove("show");
		
		    // é¡¯ç¤º BACK æŒ‰éˆ•
		    setNavBack();
		}

		
		
		function goBack() {
		  	const ticketList = document.querySelector(".ticket-category-list");
			if (ticketLevel === "hotel" || ticketLevel === "flight") {
				ticketList.innerHTML = originalTicketCategoryHTML;  // ä¿æŒåŸæœ‰å…§å®¹
				ticketList.style.display = "flex";
				ticketLevel = "list";
				playFadeIn(ticketList);  // åŠ å…¥å‹•ç•«æ•ˆæœ
				return;
			}
			if (ticketLevel === "content") {
				document.getElementById("ticketContent").style.display = "none";
				ticketList.style.display = "flex";
				ticketLevel = "list";
				playFadeIn(ticketList);  // åŠ å…¥å‹•ç•«æ•ˆæœ
				return;
			}
			backToMain();
			resetNavMenu()
		}
		
		
		function playFadeIn(el) {
		  	if (!el) return;
		  	el.classList.remove("fade-in");  // ç§»é™¤ä¹‹å‰çš„å‹•ç•«æ•ˆæœ
		  	void el.offsetWidth;  // å¼·åˆ¶è§¸ç™¼é‡ç¹ªï¼ˆç€è¦½å™¨é‡æ–°æ¸²æŸ“ï¼‰
		  	el.classList.add("fade-in");  // é‡æ–°æ·»åŠ å‹•ç•«æ•ˆæœ
		}
		
		
		document.addEventListener("click", function (e) {
			const card = e.target.closest(".ticket-category");
		  	if (!card) return;
			const key = card.dataset.target;
			if (key === "hotel") {
				const list = document.querySelector(".ticket-category-list");
				document.getElementById("ticketContent").style.display = "none";
				list.style.display = "flex";
				list.innerHTML = ticketData[key].body;
				playFadeIn(list);  // åŠ å…¥å‹•ç•«æ•ˆæœ
				ticketLevel = key;  // é¡¯ç¤ºç•¶å‰é é¢
				setNavBack();
				return;
			}
			if (key === "flight") {
				renderFlightStandalone();
				showPage("flight-page");
				return;
			}
			document.getElementById("ticketContentTitle").textContent = ticketData[key].title || "";
			document.getElementById("ticketContentBody").innerHTML = ticketData[key].body || "";
			const content = document.getElementById("ticketContent");
			content.classList.remove("fade-in");  // ç§»é™¤ä¹‹å‰çš„å‹•ç•«
			void content.offsetWidth;  // è®“ç€è¦½å™¨é‡æ–°æ¸²æŸ“
			content.classList.add("fade-in");  // é‡æ–°æ·»åŠ å‹•ç•«
			document.querySelector(".ticket-category-list").style.display = "none";
			document.getElementById("ticketContent").style.display = "block";
			ticketLevel = "content"; // é¡¯ç¤ºå…§å®¹é 
		});
		
		document.addEventListener("DOMContentLoaded", () => {
			const splash = document.getElementById("app-splash");
		  	const app = document.getElementById("app-root");
			const images = [...document.images];
			let loaded = 0;
			if (images.length === 0) finish();
			images.forEach(img => {
				if (img.complete) {
					loaded++;
					if (loaded === images.length) finish();
				} else {
					img.onload = img.onerror = () => {
					loaded++;
					if (loaded === images.length) finish();
				};
			}
		});
		
		function finish() {
			setTimeout(() => {
		    	splash.classList.add("hide");
				setTimeout(() => {
					splash.remove();
					app.classList.add("show");
				}, 400);
				}, 2000);
			}
		});
		
		document.addEventListener("DOMContentLoaded", () => {
  			const appRoot = document.getElementById("app-root");
  			const homePage = document.getElementById("home-page");
			appRoot.classList.add("show");
			homePage.classList.add("active");
			const menuBtn = document.getElementById("menuBtn");
		  	const closeBtn = document.getElementById("menuClose");
		  	const iosFullMenu = document.getElementById("iosFullMenu");
		  	const menuItems = document.querySelectorAll(".menu-content ul li");
		  	const contentPages = document.querySelectorAll(".container, .packing-page, .ticket-page, .exchange-page, .weather-page");
		 	const topbar = document.getElementById("topbar");

			function openMenu() {
			  iosMenu.style.display = "flex";   // å…ˆé¡¯ç¤ºï¼Œæ‰èƒ½å‹•ç•«
			  topbar.style.display = "none";
			
			  // ä¸‹ä¸€å¹€åŠ  classï¼Œè§¸ç™¼ CSS transition
			  requestAnimationFrame(() => {
			    iosMenu.classList.add("menu-open");
			  });
			}
			
			function closeMenu() {
			  iosMenu.classList.remove("menu-open");
			  topbar.style.display = "flex";
			
			  // ç­‰å‹•ç•«çµæŸå†éš±è—
			  setTimeout(() => {
			    iosMenu.style.display = "none";
			  }, 240); // é€™å€‹æ•¸å­—è¦ >= CSS transition æ™‚é–“
			}

			menuBtn.onclick = () => {
			  if (navMode === "back") return; // back æ¨¡å¼äº¤çµ¦ä½ åŸæœ¬çš„é‚è¼¯
			  openMenu();
			};
			
			menuClose.onclick = closeMenu;

			
			document.querySelectorAll(".menu-content li").forEach(li => {
			  li.addEventListener("click", () => {
			    const target = li.dataset.target;
			
			    closeMenu();                 // é—œå·¦ä¸Šé¸å–®
			    showPage(target);            // çµ±ä¸€åˆ‡é å…¥å£
			    setBottomNavActive(target);  // åŒæ­¥åº•éƒ¨é¸å–® active
			  });
			});

		});
	</script>
<script>
/* =========================
   Pages / Navigation
========================= */
const PAGES = ["home-page","packing-page","ticket-page","flight-page","photo-page","exchange-page","weather-page","shopping-page"];


let currentPageId = "home-page";

/* =========================
   å®‰å…¨å‘¼å«ï¼šå¤–éƒ¨å‡½å¼ä¸å­˜åœ¨ä¹Ÿä¸æœƒæŠŠæ•´æ®µå¼„æ›
========================= */
function safeCall(fn, ...args) {
  try {
    if (typeof fn === "function") return fn(...args);
  } catch(e){
  console.error(e);
  return null;   // âœ… é›¢ç·šæ™‚å› nullï¼Œä»£è¡¨ã€Œä¸è¦å‹•ç¾æœ‰è³‡æ–™ã€
}

}

/* =========================
   Page helpers
========================= */
function getCurrentPage() {
  return document.getElementById(currentPageId);
}

function scrollCurrentPageToTop(behavior = "auto") {
  const page = getCurrentPage();
  if (page) page.scrollTo({ top: 0, behavior });
}

/* =========================
   Top-left icon mode (menu/back)
   âœ… åªç”¨ body.nav-back åˆ¤æ–·ç‹€æ…‹ï¼ˆé¿å… navMode é‡è¤‡å®£å‘Šçš„å‘ï¼‰
========================= */
function setNavBack() {
  document.body.classList.add("nav-back");
}

function resetNavMenu() {
  document.body.classList.remove("nav-back");
}

/* =========================
   Show Pageï¼ˆæ ¸å¿ƒåˆ‡é ï¼‰
========================= */
function showPage(targetId) {
  if (!PAGES.includes(targetId)) return;

  if (currentPageId === "ticket-page" && targetId !== "ticket-page") {
    safeCall(window.resetTicketPage);
    resetNavMenu();
  }

  if (targetId === "ticket-page") {
    safeCall(window.resetTicketPage);
    resetNavMenu();
  }

  // âœ… å‡ºç‰‡åƒæ•¸é ï¼šæ°¸é ç¶­æŒæ¼¢å ¡ç‹€æ…‹ï¼ˆé¿å…å¾ç¥¨æ“šå…§å®¹å›ä¸Šä¸€å±¤çš„ back ç‹€æ…‹æ®˜ç•™ï¼‰
  if (targetId === "photo-page") {
    resetNavMenu();
    // âœ… æ¯æ¬¡é€²å…¥éƒ½é‡ç•«å½±ç‰‡æ¸…å–®ï¼ˆé¿å…åˆ—è¡¨æ¶ˆå¤±ï¼‰
    safeCall(window.initPhotoPage);
    safeCall(window.renderVideoLinkCards);
  }

// âœ… è³¼ç‰©æ¸…å–®ï¼šé€²å…¥æ™‚æ¸²æŸ“/åˆå§‹åŒ–
if (targetId === "shopping-page") {
  safeCall(window.Shop_EnterShoppingPage);
}
  // âœ… å¤©æ°£é ï¼šåªé€²å…¥ä¸€æ¬¡å…¥å£
  if (targetId === "weather-page") {
    safeCall(window.WX_EnterWeatherPage);
  }


  // é—œæ‰å…¨éƒ¨ page
  PAGES.forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.remove("page-active");
    el.style.display = "none";
  });

  // æ‰“é–‹ç›®æ¨™ page
  const target = document.getElementById(targetId);
  if (!target) return;

  target.style.display = "block";
  currentPageId = targetId;

  // Bottom nav active æ¨£å¼ï¼ˆå¦‚æœå¤–éƒ¨æœ‰ç”¨ï¼‰
  safeCall(window.setBottomNavActive, targetId);

  requestAnimationFrame(() => {
    target.classList.add("page-active");
    target.scrollTop = 0;
    bindScrollListener();
  });
	
}

function setBottomNavActive(pageId) {
  document.querySelectorAll(".bottom-nav button").forEach(b => {
    b.classList.toggle("active", b.dataset.page === pageId);
  });
}

/* å°å¤–å¯å‘¼å« */
window.showPage = showPage;
window.setBottomNavActive = setBottomNavActive;
window.setNavBack = setNavBack;
window.resetNavMenu = resetNavMenu;

/* =========================
   Photo Pageï¼ˆå‡ºç‰‡åƒæ•¸ï¼‰
========================= */

// ç›¸ç°¿ 1ï¼ˆåŸæœ¬é‚£çµ„ï¼‰
const PHOTO_ITEMS_1 = [
  { src: "images/photo1.jpg", name: "æ¿¾é¡åˆ†é¡", desc: "é»åœ–ç‰‡å¯å…¨è¢å¹•æ”¾å¤§ï¼Œå·¦å³æ»‘å‹•åˆ‡æ›" },
  { src: "images/photo2.jpg", name: "æ¿¾é¡é©ç”¨å ´åˆ", desc: "é»åœ–ç‰‡å¯å…¨è¢å¹•æ”¾å¤§ï¼Œå·¦å³æ»‘å‹•åˆ‡æ›" }
];

// ç›¸ç°¿ 2ï¼ˆæ–°å¢é€™çµ„ï¼Œæ›ä½ çš„ç…§ç‰‡ï¼‰
const PHOTO_ITEMS_2 = [
  { src: "images/photo3.jpg", name: "æ‹ç…§å–æ™¯åƒè€ƒ_1", desc: "é»åœ–ç‰‡å¯å…¨è¢å¹•æ”¾å¤§ï¼Œå·¦å³æ»‘å‹•åˆ‡æ›" }
  
];



// ===== Photo: é•·æŒ‰æ›´æ›åœ–ç‰‡ï¼ˆlocalStorage è¦†è“‹ï¼‰===== 
const PHOTO_OVERRIDE_LS_PREFIX = "photo_override__";
const PHOTO_OVERRIDE_MAX_BYTES = 2 * 1024 * 1024; // 2MBï¼Œé¿å… localStorage çˆ†æ‰
let __photoReplacePendingKey = null;

function ensurePhotoToast(){
  let el = document.getElementById('photoToast');
  if (el) return el;
  el = document.createElement('div');
  el.id = 'photoToast';
  el.style.cssText = [
    'position:fixed','left:50%','bottom:90px','transform:translateX(-50%)',
    'background:rgba(0,0,0,.78)','color:#fff','padding:10px 14px','border-radius:999px',
    'font-size:13px','letter-spacing:.5px','z-index:10000','opacity:0','pointer-events:none',
    'transition:opacity .18s ease'
  ].join(';');
  document.body.appendChild(el);
  return el;
}
function photoToast(msg, ms=1400){
  const el = ensurePhotoToast();
  el.textContent = msg;
  el.style.opacity = '1';
  clearTimeout(el.__t);
  el.__t = setTimeout(()=>{ el.style.opacity = '0'; }, ms);
}

// âœ… iOS é™åˆ¶ï¼šä¸èƒ½åœ¨ setTimeout/é•·æŒ‰è¨ˆæ™‚å™¨å…§ç›´æ¥å‘¼å« input.click() é–‹ç›¸ç°¿
// è§£æ³•ï¼šé•·æŒ‰å…ˆå«å‡ºæ“ä½œé¢æ¿ï¼Œä½¿ç”¨è€…å†é»ä¸€æ¬¡ã€Œæ›´æ›åœ–ç‰‡ã€æŒ‰éˆ•ï¼ˆåŒæ­¥æ‰‹å‹¢ï¼‰æ‰é–‹ç›¸ç°¿
let __photoActionSheetKey = null;
function ensurePhotoActionSheet(){
  let sheet = document.getElementById('photoActionSheet');
  if (sheet) return sheet;
  sheet = document.createElement('div');
  sheet.id = 'photoActionSheet';
  sheet.className = 'ios-alert-mask';
  sheet.innerHTML = `
    <div class="ios-alert" role="dialog" aria-modal="true">
      <div class="ios-alert-body">
        <div class="ios-alert-title">åŒ—æµ·é“ã®æ—…æƒ³è¦å–ç”¨æ‚¨çš„ç…§ç‰‡</div>
        <div class="ios-alert-desc">è«‹é¸æ“‡è¦æ›´æ›çš„åœ–ç‰‡ä¾†æº</div>
      </div>

      <button id="photoASReplace" type="button" class="ios-alert-btn">é¸å–æ›´å¤šç…§ç‰‡â€¦</button>
      <button id="photoASCancel" type="button" class="ios-alert-btn ios-alert-btn-cancel">ä¿ç•™ç›®å‰æ‰€é¸ç¯„åœ</button>
    </div>
  `;
  document.body.appendChild(sheet);

  // close handlers
  sheet.addEventListener('click', (e)=>{
    // é»èƒŒæ™¯é—œé–‰ï¼›é»å–æ¶ˆä¹Ÿé—œé–‰
    if (e.target && (e.target.id === 'photoActionSheet' || e.target.id === 'photoASCancel')) {
      closePhotoActionSheet();
    }
  });

  // replace (åŒæ­¥ click å…§é–‹æª”æ¡ˆé¸æ“‡å™¨ï¼Œæ‰‹æ©Ÿæ‰æœƒæ”¾è¡Œ)
  sheet.querySelector('#photoASReplace').addEventListener('click', ()=>{
    if (!__photoActionSheetKey) return;
    openPhotoReplacePicker(__photoActionSheetKey);
    closePhotoActionSheet();
  });

  // reset
  sheet.querySelector('#photoASReset').addEventListener('click', ()=>{
    if (!__photoActionSheetKey) return;
    try{ localStorage.removeItem(PHOTO_OVERRIDE_LS_PREFIX + __photoActionSheetKey); }catch(_){ }
    // é‡æ–°åˆå§‹åŒ–ç›¸ç°¿ï¼Œè®“åŸåœ–å›ä¾†
    try{ window.initPhotoPage && window.initPhotoPage(); }catch(_){ }
    photoToast('â†©ï¸ å·²æ¢å¾©åŸåœ–');
    closePhotoActionSheet();
  });

  return sheet;
}

function openPhotoActionSheet(photoKey){
  __photoActionSheetKey = photoKey;
  const sheet = ensurePhotoActionSheet();
  sheet.style.display = 'flex';
  sheet.classList.add('is-open');
}

function closePhotoActionSheet(){
  const sheet = document.getElementById('photoActionSheet');
  if (sheet) {
    sheet.classList.remove('is-open');
    sheet.style.display = 'none';
  }
  __photoActionSheetKey = null;
}

function bindPhotoReplaceInputOnce(){
  const input = document.getElementById('photoReplaceInput');
  if (!input || input.dataset.bound === '1') return;
  input.dataset.bound = '1';

  input.addEventListener('change', () => {
    const file = input.files && input.files[0];
    if (!file || !__photoReplacePendingKey) return;

    if (!/^image\//.test(file.type || '')) {
      photoToast('âš ï¸ è«‹é¸æ“‡åœ–ç‰‡æª”');
      return;
    }
    if (file.size > PHOTO_OVERRIDE_MAX_BYTES) {
      photoToast('âš ï¸ åœ–ç‰‡å¤ªå¤§ï¼Œå»ºè­°å°æ–¼ 2MB');
      return;
    }

    const reader = new FileReader();
    reader.onload = () => {
      const dataUrl = reader.result;
      try {
        localStorage.setItem(PHOTO_OVERRIDE_LS_PREFIX + __photoReplacePendingKey, dataUrl);
      } catch (e) {
        photoToast('âš ï¸ å„²å­˜å¤±æ•—ï¼šç©ºé–“ä¸è¶³ï¼ˆåœ–ç‰‡å¤ªå¤§ï¼‰', 1800);
        return;
      }

      // ç«‹åˆ»æ›¿æ›æ‰€æœ‰ç›¸åŒ key çš„åœ–ç‰‡
      document.querySelectorAll('img[data-photo-key]').forEach(img => {
        if (img.dataset.photoKey === __photoReplacePendingKey) {
          img.src = dataUrl;
        }
      });

      photoToast('âœ… å·²æ›´æ›åœ–ç‰‡');
      __photoReplacePendingKey = null;
    };
    reader.readAsDataURL(file);
  });
}

function openPhotoReplacePicker(photoKey){
  const input = document.getElementById('photoReplaceInput');
  if (!input) return;
  __photoReplacePendingKey = photoKey;
  input.value = '';
  input.click();
}

function getPhotoOverrideSrc(photoKey){
  try { return localStorage.getItem(PHOTO_OVERRIDE_LS_PREFIX + photoKey) || ''; }
  catch(e){ return ''; }
}

// å…±ç”¨ï¼šåˆå§‹åŒ–æŸä¸€å€‹ç›¸ç°¿ï¼ˆswiperId + dotsId + itemsï¼‰
function initPhotoGallery(swiperId, dotsId, items) {
  const swiper = document.getElementById(swiperId);
  const dotsEl = document.getElementById(dotsId);
  if (!swiper || !dotsEl) return;

  // é˜²é‡è¤‡åˆå§‹åŒ–ï¼ˆæ¯å€‹ swiper å„è‡ªè¨˜ï¼‰
  if (swiper.dataset.inited === "1") return;
  swiper.dataset.inited = "1";

  const esc = (s) => String(s ?? "")
    .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;").replace(/'/g,"&#39;");

  // Render slidesï¼ˆå¥—ç”¨ localStorage è¦†è“‹åœ– + è¨­å®š keyï¼‰
  const normalizedItems = (items || []).map((item, idx) => {
    const key = item.key || item.src || (swiperId + '_' + idx);
    const overridden = getPhotoOverrideSrc(key);
    return { ...item, key, src: overridden || item.src };
  });

  swiper.innerHTML = normalizedItems.map(item => `
    <div class="photo-slide">
      <img src="${esc(item.src)}" alt="${esc(item.name)}" data-photo-key="${esc(item.key)}">
      <div class="photo-meta">
        <p class="photo-name">${esc(item.name)}</p>
        <p class="photo-desc">${esc(item.desc)}</p>
      </div>
    </div>
  `).join("");

  // é»ä¸€ä¸‹ â†’ å…¨è¢å¹•ï¼›é•·æŒ‰ â†’ æ›´æ›åœ–ç‰‡
  const LONG_PRESS_MS = 550;
  let lpTimer = 0;
  let lpTriggered = false;
  let startX = 0, startY = 0;
  let suppressClick = false;

  const clearLP = () => {
    if (lpTimer) { clearTimeout(lpTimer); lpTimer = 0; }
  };

  swiper.addEventListener('pointerdown', (e) => {
    const img = e.target.closest('img[data-photo-key]');
    if (!img) return;
    if (e.pointerType === 'mouse' && e.button !== 0) return;

    lpTriggered = false;
    startX = e.clientX; startY = e.clientY;
    clearLP();

    lpTimer = setTimeout(() => {
      lpTriggered = true;
      suppressClick = true;
      try { if (navigator.vibrate) navigator.vibrate(10); } catch(_) {}
      // æ‰‹æ©Ÿï¼ˆå°¤å…¶ iOSï¼‰ä¸èƒ½åœ¨è¨ˆæ™‚å™¨å…§ç›´æ¥é–‹ç›¸ç°¿ï¼Œæ‰€ä»¥å…ˆå«å‡ºæ“ä½œé¢æ¿
      if (e.pointerType === 'touch' || e.pointerType === 'pen') {
        openPhotoActionSheet(img.dataset.photoKey);
      } else {
        // æ¡Œæ©Ÿ/æ»‘é¼ å¯ç›´æ¥é–‹
        openPhotoReplacePicker(img.dataset.photoKey);
      }
    }, LONG_PRESS_MS);
  });

  swiper.addEventListener('pointermove', (e) => {
    if (!lpTimer) return;
    const dx = Math.abs(e.clientX - startX);
    const dy = Math.abs(e.clientY - startY);
    const th = (e.pointerType === 'touch' || e.pointerType === 'pen') ? 18 : 12;
    if (dx > th || dy > th) clearLP();
  }, { passive: true });

  swiper.addEventListener('pointerup', () => {
    clearLP();
    if (lpTriggered) setTimeout(() => { suppressClick = false; }, 50);
  }, { passive: true });

  swiper.addEventListener('pointercancel', () => {
    clearLP();
    if (lpTriggered) setTimeout(() => { suppressClick = false; }, 50);
  }, { passive: true });

  // Fallback: iOS/older browsers without reliable PointerEvents
  if (!('PointerEvent' in window)) {
    let tStartX = 0, tStartY = 0;
    swiper.addEventListener('touchstart', (e) => {
      const img = e.target.closest('img[data-photo-key]');
      if (!img) return;
      const t = (e.touches && e.touches[0]) ? e.touches[0] : null;
      if (!t) return;
      lpTriggered = false;
      tStartX = t.clientX; tStartY = t.clientY;
      clearLP();
      lpTimer = setTimeout(() => {
        lpTriggered = true;
        suppressClick = true;
        try { if (navigator.vibrate) navigator.vibrate(10); } catch(_) {}
        openPhotoActionSheet(img.dataset.photoKey);
      }, LONG_PRESS_MS);
    }, { passive: true });

    swiper.addEventListener('touchmove', (e) => {
      if (!lpTimer) return;
      const t = (e.touches && e.touches[0]) ? e.touches[0] : null;
      if (!t) return;
      const dx = Math.abs(t.clientX - tStartX);
      const dy = Math.abs(t.clientY - tStartY);
      if (dx > 18 || dy > 18) clearLP();
    }, { passive: true });

    swiper.addEventListener('touchend', () => {
      clearLP();
      if (lpTriggered) setTimeout(() => { suppressClick = false; }, 50);
    }, { passive: true });

    swiper.addEventListener('touchcancel', () => {
      clearLP();
      if (lpTriggered) setTimeout(() => { suppressClick = false; }, 50);
    }, { passive: true });
  }


  // å–æ¶ˆé•·æŒ‰çš„ç³»çµ±å³éµ/é¸å–®ï¼ˆæ¡Œæ©Ÿ/éƒ¨åˆ†ç€è¦½å™¨ï¼‰
  swiper.addEventListener('contextmenu', (e) => {
    const img = e.target.closest('img[data-photo-key]');
    if (!img) return;
    e.preventDefault();
  });

  swiper.addEventListener("click", (e) => {
    const img = e.target.closest("img");
    if (!img) return;
    if (suppressClick) {
      e.preventDefault();
      e.stopPropagation();
      return;
    }
    openPhotoViewer(img.getAttribute("src"), img.getAttribute("alt") || "");
  });

  // Render dots
  dotsEl.innerHTML = (items || []).map((_, i) =>
    `<span class="photo-dot ${i===0?"active":""}" data-idx="${i}" aria-label="ç¬¬ ${i+1} å¼µ"></span>`
  ).join("");

  const dots = Array.from(dotsEl.querySelectorAll(".photo-dot"));
  const setActiveDot = (idx) => dots.forEach((d,i)=>d.classList.toggle("active", i===idx));

  // é» dot è·³è½‰
  dotsEl.addEventListener("click", (e) => {
    const dot = e.target.closest(".photo-dot");
    if (!dot) return;
    const idx = Number(dot.dataset.idx || 0);
    const slide = swiper.children[idx];
    if (!slide) return;
    slide.scrollIntoView({ behavior:"smooth", inline:"center", block:"nearest" });
  });

  // ä¾ scroll æ›´æ–° dot
  let raf = 0;
  swiper.addEventListener("scroll", () => {
    if (raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(() => {
      const w = swiper.clientWidth || 1;
      const idx = Math.round(swiper.scrollLeft / w);
      setActiveDot(Math.max(0, Math.min(idx, (items?.length||1)-1)));
    });
  }, { passive:true });
}

function initPhotoPage() {
	bindHeaderAddButtonsOnce(); 
  bindPhotoReplaceInputOnce();
  bindVideoLinkActionsOnce();
initPhotoGallery("photoSwiper",  "photoDots",  getAllAlbumItems(1));
initPhotoGallery("photoSwiper2", "photoDots2", getAllAlbumItems(2));

  initVideoGallery(); // âœ… æ–°å¢
  
}
// å½±ç‰‡ç›¸ç°¿ï¼ˆå°é¢ + é€£çµï¼‰

const VIDEO_LINKS = [
  { title: " é›ªä¸­æ¼«èˆ", url: "https://www.instagram.com/reel/DTSuz_zDLOZ/?utm_source=ig_web_copy_link&igsh=NTc4MTIwNjQ2YQ==" },
  { title: " èººé›ªå°‘å¥³", url: "https://www.instagram.com/reel/DTX1T-Aj9bu/?utm_source=ig_web_copy_link&igsh=NTc4MTIwNjQ2YQ==" },
  { title: " é›»å½±æ„Ÿå¤§ç‰‡", url: "https://www.instagram.com/reel/DRzWURAEmoO/?utm_source=ig_web_copy_link&igsh=NTc4MTIwNjQ2YQ==" },
  { title: " What is love", url: "https://www.instagram.com/reel/DTC2eN0gZdI/?utm_source=ig_web_copy_link&igsh=NTc4MTIwNjQ2YQ==" }
];

// ===== çŸ­å½±éŸ³é€£çµï¼šä½¿ç”¨è€…è‡ªè¨‚ï¼ˆlocalStorageï¼‰=====
const VIDEO_USER_LS_KEY = 'video_links_user_v1';

function loadUserVideoLinks(){
  try {
    const arr = JSON.parse(localStorage.getItem(VIDEO_USER_LS_KEY) || '[]');
    return Array.isArray(arr) ? arr : [];
  } catch(e){ return []; }
}
function saveUserVideoLinks(arr){
  try { localStorage.setItem(VIDEO_USER_LS_KEY, JSON.stringify(arr || [])); } catch(e) {}
}
function getAllVideoLinks(){
  const base = Array.isArray(VIDEO_LINKS) ? VIDEO_LINKS : [];
  const users = loadUserVideoLinks();
  return [...base, ...users];
}

function ensureModal(){
  return {
    modal: document.getElementById('itemModal'),
    titleEl: document.getElementById('modalTitle'),
    input: document.getElementById('modalInput'),
    ok: document.getElementById('modalOK'),
    cancel: document.getElementById('modalCancel')
  };
}

function openSingleInputModal({ title, placeholder, defaultValue='' }){
  const { modal, titleEl, input, ok, cancel } = ensureModal();
  if (!modal || !titleEl || !input || !ok || !cancel) {
    // fallback
    const v = prompt(title || '', defaultValue || '');
    return Promise.resolve((v || '').trim());
  }

  titleEl.textContent = title || 'è¼¸å…¥';
  input.placeholder = placeholder || '';
  input.value = defaultValue || '';

  // reset previous handlers
  ok.onclick = null;
  cancel.onclick = null;

  modal.style.display = 'flex';
  // iOSï¼šé¿å… autofocus é€ æˆæ²å‹•åç§»ï¼Œå»¶é² focus
  setTimeout(()=>{ try{ input.focus(); input.select(); }catch(e){} }, 50);

  return new Promise((resolve)=>{
    const close = (val)=>{
      modal.style.display = 'none';
      resolve((val || '').trim());
    };
    cancel.onclick = ()=> close('');
    ok.onclick = ()=> close(input.value);
  });
}

function normalizeUrl(u){
  u = String(u||'').trim();
  if (!u) return '';
  // if user pasted without protocol, prepend https
  if (!/^https?:\/\//i.test(u)) u = 'https://' + u;
  return u;
}

async function addVideoLinkFlow(){
  const urlRaw = await openSingleInputModal({
    title: 'æ–°å¢çŸ­å½±éŸ³é€£çµ',
    placeholder: 'è²¼ä¸Š IG Reel / YouTube Shorts é€£çµâ€¦'
  });
  const url = normalizeUrl(urlRaw);
  if (!url) return;

  // title optional
  const titleRaw = await openSingleInputModal({
    title: 'å½±ç‰‡æ¨™é¡Œï¼ˆå¯ç•™ç©ºï¼‰',
    placeholder: 'ä¾‹å¦‚ï¼šé›ªä¸­æ¼«èˆ',
    defaultValue: ''
  });

  const users = loadUserVideoLinks();
  const num = users.length + 1;
  users.push({ title: (titleRaw || `çŸ­å½±éŸ³ ${num}`), url });
  saveUserVideoLinks(users);
  renderVideoLinkCards();

  if (typeof photoToast === 'function') photoToast('âœ… å·²æ–°å¢çŸ­å½±éŸ³é€£çµ');
}

function removeLastVideoLink(){
  const users = loadUserVideoLinks();
  if (!users.length){
    if (typeof photoToast === 'function') photoToast('æ²’æœ‰å¯ç§»é™¤çš„æ–°å¢é€£çµ');
    return;
  }
  users.pop();
  saveUserVideoLinks(users);
  renderVideoLinkCards();
  if (typeof photoToast === 'function') photoToast('å·²ç§»é™¤æœ€å¾Œä¸€å€‹æ–°å¢é€£çµ');
}

function bindVideoLinkActionsOnce(){
  if (bindVideoLinkActionsOnce._bound) return;
  bindVideoLinkActionsOnce._bound = true;

  document.addEventListener('click', (e)=>{
    const addBtn = e.target.closest('.btn-add-video');
    if (addBtn){
      e.preventDefault();
      addVideoLinkFlow();
      return;
    }
    const rmBtn = e.target.closest('.btn-remove-video');
    if (rmBtn){
      e.preventDefault();
      removeLastVideoLink();
      return;
    }
  });
}


const PHOTO_USER_LS_KEY_1 = "photo_user_items__album1";
const PHOTO_USER_LS_KEY_2 = "photo_user_items__album2";

function loadUserItems(lsKey){
  try { return JSON.parse(localStorage.getItem(lsKey) || "[]") || []; }
  catch(e){ return []; }
}
function saveUserItems(lsKey, arr){
  localStorage.setItem(lsKey, JSON.stringify(arr || []));
}

function getAllAlbumItems(albumNo){
  const base = (albumNo === 1) ? PHOTO_ITEMS_1 : PHOTO_ITEMS_2;
  const users = loadUserItems(albumNo === 1 ? PHOTO_USER_LS_KEY_1 : PHOTO_USER_LS_KEY_2);
  return [...base, ...users];
}

function refreshPhotoAlbums(){
  const s1 = document.getElementById("photoSwiper");
  const d1 = document.getElementById("photoDots");
  const s2 = document.getElementById("photoSwiper2");
  const d2 = document.getElementById("photoDots2");

  if (s1) { delete s1.dataset.inited; s1.innerHTML = ""; }
  if (d1) d1.innerHTML = "";
  if (s2) { delete s2.dataset.inited; s2.innerHTML = ""; }
  if (d2) d2.innerHTML = "";

  initPhotoGallery("photoSwiper",  "photoDots",  getAllAlbumItems(1));
  initPhotoGallery("photoSwiper2", "photoDots2", getAllAlbumItems(2));
}

let __photoAddTargetAlbum = 1;

function bindHeaderAddButtonsOnce(){
  const input = document.getElementById("photoAddInput");
  if (!input || input.dataset.bound === "1") return;
  input.dataset.bound = "1";

  // å³ä¸Šè§’æ–°å¢æŒ‰éˆ•ï¼ˆç”¨ data-add-album æ±ºå®šè¦åŠ åˆ°å“ªå€‹æ¬„ä½ï¼‰
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".btn-add-photo[data-add-album]");
    if (!btn) return;
    __photoAddTargetAlbum = parseInt(btn.dataset.addAlbum, 10) || 1;
    input.value = "";
    input.click(); // âœ… ç”±æŒ‰éˆ• click è§¸ç™¼ï¼Œæ‰‹æ©Ÿ/iPhone å¯æ­£å¸¸é–‹ç›¸ç°¿
  });

  
  // å³ä¸Šè§’ç§»é™¤æŒ‰éˆ•ï¼ˆç§»é™¤è©²ç›¸ç°¿æœ€å¾Œä¸€å¼µæ–°å¢åœ–ç‰‡ï¼Œä¸å‹•å…§å»ºåœ–ï¼‰
  document.addEventListener("click", (e) => {
    const btn = e.target.closest(".btn-remove-photo[data-remove-album]");
    if (!btn) return;
    const albumNo = parseInt(btn.dataset.removeAlbum, 10) || 1;
    const lsKey = (albumNo === 1) ? PHOTO_USER_LS_KEY_1 : PHOTO_USER_LS_KEY_2;
    const arr = loadUserItems(lsKey);
    if (!arr.length) {
      if (typeof photoToast === "function") photoToast("æ²’æœ‰å¯ç§»é™¤çš„æ–°å¢åœ–ç‰‡");
      return;
    }
    arr.pop();
    saveUserItems(lsKey, arr);
    refreshPhotoAlbums();
    if (typeof photoToast === "function") photoToast("å·²ç§»é™¤æœ€å¾Œä¸€å¼µæ–°å¢åœ–ç‰‡");
  });

input.addEventListener("change", async ()=>{
    const files = Array.from(input.files || []);
    if (!files.length) return;

    const lsKey = (__photoAddTargetAlbum === 1) ? PHOTO_USER_LS_KEY_1 : PHOTO_USER_LS_KEY_2;
    const old = loadUserItems(lsKey);

    for (const f of files){
      if (!/^image\//.test(f.type || "")) continue;

      const dataUrl = await new Promise((resolve)=>{
        const r = new FileReader();
        r.onload = ()=>resolve(String(r.result || ""));
        r.readAsDataURL(f);
      });

      const key = `user_${Date.now()}_${Math.random().toString(16).slice(2)}`;
      old.push({ key, src: dataUrl, name: f.name || "æ–°å¢åœ–ç‰‡", desc: "" });
    }

    saveUserItems(lsKey, old);
    refreshPhotoAlbums();
  });
}

function initVideoGallery() {
  const swiperId = "videoSwiper";
  const dotsId = "videoDots";

  const swiper = document.getElementById(swiperId);
  const dotsEl = document.getElementById(dotsId);
  if (!swiper || !dotsEl) return;

  if (swiper.dataset.inited === "1") return;
  swiper.dataset.inited = "1";

  const esc = (s) => String(s ?? "")
    .replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")
    .replace(/"/g,"&quot;").replace(/'/g,"&#39;");

  swiper.innerHTML = (window.VIDEO_ITEMS || []).map(v => `
    <div class="photo-slide video-slide" data-url="${esc(v.url)}">
      <div class="video-cover">
        <img src="${esc(v.cover)}" alt="${esc(v.title)}">
        <div class="video-play-badge">â–¶</div>
      </div>
      <div class="photo-meta">
        <p class="photo-name">${esc(v.title)}</p>
        <p class="photo-desc">${esc(v.desc)}</p>
      </div>
    </div>
  `).join("");

  // é»å°é¢ â†’ é–‹é€£çµï¼ˆæ–°åˆ†é ï¼‰
  swiper.addEventListener("click", (e) => {
    const slide = e.target.closest(".video-slide");
    if (!slide) return;
    const url = slide.dataset.url;
    if (!url) return;
    window.open(url, "_blank");
  });

  // dots
  dotsEl.innerHTML = (window.VIDEO_ITEMS || []).map((_, i) =>
    `<span class="photo-dot ${i===0?"active":""}" data-idx="${i}"></span>`
  ).join("");

  const dots = Array.from(dotsEl.querySelectorAll(".photo-dot"));
  const setActiveDot = (idx) => dots.forEach((d,i)=>d.classList.toggle("active", i===idx));

  dotsEl.addEventListener("click", (e) => {
    const dot = e.target.closest(".photo-dot");
    if (!dot) return;
    const idx = Number(dot.dataset.idx || 0);
    const slide = swiper.children[idx];
    if (!slide) return;
    slide.scrollIntoView({ behavior:"smooth", inline:"center", block:"nearest" });
  });

  let raf = 0;
  swiper.addEventListener("scroll", () => {
    if (raf) cancelAnimationFrame(raf);
    raf = requestAnimationFrame(() => {
      const w = swiper.clientWidth || 1;
      const idx = Math.round(swiper.scrollLeft / w);
      setActiveDot(Math.max(0, Math.min(idx, (window.VIDEO_ITEMS?.length||1)-1)));
    });
  }, { passive:true });
}
function renderVideoLinkCards(){
  const ul = document.getElementById("videoLinkList");
  if (!ul) return;

  // âœ… ä½ åªè¦åœ¨é€™è£¡æ–°å¢/ä¿®æ”¹å½±ç‰‡é€£çµå°±å¥½
  const links = getAllVideoLinks();

  if (!links.length){
    ul.innerHTML = `<li><a href="javascript:void(0)" style="pointer-events:none;opacity:.6;">å°šæœªåŠ å…¥å½±ç‰‡é€£çµ<span class="video-link-sub">ï¼ˆä¹‹å¾Œå¯å†æ–°å¢ï¼‰</span></a></li>`;
    return;
  }

  const esc = (s)=>String(s??"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;");
  ul.innerHTML = links.map(v=>{
    const title = esc(v.title || "æœªå‘½åå½±ç‰‡");
    const url   = esc(v.url || "");
    const sub   = esc(v.sub || "");
    return `<li><a href="${url}" target="_blank" rel="noopener noreferrer">
      <span class="icon-play-outline"></span><span>${title}</span>${sub ? `<span class="video-link-sub">${sub}</span>` : ``}
    </a></li>`;
  }).join("");
}

function escapeHtml(s){
  return String(s||"")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;");
}


window.initPhotoPage = initPhotoPage;
window.renderVideoLinkCards = renderVideoLinkCards;

document.addEventListener("DOMContentLoaded", () => { initPhotoPage(); renderVideoLinkCards(); });
/* =========================
   Photo Viewer (Full Screen)
   - é»åœ–ç‰‡å…¨è¢å¹•æ”¾å¤§
   - é»èƒŒæ™¯/å³ä¸Šè§’/ESC é—œé–‰
========================= */
function openPhotoViewer(src, alt='') {
  const viewer = document.getElementById('photoViewer');
  const img = document.getElementById('photoViewerImg');
  if (!viewer || !img) return;

  img.src = src;
  img.alt = alt || '';
  viewer.classList.add('is-open');
  viewer.setAttribute('aria-hidden','false');

  // âœ… æ‰‹æ©Ÿï¼šé–ä½åº•å±¤æ²å‹•ï¼ˆä¸¦è¨˜ä½åŸæœ¬ç‹€æ…‹ï¼Œé—œé–‰æ™‚å¾©åŸï¼‰
  try {
    if (document.body.dataset.pvPrevOverflow === undefined) {
      document.body.dataset.pvPrevOverflow = document.body.style.overflow || '';
    }
    document.body.style.overflow = 'hidden';
  } catch(e){}

  // ç›¡é‡é€²å…¥çœŸæ­£å…¨è¢å¹•ï¼ˆiOS PWA/éƒ¨åˆ†ç€è¦½å™¨å¯èƒ½ä¸æ”¯æ´ï¼Œæ²’é—œä¿‚ï¼‰
  try {
    if (viewer.requestFullscreen) viewer.requestFullscreen();
  } catch(e){}
}

function closePhotoViewer() {
  const viewer = document.getElementById('photoViewer');
  const img = document.getElementById('photoViewerImg');
  if (!viewer) return;

  viewer.classList.remove('is-open');
  viewer.setAttribute('aria-hidden','true');
  if (img) img.src = '';

  // âœ… é—œé–‰æ™‚æ¢å¾©æ²å‹•
  try {
    const prev = document.body.dataset.pvPrevOverflow;
    document.body.style.overflow = (prev === undefined) ? '' : prev;
    delete document.body.dataset.pvPrevOverflow;
  } catch(e){}

  try {
    if (document.fullscreenElement && document.exitFullscreen) document.exitFullscreen();
  } catch(e){}
}

document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') closePhotoViewer();
});


// Photo viewer close handlers (once)
document.addEventListener('DOMContentLoaded', () => {
  const viewer = document.getElementById('photoViewer');
  if (!viewer || viewer.dataset.bound === '1') return;
  viewer.dataset.bound = '1';
  viewer.addEventListener('click', (e) => {
    if (e.target && e.target.getAttribute('data-close') === '1') closePhotoViewer();
  });
});


/* =========================
   TOP buttonï¼ˆscroll to topï¼‰
========================= */
const scrollBtn = document.getElementById("scrollToTop");

function bindScrollListener() {
  const page = getCurrentPage();
  if (!page || !scrollBtn) return;

  if (currentPageId !== "home-page") {
    scrollBtn.classList.remove("show");
    page.onscroll = null;
    return;
  }

  page.onscroll = () => {
    if (page.scrollTop > 300) scrollBtn.classList.add("show");
    else scrollBtn.classList.remove("show");
  };
}

if (scrollBtn) {
  scrollBtn.addEventListener("click", () => {
    scrollCurrentPageToTop("smooth");
  });
}

/* =========================
   Menuï¼ˆiOS å…¨è¢å¹•ï¼‰
   âœ… æœ€çµ‚ç‰ˆï¼šcapture æ””æˆª back ç‹€æ…‹ï¼Œå¾¹åº•é˜»æ­¢å…¶ä»– click listener é–‹ menu
========================= */
const menuBtn   = document.getElementById("menuBtn");
const menuClose = document.getElementById("menuClose");
const iosMenu   = document.getElementById("iosFullMenu");
const topbar    = document.querySelector(".topbar");

function openMenu() {
  if (!iosMenu) return;
  iosMenu.style.display = "flex";
  if (topbar) topbar.style.display = "none";
}

function closeMenu() {
  if (!iosMenu) return;
  iosMenu.style.display = "none";
  if (topbar) topbar.style.display = "flex";
}

if (menuBtn) {
  // â­ 1) æœ€å„ªå…ˆæ””æˆªï¼ˆcaptureï¼‰ï¼šåªè¦æ˜¯ back ç‹€æ…‹ï¼Œæ°¸é ä¸æœƒé–‹ menu
  menuBtn.addEventListener("click", (e) => {
    const isBackMode = document.body.classList.contains("nav-back");
    if (!isBackMode) return;

    e.preventDefault();
    e.stopImmediatePropagation(); // â­ é—œéµï¼šæ®ºæ‰å…¶ä»– click listener
    e.stopPropagation();

    closeMenu(); // ä¿è­‰ topbar å›ä¾†

    // å›ä¸Šä¸€å±¤ï¼šä½ æœ‰ goBack å°±ç”¨ goBack
    if (typeof goBack === "function") goBack();

    // ä¿åº•ï¼šå›åˆ°æ¸…å–®/ç¬¬ä¸€å±¤å¾Œåˆ‡å›æ¼¢å ¡ï¼ˆå¦‚æœä½ çš„ goBack å…§å·²ç¶“æœ‰ resetNavMenu ä¹Ÿæ²’é—œä¿‚ï¼‰
    resetNavMenu();
  }, true);

  // 2) ä¸€èˆ¬ç‹€æ…‹ï¼ˆbubbleï¼‰ï¼šé–‹ menu
  menuBtn.addEventListener("click", () => {
    openMenu();
  });
}

if (menuClose) {
  menuClose.addEventListener("click", closeMenu);
}

// menu é …ç›®
document.querySelectorAll(".menu-content li").forEach(li => {
  li.addEventListener("click", () => {
    const target = li.dataset.target;
    closeMenu();
    showPage(target);
  });
});

/* =========================
   Splash â†’ App å•Ÿå‹•
========================= */
document.addEventListener("DOMContentLoaded", () => {
  const splash = document.getElementById("app-splash");
  const app    = document.getElementById("app-root");

  PAGES.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.style.display = "none";
  });

  const images = [...document.images];
  let loaded = 0;

  function finish() {
    setTimeout(() => {
      if (splash) splash.classList.add("hide");
      setTimeout(() => {
        if (splash) splash.remove();
        if (app) app.classList.add("show");

        showPage("home-page");

        if (window.isFirstHomeRender) {
          safeCall(window.applyInitialHomeOffset);
        } else {
          bindScrollListener();
        }
      }, 400);
    }, 1800);
  }

  if (images.length === 0) {
    finish();
    return;
  }

  images.forEach(img => {
    if (img.complete) {
      loaded++;
      if (loaded === images.length) finish();
    } else {
      img.onload = img.onerror = () => {
        loaded++;
        if (loaded === images.length) finish();
      };
    }
  });
});

/* =========================
   å°å¤–å¯å‘¼å«ï¼ˆçµ¦ä½ ç”¨ï¼‰
========================= */
window.showHome     = () => showPage("home-page");
window.showPacking  = () => showPage("packing-page");
window.showTicket   = () => showPage("ticket-page");
window.showExchange = () => showPage("exchange-page");
window.showWeather  = () => showPage("weather-page");

// applyInitialHomeOffsetï¼ˆä¿ç•™ï¼Œä½†åŠ å®‰å…¨ï¼‰
window.applyInitialHomeOffset = window.applyInitialHomeOffset || function () {
  const home = document.getElementById("home-page");
  const tb = document.querySelector(".topbar");
  if (!home || !tb) return;

  home.style.marginTop = "0px";
  requestAnimationFrame(() => {
    home.scrollTop = 0;
    bindScrollListener();
  });

  window.isFirstHomeRender = false;
};

/* =========================
   Bottom nav click
========================= */
document.querySelectorAll(".bottom-nav button").forEach(btn => {
  btn.addEventListener("click", () => {
    const page = btn.dataset.page;

    showPage(page);

    document.querySelectorAll(".bottom-nav button")
      .forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
  });
});
</script>

<script>
/* =========================================================
   Weather Page â€“ FULL JS (Timezone-correct, no redeclare)
   âœ… æ”¯æ´ã€Œç›®å‰ä½ç½®ã€+ å›ºå®šåŸå¸‚
   âœ… ç”¨ utc_offset_seconds æ­£ç¢ºæ›ç®—ç•¶åœ°æ™‚é–“ï¼ˆä¸å†å…¨è®Šä¸‹åˆ4æ™‚ï¼‰
   âœ… èƒŒæ™¯ day/sunrise/sunset/night æ­£ç¢ºï¼ˆç”¨æ—¥å‡ºæ—¥è½ + offsetï¼‰
   âœ… é€²å…¥é é¢ï¼šåªé¡¯ç¤ºè¼‰å…¥ä¸­ï¼ˆé¿å…æ®˜ç•™æœ­å¹Œç•«é¢ï¼‰
   âœ… æ’­å ±ï¼šè¼‰å…¥ä¸­ -> finalï¼ˆä¸é–ƒå¤šå¥ï¼‰
   âœ… é›ªå‹•ç•«åªåœ¨å¤©æ°£é ï¼ˆé›¢é–‹è‡ªå‹•åœæ­¢/éš±è—ï¼‰
========================================================= */
(function(){
  "use strict";

  /* ---------------- Config ---------------- */
  const WX_ICON_BASE = "images/";
  const WX_ICON_MAP = {
    // day
    clear: "clear.png",
    partly_cloudy: "partly_cloudy.png",
    cloudy: "cloudy.png",
    fog: "fog.png",
    rain: "rain.png",
    heavy_rain: "heavy_rain.png",
    snow: "snow.png",
    heavy_snow: "heavy_snow.png",
    thunder: "thunder.png",
    wind: "wind.png",
    // night
    night_clear: "night_clear.png",
    night_partly_cloudy: "night_partly_cloudy.png",
    night_cloudy: "night_cloudy.png",
    // markers
    sunrise: "sunrise.png",
    sunset: "sunset.png",
    unknown: "unknown.png"
  };

  // Cities (0 = geo)
  window.WX_CITIES = window.WX_CITIES || [
    { name: "ç›®å‰ä½ç½®", kind: "geo",   lat: null,    lon: null },
    { name: "æœ­å¹Œå¸‚",   kind: "fixed", lat: 43.0618, lon: 141.3545 },
    { name: "ç¾ç‘›ç”º",   kind: "fixed", lat: 43.5883, lon: 142.4636 },
    { name: "å°æ¨½å¸‚",   kind: "fixed", lat: 43.1907, lon: 140.9947 },
    { name: "ç™»åˆ¥å¸‚",   kind: "fixed", lat: 42.4522, lon: 141.1791 },
  ];

  // âœ… Prevent redeclare across multiple <script> runs
  window.wxCityIndex ??= 0; // default geo
  let wxCityIndex = window.wxCityIndex;

  /* ---------------- DOM ---------------- */
  const $ = (id)=>document.getElementById(id);

  /* ---------------- State ---------------- */
  let wxInited = false;

  // snow
  let wxSnowBg = null;
  let wxSnowEnabled = false;

  // last known bg phase cache (for loading bg, per city)
  const WX_BG_CACHE_KEY = "wx_bg_cache_v2";

  /* =========================================================
     Safe helpers
  ========================================================= */
  function clamp(n,a,b){ return Math.max(a, Math.min(b, n)); }
  function rand(min,max){ return Math.random()*(max-min)+min; }

  function wxIconSrc(key){
    return WX_ICON_BASE + (WX_ICON_MAP[key] || WX_ICON_MAP.unknown);
  }

  function cityKey(city){
    if (!city) return "unknown";
    if (city.kind === "geo") return "geo";
    return `fixed:${city.lat},${city.lon}`;
  }
  function saveBgCache(key, payload){
    try{
      const all = JSON.parse(localStorage.getItem(WX_BG_CACHE_KEY) || "{}");
      all[key] = { ...payload, ts: Date.now() };
      localStorage.setItem(WX_BG_CACHE_KEY, JSON.stringify(all));
    }catch(e){}
  }
  function loadBgCache(key){
    try{
      const all = JSON.parse(localStorage.getItem(WX_BG_CACHE_KEY) || "{}");
      return all[key] || null;
    }catch(e){ return null; }
  }

  /* =========================================================
     Time utils (IMPORTANT: use UTC + utc_offset_seconds)
     Open-Meteo with timezone=UTC:
       hourly.time & daily.time are unix seconds (numbers)
       sunrise/sunset are unix seconds too
========================================================= */
  function localMsFromUnix(unixSec, offsetSec){
    return (Number(unixSec) + Number(offsetSec)) * 1000;
  }
  function localHour(localMs){
    // localMs already includes offset => read via UTC getters
    return new Date(localMs).getUTCHours();
  }
  function localDateKey(localMs){
  if (!Number.isFinite(localMs)) return "";     // âœ… é¿å… RangeError
  const d = new Date(localMs);
  if (Number.isNaN(d.getTime())) return "";     // âœ… å†ä¿éšªä¸€æ¬¡
  return d.toISOString().slice(0,10);
}

  function floorToHourLocal(localMs){
    const d = new Date(localMs);
    d.setUTCMinutes(0,0,0);
    return d.getTime();
  }
  function formatHourAmPmFromLocalMs(localMs){
    const h = localHour(localMs);
    const ampm = h < 12 ? "ä¸Šåˆ" : "ä¸‹åˆ";
    let h12 = h % 12;
    if (h12 === 0) h12 = 12;
    return `${ampm} ${h12} æ™‚`;
  }

  /* =========================================================
     Weather code normalize / text / icon
  ========================================================= */
  function isSnowCode(code){ return [71,73,75,77,85,86].includes(code); }
  function isHeavySnowCode(code){ return code === 86; }
  function isRainCode(code){ return [51,53,55,56,57,61,63,65,66,67,80,81,82].includes(code); }

  function normalizeWeatherCode(code, tempC){
    if (isRainCode(code) && Number.isFinite(tempC) && tempC <= 5){
      if ([65,66,67,81,82].includes(code)) return 86;
      return 71;
    }
    return code;
  }

  function weatherCodeToText(code){
    if (code === 0) return "æ™´å¤©";
    if (code === 1) return "æ™´æ™‚å¤šé›²";
    if (code === 2) return "å±€éƒ¨å¤šé›²";
    if (code === 3) return "å¤šé›²";
    if ([45,48].includes(code)) return "æœ‰éœ§";
    if ([51,53,55,56,57].includes(code)) return "æ¯›æ¯›é›¨";
    if ([61,63].includes(code)) return "ä¸‹é›¨";
    if ([65,66,67].includes(code)) return "å¤§é›¨";
    if ([71,73,75,77,85].includes(code)) return "ä¸‹é›ª";
    if (code === 86) return "å¤§é›ª";
    if ([95,96,99].includes(code)) return "é›·é›¨";
    return "å¤©æ°£è®ŠåŒ–";
  }
function weatherCodeToTextWithDayNight(code, isNight){
  // å…ˆæ‹¿åŸæœ¬çš„æè¿°
  const base = weatherCodeToText(code);

  // åªæœ‰ã€Œæ™´å¤©/æ™´æ™‚å¤šé›²/å±€éƒ¨å¤šé›²/å¤šé›²ã€é€™å¹¾ç¨®éœ€è¦æ”¹æˆå¤œé–“èªªæ³•
  if (!isNight) return base;

  if (code === 0) return "å¤œæ™šæ™´æœ—";
  if (code === 1) return "å¤œæ™šå¤šé›²";
  if (code === 2) return "å±€éƒ¨å¤šé›²";
  if (code === 3) return "å¤œæ™šå¤šé›²";

  // å…¶ä»–ï¼ˆé›¨ã€é›ªã€éœ§ã€é›·é›¨ï¼‰å¤œæ™šç…§åŸæœ¬æè¿°å°±åˆç†
  return base;
}

  function weatherCodeToIconKey(code, isNight){
    // snow
    if ([71,73,75,77,85].includes(code)) return "snow";
    if (code === 86) return "heavy_snow";
    // thunder
    if ([95,96,99].includes(code)) return "thunder";
    // fog
    if ([45,48].includes(code)) return "fog";
    // rain
    if ([51,53,55,56,57,61,63].includes(code)) return "rain";
    if ([65,66,67,80,81,82].includes(code)) return "heavy_rain";

    // clear/cloud
    if (code === 0) return isNight ? "night_clear" : "clear";
    if ([2,3].includes(code)) return isNight ? "night_cloudy" : "cloudy";
    if (code === 1) return isNight ? "night_partly_cloudy" : "partly_cloudy";
    return "unknown";
  }

  /* =========================================================
     Sun / Background phase
  ========================================================= */
  function isNightBySun(nowLocalMs, sunriseLocalMs, sunsetLocalMs){
    if (!Number.isFinite(sunriseLocalMs) || !Number.isFinite(sunsetLocalMs)) return false;
    return !(nowLocalMs >= sunriseLocalMs && nowLocalMs < sunsetLocalMs);
  }

  function getDayPhase(nowLocalMs, sunriseLocalMs, sunsetLocalMs, twilightMin=45){
    if (!Number.isFinite(sunriseLocalMs) || !Number.isFinite(sunsetLocalMs)) return "day";
    const t = twilightMin * 60 * 1000;

    const sunriseStart = sunriseLocalMs - t;
    const sunriseEnd   = sunriseLocalMs + t;
    const sunsetStart  = sunsetLocalMs - t;
    const sunsetEnd    = sunsetLocalMs + t;

    if (nowLocalMs >= sunriseStart && nowLocalMs < sunriseEnd) return "sunrise";
    if (nowLocalMs >= sunriseEnd   && nowLocalMs < sunsetStart) return "day";
    if (nowLocalMs >= sunsetStart  && nowLocalMs < sunsetEnd) return "sunset";
    return "night";
  }

  function setBgClass(page, cls){
    page.classList.remove("bg-sunrise","bg-day","bg-sunset","bg-night");
    page.classList.add(cls);
  }

  /* =========================================================
     Snow only on weather page
  ========================================================= */
  function getSnowModeFromCode(codeNowN){
    if (isHeavySnowCode(codeNowN)) return "heavySnow";
    if (isSnowCode(codeNowN)) return "snow";
    return "flurry";
  }

  function applySnowModeClass(page, mode){
    page.classList.remove("snow-flurry","snow-snow","snow-heavy");
    if (mode === "heavySnow") page.classList.add("snow-heavy");
    else if (mode === "snow") page.classList.add("snow-snow");
    else page.classList.add("snow-flurry");
  }

  class SnowBackground{
    constructor({canvas, mode="flurry"}){
      this.canvas = canvas;
      this.ctx = canvas.getContext("2d");
      this.mode = mode;

      this.dpr = window.devicePixelRatio || 1;
      this.w = 0;
      this.h = 0;

      this.particles = [];
      this.windBase = 0;
      this.windTarget = 0;
      this.windT = 0;

      this.last = performance.now();
      this.rafId = null;

      this._onResize = this._onResize.bind(this);
      this._loop = this._loop.bind(this);

      this._init();
    }

    _pickParams(mode){
      if (mode === "heavySnow"){
        return { count: 50, rMin: 1.8, rMax: 4,   vyMin: 0.25, vyMax: 0.60, wind: 0.15 };
      }
      if (mode === "snow"){
        return { count: 36, rMin: 1.6, rMax: 3.8, vyMin: 0.20, vyMax: 0.52, wind: 0.10 };
      }
      return { count: 14, rMin: 1.4, rMax: 2.8, vyMin: 0.14, vyMax: 0.45, wind: 0.06 };
    }

    _onResize(){
      this.w = Math.floor(window.innerWidth);
      this.h = Math.floor(window.innerHeight);

      this.canvas.width  = Math.floor(this.w * this.dpr);
      this.canvas.height = Math.floor(this.h * this.dpr);
      this.canvas.style.width  = this.w + "px";
      this.canvas.style.height = this.h + "px";

      this.ctx.setTransform(this.dpr, 0, 0, this.dpr, 0, 0);
    }

    _init(){
      this._onResize();
      window.addEventListener("resize", this._onResize);
      this._resetParticles();
      this.start();
    }

    _resetParticles(){
      const p = this._pickParams(this.mode);
      this.params = p;

      this.windBase = rand(-p.wind, p.wind);
      this.windTarget = rand(-p.wind, p.wind);
      this.windT = 0;

      this.particles = Array.from({length:p.count}).map(()=>({
        x: rand(0, this.w),
        y: rand(0, this.h),
        r: rand(p.rMin, p.rMax),
        vy: rand(p.vyMin, p.vyMax),
        vx: rand(-p.wind, p.wind),
        tx: rand(-0.07, 0.07),
        tvx: rand(0.001, 0.006),
        opacity: rand(0.45, 0.90),
      }));
    }

    _stepWind(){
      this.windT += 1/900;
      if (this.windT >= 1){
        this.windT = 0;
        this.windBase = this.windTarget;
        this.windTarget = rand(-this.params.wind, this.params.wind);
      }
      const t = this.windT;
      const smooth = t*t*(3-2*t);
      return this.windBase + (this.windTarget - this.windBase)*smooth;
    }

    setMode(mode){
      if (mode === this.mode) return;
      this.mode = mode;
      this._resetParticles();
    }

    start(){
      if (this.rafId) return;
      this.last = performance.now();
      this.rafId = requestAnimationFrame(this._loop);
    }

    stop(){
      if (this.rafId) cancelAnimationFrame(this.rafId);
      this.rafId = null;
    }

    _applyBottomFadeMask(){
      const ctx = this.ctx;
      const h = this.canvas.height / this.dpr;
      const w = this.canvas.width / this.dpr;

      const fadeStart = h * 0.70;
      const fadeEnd   = h * 0.99;

      ctx.save();
      ctx.globalCompositeOperation = "destination-in";
      const g = ctx.createLinearGradient(0, 0, 0, h);
      g.addColorStop(0.00, "rgba(255,255,255,1)");
      g.addColorStop(fadeStart / h, "rgba(255,255,255,1)");
      g.addColorStop(fadeEnd   / h, "rgba(255,255,255,0)");
      ctx.fillStyle = g;
      ctx.fillRect(0, 0, w, h);
      ctx.restore();
    }

    _loop(now){
      const dt = clamp((now - this.last)/16.666, 0.5, 2.2);
      this.last = now;

      const ctx = this.ctx;
      const wind = this._stepWind();

      ctx.clearRect(0,0,this.w,this.h);

      for (const s of this.particles){
        s.tx += (Math.random() - 0.5) * s.tvx * dt;
        s.tx = clamp(s.tx, -0.16, 0.16);

        s.x += (s.vx + wind + s.tx) * 0.75 * dt;
        s.y += s.vy * 1.15 * dt;

        if (s.x < -12) s.x = this.w + 12;
        if (s.x > this.w + 12) s.x = -12;

        if (s.y > this.h + 12){
          s.y = rand(-120, -10);
          s.x = rand(0, this.w);
          s.r = rand(this.params.rMin, this.params.rMax);
          s.vy = rand(this.params.vyMin, this.params.vyMax);
          s.vx = rand(-this.params.wind, this.params.wind);
          s.opacity = rand(0.45, 0.90);
          s.tx = rand(-0.07, 0.07);
          s.tvx = rand(0.001, 0.006);
        }

        const r = s.r;
        const grad = ctx.createRadialGradient(s.x, s.y, 0, s.x, s.y, r);
        grad.addColorStop(0.0,  `rgba(255,255,255,${0.75 * s.opacity})`);
        grad.addColorStop(0.55, `rgba(255,255,255,${0.28 * s.opacity})`);
        grad.addColorStop(1.0,  `rgba(255,255,255,0)`);

        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(s.x, s.y, r, 0, Math.PI*2);
        ctx.fill();
      }

      this._applyBottomFadeMask();
      this.rafId = requestAnimationFrame(this._loop);
    }
  }

  function ensureSnowCanvas(){
    let c = document.getElementById("wxSnowCanvas");
    if (!c){
      c = document.createElement("canvas");
      c.id = "wxSnowCanvas";
      c.style.position = "fixed";
      c.style.inset = "0";
      c.style.pointerEvents = "none";
      c.style.zIndex = "0";
      document.body.appendChild(c);
    }
    return c;
  }

  function enableSnow(){
    wxSnowEnabled = true;
    const c = ensureSnowCanvas();
    c.style.display = "block";
    if (wxSnowBg) wxSnowBg.start();
  }
  function disableSnow(){
    wxSnowEnabled = false;
    const c = document.getElementById("wxSnowCanvas");
    if (c) c.style.display = "none";
    if (wxSnowBg) wxSnowBg.stop();
  }
  window.WX_LeaveWeatherPage = disableSnow; // showPage é›¢é–‹æ™‚å¯å‘¼å«

  /* =========================================================
     Broadcast (no flicker)
  ========================================================= */
  function setBroadcastText(text){
    const el = $("wxHourlyNote") || $("nowBroadcast") || $("wxNowBroadcast");
    if (!el) return;

    const t = el.querySelector(".wx-broadcast-text");
    if (t) { t.textContent = text || ""; return; }

    el.innerHTML = `
      <span class="icon-information-outline" aria-hidden="true"></span>
      <span class="wx-broadcast-space"></span>
      <span class="wx-broadcast-text">${text || ""}</span>
    `;
  }

  /* =========================================================
     Broadcast logic (one sentence)
  ========================================================= */
  function getPeriodLabel(localMs){
    const h = localHour(localMs);
    if (h >= 5 && h < 11) return "æ—©ä¸Š";
    if (h >= 11 && h < 17) return "ä¸‹åˆ";
    if (h >= 17 && h < 22) return "æ™šä¸Š";
    return "æ·±å¤œ";
  }
  function kindFromCode(code){
    if (isHeavySnowCode(code)) return "heavy_snow";
    if (isSnowCode(code)) return "snow";
    if ([95,96,99].includes(code)) return "thunder";
    if ([45,48].includes(code)) return "fog";
    if (isRainCode(code)) return "rain";
    if (code === 0) return "clear";
    if ([1,2,3].includes(code)) return "cloud";
    return "other";
  }
  function kindName(kind){
    if (kind==="heavy_snow") return "å¤§é›ª";
    if (kind==="snow") return "ä¸‹é›ª";
    if (kind==="rain") return "é™é›¨";
    if (kind==="fog") return "èµ·éœ§";
    if (kind==="thunder") return "é›·é›¨";
    if (kind==="clear") return "æ™´æœ—";
    if (kind==="cloud") return "å¤šé›²";
    return "å¤©æ°£è®ŠåŒ–";
  }
  function dominantKind(codes){
    const cnt = new Map();
    for (const c of codes){
      const k = kindFromCode(c);
      cnt.set(k, (cnt.get(k)||0)+1);
    }
    let best="other", bestN=-1;
    for (const [k,n] of cnt.entries()){
      if (n>bestN){ bestN=n; best=k; }
    }
    return best;
  }
  function buildNaturalChangeText(period, kind){
    const k = kindName(kind);
    if (period==="æ—©ä¸Š") return `ä»Šæ—¥æ—©ä¸Š${k}`;
    if (period==="ä¸‹åˆ") return `ä»Šæ—¥ä¸‹åˆé–‹å§‹${k}`;
    if (period==="æ™šä¸Š") return `ä»Šæ™šé–‹å§‹æœ‰${k}`;
    if (period==="æ·±å¤œ") return `æ·±å¤œå°‡è½‰ç‚º${k}`;
    return `${period}${k}`;
  }
  function buildTips({ tempNow, minT, maxT, windNow, codeNowN }){
    const tips = [];
    if (isSnowCode(codeNowN)) tips.push("è·¯é¢å¯èƒ½çµå†°æˆ–æ¿•æ»‘ï¼Œè¡Œèµ°èˆ‡è¡Œè»Šè«‹æ”¾æ…¢é€Ÿåº¦");
    if (isRainCode(codeNowN)) tips.push("å¤–å‡ºå¯èƒ½é‡é›¨ï¼Œè¨˜å¾—æ”œå¸¶é›¨å…·ä¸¦ç•™æ„é˜²æ»‘");
    if (Number.isFinite(minT) && minT <= -5) tips.push("ä»Šæ—¥ä½æº«æ˜é¡¯ï¼Œå¤–å‡ºè«‹ç‰¹åˆ¥æ³¨æ„ä¿æš–");
    if (Number.isFinite(tempNow) && tempNow <= 0) tips.push("æ°£æº«åä½ï¼Œå»ºè­°æ´‹è”¥å¼ç©¿æ­ä»¥èª¿æ•´é«”æ„Ÿ");
    if (Number.isFinite(minT) && Number.isFinite(maxT) && (maxT - minT) >= 10) tips.push("æ—¥å¤œæº«å·®è¼ƒå¤§ï¼Œå¤–å¥—å»ºè­°éš¨èº«æ”œå¸¶");
    if (Number.isFinite(windNow) && windNow >= 25) tips.push("é¢¨å‹¢åå¼·ï¼Œé«”æ„Ÿæº«åº¦å¯èƒ½æ›´ä½");
    if ([45,48].includes(codeNowN)) tips.push("èƒ½è¦‹åº¦å¯èƒ½ä¸‹é™ï¼Œè¡Œè»Šè«‹ç•™æ„å®‰å…¨è·é›¢");
    tips.push("é«”æ„Ÿæº«åº¦åä½ï¼Œå¤–å‡ºæ™‚æ³¨æ„ä¿æš–");
    tips.push("æ°£æº«æŒçºŒåä½ï¼Œå®¤å¤–æ´»å‹•è¨˜å¾—åŠ ä»¶å¤–å¥—");
    tips.push("æ¸…æ™¨èˆ‡å¤œé–“è·¯é¢æ˜“çµå†°ï¼Œè¡Œèµ°è«‹æ”¾æ…¢è…³æ­¥");
    tips.push("é™é›ªå¾Œè¦–ç·šå¯èƒ½å—å½±éŸ¿ï¼Œè¡Œè»Šè«‹ç•™æ„è·¯æ³");
    tips.push("é¢¨å‹¢å¶çˆ¾åå¼·ï¼Œé«”æ„Ÿæº«åº¦å¯èƒ½æ›´ä½");
    return tips[Math.floor(Math.random() * tips.length)];
  }
  function buildSmartBroadcast({ tempNow, windNow, codeNowN, dayMin, dayMax, sliceUnix, sliceTemps, sliceCodes, offsetSec }){
    const timesLocalMs = sliceUnix.map(sec => localMsFromUnix(sec, offsetSec));
    const buckets = new Map();

    for (let i=0;i<timesLocalMs.length;i++){
      const p = getPeriodLabel(timesLocalMs[i]);
      if (!buckets.has(p)) buckets.set(p, { codes: [] });
      buckets.get(p).codes.push(normalizeWeatherCode(sliceCodes[i], sliceTemps[i]));
    }

    const periods = ["æ—©ä¸Š","ä¸‹åˆ","æ™šä¸Š","æ·±å¤œ"].filter(p => buckets.has(p));
    const kinds = periods.map(p => ({ period:p, kind: dominantKind(buckets.get(p).codes) }));

    const changes = [];
    for (let i=1;i<kinds.length;i++){
      if (kinds[i].kind !== kinds[i-1].kind){
        changes.push({ at: kinds[i].period, to: kinds[i].kind });
      }
    }

    if (changes.length){
      return changes.slice(0,2).map(c => buildNaturalChangeText(c.at, c.to)).join("ï¼Œ");
    }
    return buildTips({ tempNow, minT: dayMin, maxT: dayMax, windNow, codeNowN });
  }

  /* =========================================================
     UI: Dots + Swipe + init once
  ========================================================= */
  function renderDots(){
    const dots = $("wxDots");
    if (!dots) return;
    dots.innerHTML = WX_CITIES.map((c,i)=>{
      const active = i===wxCityIndex ? "active":"";
      return `<div class="wx-dot ${active}" data-index="${i}" role="button" aria-label="${c.name}"></div>`;
    }).join("");
  }
  function setDotsActive(){
    const dots = $("wxDots");
    if (!dots) return;
    dots.querySelectorAll(".wx-dot").forEach(d=>{
      d.classList.toggle("active", Number(d.dataset.index)===wxCityIndex);
    });
  }
  function resetWeatherPageScroll(){
    const page = $("weather-page");
    if (page) page.scrollTop = 0;
    const hourly = $("wxHourly");
    if (hourly) hourly.scrollLeft = 0;
  }

  function bindWeatherSwipe(){
    const page = $("weather-page");
    if (!page) return;

    const SWIPE_MIN_X = 60;
    const SWIPE_MAX_Y = 70;
    let sx=0, sy=0, tracking=false;

    page.addEventListener("touchstart",(e)=>{
      if (e.target.closest("#wxHourly")) return;
      const t = e.touches[0];
      sx=t.clientX; sy=t.clientY;
      tracking=true;
    },{passive:true});

    page.addEventListener("touchend",(e)=>{
      if(!tracking) return;
      tracking=false;
      const t=e.changedTouches[0];
      const dx=t.clientX-sx;
      const dy=t.clientY-sy;
      if (Math.abs(dy) > SWIPE_MAX_Y) return;

      if (dx <= -SWIPE_MIN_X) switchCity(Math.min(WX_CITIES.length-1, wxCityIndex+1));
      else if (dx >= SWIPE_MIN_X) switchCity(Math.max(0, wxCityIndex-1));
    },{passive:true});
  }

  async function switchCity(index){
    if (index === wxCityIndex) return;
    wxCityIndex = index;
    window.wxCityIndex = wxCityIndex;
    setDotsActive();
    resetWeatherPageScroll();
    await loadAndRenderWeather();
  }

  function initWeatherPageOnce(){
    if (wxInited) return;
    wxInited = true;

    renderDots();

    const dots = $("wxDots");
    if (dots){
      dots.addEventListener("click",(e)=>{
        const dot = e.target.closest(".wx-dot");
        if (!dot) return;
        const idx = Number(dot.dataset.index);
        if (!Number.isFinite(idx)) return;
        switchCity(idx);
      });
    }

    bindWeatherSwipe();
  }
  window.initWeatherPageOnce = initWeatherPageOnce;

  /* =========================================================
     Loading UI control (only show "loading")
     - Requires your CSS to hide content when #weather-page.is-loading
     - If you don't have it, still ok; we clear main fields here.
  ========================================================= */
  function clearWeatherContent(){
    const idsText = ["wxCity","wxTemp","wxDesc","wxHiLo"];
    idsText.forEach(id => { const el=$(id); if(el) el.textContent=""; });

    const idsHtml = ["wxHourly","wxWeek"];
    idsHtml.forEach(id => { const el=$(id); if(el) el.innerHTML=""; });

    // broadcast
    const b = $("wxHourlyNote") || $("nowBroadcast") || $("wxNowBroadcast");
    if (b) {
      const t = b.querySelector(".wx-broadcast-text");
      if (t) t.textContent = "";
      else b.innerHTML = "";
    }
  }

  function showWeatherLoading(){
    const page = $("weather-page");
    if (!page) return;

    // remove old bg
    page.classList.remove("bg-sunrise","bg-day","bg-sunset","bg-night");

    // use cached phase for this city if any
    const city = WX_CITIES[wxCityIndex];
    const cache = loadBgCache(cityKey(city));
    if (cache?.phase) setBgClass(page, `bg-${cache.phase}`);
    else setBgClass(page, "bg-day"); // safe fallback (avoid white)

    clearWeatherContent();
    page.classList.add("is-loading");

    // show loading text in broadcast
    setBroadcastText("è¼‰å…¥ä¸­â€¦");
  }

  function hideWeatherLoading(){
    const page = $("weather-page");
    if (!page) return;
    page.classList.remove("is-loading");
  }

  /* =========================================================
     Geo location
  ========================================================= */
  function WX_getCurrentPositionOnce(timeoutMs = 8000){
    return new Promise((resolve, reject) => {
      if (!navigator.geolocation) return reject(new Error("Geolocation not supported"));
      navigator.geolocation.getCurrentPosition(
        (pos) => resolve(pos),
        (err) => reject(err),
        { enableHighAccuracy: true, timeout: timeoutMs, maximumAge: 5*60*1000 }
      );
    });
  }

  /* =========================================================
     API build (IMPORTANT)
     - Use timezone=UTC to get unix seconds arrays consistently
     - Then use utc_offset_seconds for local conversion
  ========================================================= */
 function buildWeatherApiUrl(city){
  const lat = Number(city?.lat);
  const lon = Number(city?.lon);
  if (!Number.isFinite(lat) || !Number.isFinite(lon)) return "";

  return `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`
    + `&current_weather=true`
    + `&hourly=temperature_2m,weathercode`
    + `&daily=weathercode,temperature_2m_max,temperature_2m_min,sunrise,sunset`
    + `&timezone=auto`          // âœ… è®“ Open-Meteo ç”¨ã€Œåœ°é»ã€æ™‚å€ç®— sunrise/sunset
    + `&timeformat=unixtime`;   // âœ… æ‰€æœ‰ time éƒ½æ˜¯ epoch ç§’æ•¸ï¼Œæœ€å¥½è™•ç†
}


  /* =========================================================
     Render helpers
  ========================================================= */
function renderHeader({ cityName, tempNowInt, descText, hiInt, loInt }){
  const cityEl = $("wxCity"), tempEl = $("wxTemp"), descEl = $("wxDesc"), hiloEl = $("wxHiLo");
  if (cityEl) cityEl.textContent = cityName;
  if (tempEl) tempEl.textContent = Number.isFinite(tempNowInt) ? String(tempNowInt) : "--";
  if (descEl) descEl.textContent = descText || "";   // âœ… é€™è¡Œæœƒé¡¯ç¤ºå¤©æ°£ç‹€æ…‹
  if (hiloEl) hiloEl.textContent = `æœ€é«˜ ${Number.isFinite(hiInt)?hiInt:"--"}Â° / æœ€ä½ ${Number.isFinite(loInt)?loInt:"--"}Â°`;
}



 function buildSunByDate(daily, offsetSec){
  const m = new Map();
  const sr = daily?.sunrise || [];
  const ss = daily?.sunset  || [];

  for (let i=0; i<Math.min(sr.length, ss.length); i++){
    const sunriseLocalMs = localMsFromUnix(sr[i], offsetSec);
    const sunsetLocalMs  = localMsFromUnix(ss[i], offsetSec);

    const key = localDateKey(sunriseLocalMs);
    if (!key) continue; // âœ… sunrise/sunset ä¸æ˜¯åˆæ³•æ™‚é–“å°±ç•¥é

    m.set(key, { sunriseLocalMs, sunsetLocalMs });
  }
  return m;
}


  function nearestIndex(timesLocalMs, eventLocalMs){
    let best=-1, bestDiff=Infinity;
    for (let i=0;i<timesLocalMs.length;i++){
      const diff = Math.abs(timesLocalMs[i]-eventLocalMs);
      if (diff < bestDiff){ bestDiff=diff; best=i; }
    }
    return best;
  }

 function renderHourly24({
  hourlyUnix, temps, codes,
  offsetSec,
  sunByDate,      // Map(key => { sunriseLocalMs, sunsetLocalMs })
  nowLocalMs,
  current
}){
  const wrap = document.getElementById("wxHourly");
  if (!wrap) return;

  const timesLocalMs = hourlyUnix.map(sec => localMsFromUnix(sec, offsetSec));

  // æ‰¾ 24h ç¯„åœå…§æœ€è¿‘çš„æ—¥å‡º/æ—¥è½ï¼Œç”¨ä¾†æ’ marker
  const start = timesLocalMs[0];
  const end   = timesLocalMs[timesLocalMs.length - 1] + 3600000;

  let sunriseEvent = NaN;
  let sunsetEvent  = NaN;
  for (const v of sunByDate.values()){
    if (!Number.isFinite(sunriseEvent) && v.sunriseLocalMs >= start && v.sunriseLocalMs <= end) sunriseEvent = v.sunriseLocalMs;
    if (!Number.isFinite(sunsetEvent)  && v.sunsetLocalMs  >= start && v.sunsetLocalMs  <= end) sunsetEvent  = v.sunsetLocalMs;
  }

  function nearestIndex(arr, target){
    let best=-1, bestDiff=Infinity;
    for (let i=0;i<arr.length;i++){
      const diff = Math.abs(arr[i]-target);
      if (diff < bestDiff){ bestDiff=diff; best=i; }
    }
    return best;
  }

  const sunriseIdx = Number.isFinite(sunriseEvent) ? nearestIndex(timesLocalMs, sunriseEvent) : -1;
  const sunsetIdx  = Number.isFinite(sunsetEvent)  ? nearestIndex(timesLocalMs, sunsetEvent)  : -1;

  wrap.innerHTML = timesLocalMs.map((ms, i)=>{
    // ç¾åœ¨ï¼šç”¨ current_weather å¼·åˆ¶è¦†è“‹ç¬¬ä¸€æ ¼ï¼Œé¿å…å’Œ hourly ç¬¬ä¸€ç­†ä¸åŒæ­¥
    let tempC, codeN;
    if (i === 0 && current){
      tempC = current.temp;
      codeN = current.code;
    } else {
      tempC = temps[i];
      codeN = normalizeWeatherCode(codes[i], tempC);
    }

    // å–å¾—ç•¶æ—¥ sunrise/sunset åˆ¤æ–·æ—¥å¤œï¼ˆç”¨åœ°é»ç•¶åœ° keyï¼‰
    const key = localDateKey(ms); // ä½ åŸæœ¬çš„ localDateKeyï¼ˆè¦ç”¨ getUT...ç‰ˆæœ¬ï¼‰
    const sun = sunByDate.get(key) || sunByDate.get(localDateKey(nowLocalMs));
    const night = (sun && Number.isFinite(sun.sunriseLocalMs) && Number.isFinite(sun.sunsetLocalMs))
      ? isNightBySun(ms, sun.sunriseLocalMs, sun.sunsetLocalMs)
      : false;

    let iconKey;
    if (i === sunriseIdx) iconKey = "sunrise";
    else if (i === sunsetIdx) iconKey = "sunset";
    else iconKey = weatherCodeToIconKey(codeN, night);

    const timeLabel = (i === 0) ? "ç¾åœ¨" : formatHourAmPmFromLocalMs(ms);
    const tempText  = Number.isFinite(tempC) ? `${Math.round(tempC)}Â°` : "--";

    return `
      <div class="wx-hour">
        <div class="wx-hour-time">${timeLabel}</div>
        <img class="wx-hour-icon" src="${wxIconSrc(iconKey)}" alt="${iconKey}">
        <div class="wx-hour-temp">${tempText}</div>
      </div>
    `;
  }).join("");
}


  function renderWeek({ daily, nowLocalMs, offsetSec }){
    const wrap = $("wxWeek");
    if (!wrap) return;

    const times = daily?.time || [];
    const minArr = daily?.temperature_2m_min || [];
    const maxArr = daily?.temperature_2m_max || [];
    const codes  = daily?.weathercode || [];

    const n = Math.min(7, times.length, minArr.length, maxArr.length, codes.length);
    if (!n) return;

    // align to local today key
    const todayKey = localDateKey(nowLocalMs);
    let startIdx = 0;
    const idx = times.findIndex(t => localDateKey(localMsFromUnix(t, offsetSec)) === todayKey);
    if (idx >= 0) startIdx = idx;

    const n2 = Math.min(7, times.length - startIdx);
    if (!n2) return;

    const sliceMin = minArr.slice(startIdx, startIdx+n2).map(Number);
    const sliceMax = maxArr.slice(startIdx, startIdx+n2).map(Number);

    const allMin = Math.min(...sliceMin);
    const allMax = Math.max(...sliceMax);
    const span = Math.max(1, allMax - allMin);

    const weekMap = ["æ—¥","ä¸€","äºŒ","ä¸‰","å››","äº”","å…­"];
    function weekLabelFromLocalDay(localMs){
      const d = new Date(localMs);
      // localMs already shifted; use UTC day to represent local
      const w = d.getUTCDay();
      return `é€±${weekMap[w]}`;
    }

    const rows = [];
    for (let k=0;k<n2;k++){
      const i = startIdx + k;
      const dayLocalMs = localMsFromUnix(times[i], offsetSec);
      const label = (k===0) ? "ä»Šæ—¥" : weekLabelFromLocalDay(dayLocalMs);

      const minT = Math.round(minArr[i]);
      const maxT = Math.round(maxArr[i]);
      const codeN = normalizeWeatherCode(codes[i], (minArr[i]+maxArr[i])/2);
      const iconKey = weatherCodeToIconKey(codeN, false);

      const leftPct = ((minT - allMin)/span)*100;
      const widthPct = ((maxT - minT)/span)*100;

      rows.push(`
        <div class="wx-week-row">
          <div class="wx-week-day">${label}</div>
          <img class="wx-week-icon" src="${wxIconSrc(iconKey)}" alt="${iconKey}">
          <div class="wx-week-min">${minT}Â°</div>
          <div class="wx-week-bar">
            <span style="left:${leftPct}%; width:${Math.max(6,widthPct)}%;"></span>
          </div>
          <div class="wx-week-max">${maxT}Â°</div>
        </div>
      `);
    }
    wrap.innerHTML = rows.join("");
  }

  /* =========================================================
     Main loader
  ========================================================= */
  async function loadAndRenderWeather(){
    const page = $("weather-page");
    if (!page) return;

    enableSnow();

    // geo -> get position once per entry
    if (WX_CITIES[wxCityIndex]?.kind === "geo"){
      try{
        setBroadcastText("æ­£åœ¨å–å¾—ç›®å‰ä½ç½®â€¦");
        const pos = await WX_getCurrentPositionOnce(8000);
        WX_CITIES[0].lat = pos.coords.latitude;
        WX_CITIES[0].lon = pos.coords.longitude;
      }catch(e){
        console.warn("å®šä½å¤±æ•—/è¢«æ‹’çµ•ï¼Œæ”¹ç”¨æœ­å¹Œ", e);
        wxCityIndex = 1;
        window.wxCityIndex = wxCityIndex;
        setDotsActive();
      }
    }

    const city = WX_CITIES[wxCityIndex];
    const url = buildWeatherApiUrl(city);
    if (!url){
      setBroadcastText("ç„¡æ³•å–å¾—å¤©æ°£ï¼ˆç¼ºå°‘åº§æ¨™ï¼‰");
      return;
    }

    setBroadcastText("è¼‰å…¥ä¸­â€¦");

    try{
      const data = await fetch(url).then(r=>r.json());

      // âœ… offsetSec is the truth for local conversion
      const offsetSec = Number(data?.utc_offset_seconds ?? 0);
      const nowLocalMs = Date.now() + offsetSec*1000;

      // sun
      const sunByDate = buildSunByDate(data?.daily, offsetSec);
      const todayKey = localDateKey(nowLocalMs);
      const sunToday = sunByDate.get(todayKey) || Array.from(sunByDate.values())[0] || null;

      // background phase
      if (sunToday && Number.isFinite(sunToday.sunriseLocalMs) && Number.isFinite(sunToday.sunsetLocalMs)){
        const phase = getDayPhase(nowLocalMs, sunToday.sunriseLocalMs, sunToday.sunsetLocalMs, 45);
        setBgClass(page, `bg-${phase}`);

        // cache for loading bg next time
        saveBgCache(cityKey(city), { phase });
      } else {
        setBgClass(page, "bg-day");
        saveBgCache(cityKey(city), { phase: "day" });
      }

      // current
      const tempNow = data?.current_weather?.temperature;
      const windNow = data?.current_weather?.windspeed;
      const codeNow = data?.current_weather?.weathercode;
      const codeNowN = normalizeWeatherCode(codeNow, tempNow);

      const dayMax = Number.isFinite(data?.daily?.temperature_2m_max?.[0]) ? Math.round(data.daily.temperature_2m_max[0]) : NaN;
      const dayMin = Number.isFinite(data?.daily?.temperature_2m_min?.[0]) ? Math.round(data.daily.temperature_2m_min[0]) : NaN;
const isNightNow = (sunToday && Number.isFinite(sunToday.sunriseLocalMs) && Number.isFinite(sunToday.sunsetLocalMs))
  ? isNightBySun(nowLocalMs, sunToday.sunriseLocalMs, sunToday.sunsetLocalMs)
  : false;

const descText = weatherCodeToTextWithDayNight(codeNowN, isNightNow);
      renderHeader({
        cityName: city.name,
        tempNowInt: Number.isFinite(tempNow) ? Math.round(tempNow) : NaN,descText, 
        codeNow: codeNowN,
        hiInt: dayMax,
        loInt: dayMin
      });

      // snow mode class + engine
      const mode = getSnowModeFromCode(codeNowN);
      applySnowModeClass(page, mode);

      const canvas = ensureSnowCanvas();
      if (!wxSnowBg) wxSnowBg = new SnowBackground({ canvas, mode });
      else wxSnowBg.setMode(mode);

      // hourly
      const hUnix  = data?.hourly?.time || [];
      const hTemps = data?.hourly?.temperature_2m || [];
      const hCodes = data?.hourly?.weathercode || [];

      if (!hUnix.length){
        setBroadcastText("æ²’æœ‰æŠ“åˆ°æ¯å°æ™‚è³‡æ–™");
        return;
      }

      const nowFloorLocal = floorToHourLocal(nowLocalMs);

      let startIdx = 0;
      for (let i=0;i<hUnix.length;i++){
        const ms = localMsFromUnix(hUnix[i], offsetSec);
        if (ms >= nowFloorLocal){ startIdx = i; break; }
      }

      const sliceUnix  = hUnix.slice(startIdx, startIdx+24);
      const sliceTemps = hTemps.slice(startIdx, startIdx+24);
      const sliceCodes = hCodes.slice(startIdx, startIdx+24);

      // broadcast final (no flicker)
      const finalText = buildSmartBroadcast({
        tempNow, windNow, codeNowN, dayMin, dayMax,
        sliceUnix, sliceTemps, sliceCodes, offsetSec
      });
      setBroadcastText(finalText);

      renderHourly24({
        hourlyUnix: sliceUnix,
        temps: sliceTemps,
        codes: sliceCodes,
        offsetSec,
        sunByDate,
        nowLocalMs,
        current: {
          temp: Number.isFinite(tempNow) ? Math.round(tempNow) : NaN,
          code: codeNowN
        }
      });

      renderWeek({ daily: data?.daily, nowLocalMs, offsetSec });

    }catch(err){
      console.error(err);
      setBroadcastText("å¤©æ°£è¼‰å…¥å¤±æ•—ï¼ˆè«‹çœ‹ consoleï¼‰");
      setBgClass(page, "bg-day");
      saveBgCache(cityKey(WX_CITIES[wxCityIndex]), { phase: "day" });
    }
  }
  window.loadAndRenderWeather = loadAndRenderWeather;

  /* =========================================================
     Enter / Leave
  ========================================================= */
  function showWeatherLoading(){
    const page = $("weather-page");
    if (!page) return;

    // clean old bg
    page.classList.remove("bg-sunrise","bg-day","bg-sunset","bg-night");

    // use cached phase for this city if available
    const city = WX_CITIES[wxCityIndex];
    const cache = loadBgCache(cityKey(city));
    const phase = cache?.phase || "day";
    setBgClass(page, `bg-${phase}`);

    // hide content via CSS if you have:
    // #weather-page.is-loading #wxBody {display:none} etc.
    page.classList.add("is-loading");

    // only show loading text (broadcast area)
    setBroadcastText("è¼‰å…¥ä¸­â€¦");
    const hourly = $("wxHourly"); if (hourly) hourly.innerHTML = "";
    const week   = $("wxWeek");   if (week) week.innerHTML = "";
    const cityEl = $("wxCity");   if (cityEl) cityEl.textContent = "";
    const tempEl = $("wxTemp");   if (tempEl) tempEl.textContent = "";
    const descEl = $("wxDesc");   if (descEl) descEl.textContent = "";
    const hiloEl = $("wxHiLo");   if (hiloEl) hiloEl.textContent = "";
  }

  function WX_EnterWeatherPage(){
    initWeatherPageOnce();

    // âœ… Enter: show loading immediately (no stale UI)
    showWeatherLoading();

    renderDots();
    setDotsActive();
    resetWeatherPageScroll();

    loadAndRenderWeather().finally(()=>{
      const page = $("weather-page");
      if (page) page.classList.remove("is-loading");
    });
  }
  window.WX_EnterWeatherPage = WX_EnterWeatherPage;

  // auto disable snow if weather-page hidden (works even if showPage doesn't call leave)
  const _observer = new MutationObserver(()=>{
    const page = $("weather-page");
    if (!page) return;
    const showing = (page.style.display !== "none") && page.classList.contains("page-active");
    if (showing) {
      if (!wxSnowEnabled) enableSnow();
    } else {
      if (wxSnowEnabled) disableSnow();
    }
  });
  _observer.observe(document.body, { attributes:true, subtree:true, attributeFilter:["class","style"] });

  /* =========================================================
     Init triggers
  ========================================================= */
  // Optional: bottom nav trigger
  document.addEventListener("click",(e)=>{
    const btn = e.target.closest('.bottom-nav button[data-page="weather-page"]');
    if (!btn) return;
    WX_EnterWeatherPage();
  });

  /* Debug */
  window.WX_DEBUG = window.WX_DEBUG || {};
  window.WX_DEBUG.city = (i)=>switchCity(i);
  window.WX_DEBUG.forceBg = function(name){
    const page = $("weather-page");
    if (!page) return;
    setBgClass(page, `bg-${name}`);
    saveBgCache(cityKey(WX_CITIES[wxCityIndex]), { phase: name });
  };

})();
</script>






<script>
/* =========================================================
   Shopping â€“ FINAL (Google Sheet Sync via Apps Script JSONP)
   - Works for iOS "Add to Home Screen" (PWA-like)
   - Save shows toast immediately, then verifies by pulling cloud
   - Cloud write: POST (no-cors) x-www-form-urlencoded
   - Cloud read: JSONP GET (+ cache-bust)
   - Swipe: left delete (confirm) / right bought (confirm) / bought left to undo
   - Bought state: adds .is-bought (your CSS can set opacity: .35)
   - Long press image: preview
   - Tap image: replace image
   - Price: displays "Â¥ 1,234", edit as number
========================================================= */
(function () {
  "use strict";

  /* =========================
     Config
  ========================= */
  const SYNC_API_URL =
    "https://script.google.com/macros/s/AKfycbzDuRFhkB4biAjMNiSho_zzdL6WDN0fEn8MWINPCwCh7hpsvL1u8KG7geHMIr-KYew/exec";

  const SHOP_ROOT_ID = "shoppingRoot";
  const CURRENCY = "Â¥";

  // Local storage keys
  const LS_ITEMS  = "shop_items_local_v1";
  const LS_CODE   = "shop_sync_code_v1";
  const LS_CLIENT = "shop_client_id_v1";

  // UI/behavior
  const SHOW_CODE_IN_INPUT = true;
  const SAVE_DEBOUNCE = 350;
  const POLL_MS = 3500;

  // Swipe tuning
  const SWIPE_COMMIT = 95;   // px threshold to commit action
  const SWIPE_LIMIT  = 220;  // max translateX

  // Long press
  const LONGPRESS_MS = 450;

  // Verify saving by pulling cloud
  const VERIFY_MS = 6500;
  const VERIFY_STEP = 650;

  /* =========================
     State
  ========================= */
  let rootEl = null;
  let pollTimer = null;
  let persistTimer = null;

  let pendingReplaceId = null;
  let lastCloudUpdatedAt = 0;

  // one stable client id
  const clientId =
    localStorage.getItem(LS_CLIENT) ||
    (String(Date.now()) + "-" + Math.random().toString(16).slice(2));
  localStorage.setItem(LS_CLIENT, clientId);

  /* =========================
     Public entry
  ========================= */
  window.Shop_EnterShoppingPage = function () {
    rootEl = document.getElementById(SHOP_ROOT_ID);
    if (!rootEl) return;

    mountUI();
    bindEventsOnce();

    // show local first
    render(loadLocal());

    // auto apply saved code (iOS home screen often needs double pull)
    const code = getCode();
    if (code) {
      if (SHOW_CODE_IN_INPUT) {
        const el = document.getElementById("shopSyncCode");
        if (el) el.value = code;
      }
      applyCode(code, true);
      setTimeout(() => applyCode(code, true), 900);
    }
  };

  /* =========================
     UI Mount
  ========================= */
  function mountUI() {
    rootEl.innerHTML = `
      <div class="shopping-page-wrap">
        <label class="shop-upload-btn">
          åŠ å…¥è³¼ç‰©å“é …
          <input id="shopFileInput" type="file" accept="image/*" multiple hidden>
        </label>

       

        <div id="shopStatus" style="margin-top:6px;font-size:12px; min-height: 18px; opacity:0;"></div>

        <div id="shopTotalTop" class="shop-total" style="margin-top:10px;"></div>
        <div id="shopList" class="shop-list" style="margin-top:12px;"></div>

        <input id="shopReplaceInput" type="file" accept="image/*" hidden>

        <div id="shopPreview" style="
          position: fixed; inset: 0; z-index: 9999;
          display:none; align-items:center; justify-content:center;
          background: rgba(0,0,0,.65);
          box-sizing: border-box;
          padding-top: calc(var(--topbar-h) + env(safe-area-inset-top) + 8px);
          padding-bottom: calc(var(--bottom-nav-h) + env(safe-area-inset-bottom) + 12px);
          padding-left: 10px;
          padding-right: 10px;
        ">
          <img id="shopPreviewImg" src="" style="
            max-width: 92vw; max-height: 88vh;
            border-radius: 14px;
            box-shadow: 0 12px 40px rgba(0,0,0,.35);
            background: #fff;
          ">
        </div>
      </div>
    `;
  }

  function toast(msg, ms = 1400, isErr = false) {
    const el = document.getElementById("shopStatus");
    if (!el) return;
    el.textContent = msg;
    el.style.color = isErr ? "#d44" : "#2f7a3e";
    el.style.opacity = "1";
    clearTimeout(el.__t);
    el.__t = setTimeout(() => {
      el.textContent = "";
      el.style.opacity = "0";
    }, ms);
  }

  /* =========================
     Code + Sync entry
  ========================= */
  function getCode() { return (localStorage.getItem(LS_CODE) || "").trim(); }
  function setCode(code) { localStorage.setItem(LS_CODE, (code || "").trim()); }

  async function applyCode(code, silentApply) {
    code = (code || "").trim();
    setCode(code);

    stopPolling();

    if (!code) {
      render(loadLocal());
      return;
    }

    // quick show local
    render(loadLocal());

    // pull cloud once
    await pullCloudOnce(code);

    // start polling
    startPolling(code);

    // user clicked save
    if (!silentApply) {
      // âœ… make sure latest typed content is included
      const itemsNow = syncDomToLocalItems();

      // show feedback immediately
      toast("å„²å­˜ä¸­â€¦", 900, false);

      const sentAt = await cloudSaveNoCors(code, itemsNow);
      if (!sentAt) {
        toast("âš ï¸ æœªå¯«å…¥ï¼Œè«‹é‡è©¦", 1600, true);
        return;
      }

      // verify by reading back (JSONP)
      const ok = await verifySaved(code, sentAt);
      if (ok) toast("âœ… å·²å®Œæˆå‚™ä»½", 1400, false);
      else toast("âš ï¸ æœªå¯«å…¥ï¼Œè«‹å†æŒ‰ä¸€æ¬¡", 1700, true);
    }
  }

  /* =========================
     Cloud: JSONP GET (read)
  ========================= */
  function cloudLoadJSONP(code) {
    return new Promise((resolve) => {
      const cb = "__shop_jsonp_cb_" + Date.now() + "_" + Math.random().toString(16).slice(2);
      const timeout = setTimeout(() => cleanup(null), 9000);

      function cleanup(result) {
        clearTimeout(timeout);
        try { delete window[cb]; } catch {}
        if (script && script.parentNode) script.parentNode.removeChild(script);
        resolve(result);
      }

      window[cb] = function (data) { cleanup(data); };

      const script = document.createElement("script");
      script.async = true;

      // cache-bust is critical for iOS home screen mode
      script.src = `${SYNC_API_URL}?code=${encodeURIComponent(code)}&callback=${encodeURIComponent(cb)}&_=${Date.now()}`;
      script.onerror = () => cleanup(null);

      document.head.appendChild(script);
    });
  }

  async function pullCloudOnce(code) {
    const cloud = await cloudLoadJSONP(code);
    if (cloud && cloud.ok && !cloud.empty) {
      const u = Number(cloud.updatedAt || 0) || 0;
      if (u > (lastCloudUpdatedAt || 0)) lastCloudUpdatedAt = u;

      const items = safeParseItems(cloud.payload);
      saveLocal(items);
      if (!isTypingInside()) render(items);
      return true;
    }
    return false;
  }

  /* =========================
     Cloud: POST (write) â€“ no-cors form
  ========================= */
  async function cloudSaveNoCors(code, items) {
    const sentAt = Date.now();
    const payload = JSON.stringify(items || []);

    // Apps Script loves urlencoded
    const body = new URLSearchParams({
      code,
      payload,
      updatedAt: String(sentAt),
      updatedBy: clientId
    }).toString();

    try {
      await fetch(SYNC_API_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
        body
      });
      // optimistic: request sent
      lastCloudUpdatedAt = Math.max(lastCloudUpdatedAt, sentAt);
      return sentAt;
    } catch (e) {
      return 0;
    }
  }

  async function verifySaved(code, sentAt) {
    const deadline = Date.now() + VERIFY_MS;

    while (Date.now() < deadline) {
      const cloud = await cloudLoadJSONP(code);
      if (cloud && cloud.ok && !cloud.empty) {
        const u = Number(cloud.updatedAt || 0) || 0;
        if (u >= sentAt) {
          lastCloudUpdatedAt = u;
          const items = safeParseItems(cloud.payload);
          saveLocal(items);
          if (!isTypingInside()) render(items);
          return true;
        }
      }
      await sleep(VERIFY_STEP);
    }
    return false;
  }

  /* =========================
     Polling: keep devices in sync
  ========================= */
  function startPolling(code) {
    stopPolling();

    pollTimer = setInterval(async () => {
      const activeCode = getCode();
      if (!activeCode || activeCode !== code) return;
      if (isTypingInside()) return;

      const cloud = await cloudLoadJSONP(code);
      if (!cloud || !cloud.ok || cloud.empty) return;

      const u = Number(cloud.updatedAt || 0) || 0;
      if (u > (lastCloudUpdatedAt || 0)) {
        lastCloudUpdatedAt = u;
        const items = safeParseItems(cloud.payload);
        saveLocal(items);
        render(items);
      }
    }, POLL_MS);

    // foreground refresh (iOS home screen)
    document.addEventListener("visibilitychange", onVis, { passive:true });
    function onVis() {
      if (!document.hidden) {
        setTimeout(() => {
          const activeCode = getCode();
          if (!activeCode || activeCode !== code) return;
          if (isTypingInside()) return;
          pullCloudOnce(code);
        }, 350);
      }
    }
    rootEl.__shopVisHandler = onVis;
  }

  function stopPolling() {
    if (pollTimer) { clearInterval(pollTimer); pollTimer = null; }
    if (rootEl && rootEl.__shopVisHandler) {
      document.removeEventListener("visibilitychange", rootEl.__shopVisHandler);
      rootEl.__shopVisHandler = null;
    }
  }

  function isTypingInside() {
    const ae = document.activeElement;
    return !!(ae && ae.classList && ae.classList.contains("shop-input") && rootEl.contains(ae));
  }

  /* =========================
     Local storage helpers
  ========================= */
  function loadLocal() {
    try { return JSON.parse(localStorage.getItem(LS_ITEMS) || "[]"); }
    catch { return []; }
  }

  function saveLocal(items) {
    localStorage.setItem(LS_ITEMS, JSON.stringify(items || []));
  }

  // keep local + total; also auto background save (debounced) when code exists
  function persist(items) {
    saveLocal(items);
    updateTotal(items);

    const code = getCode();
    if (!code) return;

    if (persistTimer) clearTimeout(persistTimer);
    persistTimer = setTimeout(() => {
      persistTimer = null;
      cloudSaveNoCors(code, items); // silent
    }, SAVE_DEBOUNCE);
  }

  // âœ… IMPORTANT: "Save" must include the last typed characters
  function syncDomToLocalItems() {
    const items = loadLocal();
    const list = document.getElementById("shopList");
    if (!list) return items;

    list.querySelectorAll(".shop-card[data-id]").forEach(card => {
      const id = card.dataset.id;
      const it = items.find(x => x.id === id);
      if (!it) return;

      const nameEl = card.querySelector('input[data-k="name"]');
      const locEl  = card.querySelector('input[data-k="location"]');
      const priceEl= card.querySelector('input[data-k="price"]');

      if (nameEl) it.name = nameEl.value;
      if (locEl)  it.location = locEl.value;
      if (priceEl) it.price = toNumber(priceEl.value);
    });

    saveLocal(items);
    return items;
  }

  /* =========================
     Render
  ========================= */
  function render(items) {
    const list = document.getElementById("shopList");
    items = Array.isArray(items) ? items : [];
    updateTotal(items);

    if (!items.length) {
      list.innerHTML = `<div class="shop-empty">æ‚¨çš„è³¼ç‰©æ¸…å–®å°šæœªæœ‰å“é …</div>`;
      return;
    }

    list.innerHTML = items.map(it => {
      const boughtClass = it.bought ? "is-bought" : "";
      return `
        <div class="shop-swipe" data-id="${it.id}">
          <div class="shop-swipe-bg"></div>
          <div class="shop-swipe-fg">
            <div class="shop-card ${boughtClass}" data-id="${it.id}">
              <img class="shop-thumb" src="${it.image || ""}" alt="">
              <div class="shop-fields">
                <div class="shop-field">
                  <span class="shop-icon icon-location-shopping"></span>
                  <input class="shop-input" data-k="name" placeholder="å“é …åç¨±" value="${esc(it.name)}">
                </div>
                <div class="shop-row">
                  <div class="shop-field shop-field-location">
                    <span class="shop-icon icon-location"></span>
                    <input class="shop-input" data-k="location" placeholder="è²©å”®é€šè·¯" value="${esc(it.location)}">
                  </div>
                  <div class="shop-field shop-field-price">
                    <input class="shop-input shop-price" data-k="price" placeholder="å”®åƒ¹" inputmode="decimal" value="${fmtMoney(it.price)}">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>`;
    }).join("");
  }

  function updateTotal(items) {
    const total = (items || []).reduce((s, it) => s + toNumber(it.price), 0);
    const t = document.getElementById("shopTotalTop");
    if (t) t.textContent = `åˆè¨ˆï¼š${CURRENCY} ${total.toLocaleString()}`;
  }

  /* =========================
     Events (delegate)
  ========================= */
  function bindEventsOnce() {
    if (rootEl.__shopBound) return;
    rootEl.__shopBound = true;

    const codeInput  = () => document.getElementById("shopSyncCode");
    const replaceInp = () => document.getElementById("shopReplaceInput");
    const preview    = () => document.getElementById("shopPreview");
    const previewImg = () => document.getElementById("shopPreviewImg");

    // Save click
    rootEl.addEventListener("click", (e) => {
      if (e.target && e.target.id === "shopSyncApply") {
        applyCode(codeInput().value, false);
      }
    });

    // Save by Enter
    rootEl.addEventListener("keydown", (e) => {
      if (e.target && e.target.id === "shopSyncCode" && e.key === "Enter") {
        e.preventDefault();
        applyCode(codeInput().value, false);
      }
    });

    // Add items by images
    rootEl.addEventListener("change", async (e) => {
      if (!e.target || e.target.id !== "shopFileInput") return;
      const files = Array.from(e.target.files || []);
      if (!files.length) return;

      const items = loadLocal();
      for (const f of files) {
        const img = await fileToDataURL(f);
        // new items append at bottom (top->down order)
        items.push({ id: uid(), image: img, name: "", location: "", price: 0, bought: false });
      }
      persist(items);
      render(items);
      e.target.value = "";
    });

    // Replace image picked
    rootEl.addEventListener("change", async (e) => {
      if (!e.target || e.target.id !== "shopReplaceInput") return;
      const file = e.target.files && e.target.files[0];
      if (!file || !pendingReplaceId) return;

      const items = loadLocal();
      const it = items.find(x => x.id === pendingReplaceId);
      if (!it) return;

      it.image = await fileToDataURL(file);
      persist(items);

      const imgEl = rootEl.querySelector(`.shop-card[data-id="${pendingReplaceId}"] .shop-thumb`);
      if (imgEl) imgEl.src = it.image;

      pendingReplaceId = null;
      e.target.value = "";
    });

    // Input edit
    rootEl.addEventListener("input", (e) => {
      const el = e.target;
      if (!el || !el.classList || !el.classList.contains("shop-input")) return;

      const card = el.closest(".shop-card");
      if (!card) return;

      const id = card.dataset.id;
      const key = el.dataset.k;
      if (!id || !key) return;

      const items = loadLocal();
      const it = items.find(x => x.id === id);
      if (!it) return;

      if (key === "price") it.price = toNumber(el.value);
      else it[key] = el.value;

      persist(items);
    });

    // Price edit mode
    rootEl.addEventListener("focusin", (e) => {
      const el = e.target;
      if (!el || !el.classList || !el.classList.contains("shop-price")) return;
      const n = toNumber(el.value);
      el.value = n ? String(n) : "";
    });

    // Price format on blur
    rootEl.addEventListener("focusout", (e) => {
      const el = e.target;
      if (!el || !el.classList || !el.classList.contains("shop-price")) return;

      const card = el.closest(".shop-card");
      if (!card) return;

      const id = card.dataset.id;
      const items = loadLocal();
      const it = items.find(x => x.id === id);
      if (!it) return;

      it.price = toNumber(el.value);
      persist(items);
      el.value = fmtMoney(it.price);
    });

    // Close preview
    rootEl.addEventListener("click", (e) => {
      if (e.target && e.target.id === "shopPreview") {
        preview().style.display = "none";
        previewImg().src = "";
      }
    });

    // Block iOS context menu on images
    rootEl.addEventListener("contextmenu", (e) => {
      if (e.target.closest(".shop-thumb")) e.preventDefault();
    });

    // Long press preview (touch)
    let lpTimer = null, lpTriggered = false, lpStartX = 0, lpStartY = 0;
    function clearLP(){ if (lpTimer) clearTimeout(lpTimer); lpTimer = null; }

    rootEl.addEventListener("touchstart", (e) => {
      const img = e.target.closest(".shop-thumb");
      if (!img) return;

      lpTriggered = false;
      const t = e.touches[0];
      lpStartX = t.clientX; lpStartY = t.clientY;

      clearLP();
      lpTimer = setTimeout(() => {
        lpTriggered = true;
        previewImg().src = img.src;
        preview().style.display = "flex";
      }, LONGPRESS_MS);
    }, { passive:true });

    rootEl.addEventListener("touchmove", (e) => {
      if (!lpTimer) return;
      const t = e.touches[0];
      if (Math.abs(t.clientX - lpStartX) > 10 || Math.abs(t.clientY - lpStartY) > 10) clearLP();
    }, { passive:true });

    rootEl.addEventListener("touchend", clearLP, { passive:true });
    rootEl.addEventListener("touchcancel", clearLP, { passive:true });

    // Block replace click after longpress
    rootEl.addEventListener("click", (e) => {
      const img = e.target.closest(".shop-thumb");
      if (!img) return;
      if (lpTriggered) {
        e.preventDefault(); e.stopPropagation();
        lpTriggered = false;
      }
    }, true);

    // Tap image => replace
    rootEl.addEventListener("click", (e) => {
      const img = e.target.closest(".shop-thumb");
      if (!img) return;
      const card = img.closest(".shop-card");
      if (!card) return;

      pendingReplaceId = card.dataset.id;
      const inp = replaceInp();
      inp.value = "";
      inp.click();
    });

    // Swipe
    setupSwipeDelegate();
  }

  /* =========================
     Swipe delegate
  ========================= */
  function setupSwipeDelegate() {
    if (rootEl.__swipeDelegate) return;
    rootEl.__swipeDelegate = true;

    let activeWrap = null;
    let activeFg = null;

    let dragging = false;
    let startX = 0, startY = 0;
    let currentX = 0;
    let lockedAxis = null;

    function resetActive(animate = true) {
      if (!activeFg) return;
      activeFg.style.transition = animate ? "transform 180ms ease" : "none";
      activeFg.style.transform = "translateX(0px)";
      if (activeWrap) activeWrap.classList.remove("is-armed");
      activeWrap = activeFg = null;
      dragging = false;
      lockedAxis = null;
      currentX = 0;
    }

    function findWrap(target) {
      const wrap = target.closest(".shop-swipe");
      if (!wrap) return null;
      const fg = wrap.querySelector(".shop-swipe-fg");
      if (!fg) return null;
      return { wrap, fg };
    }

    function onStart(x, y, target) {
      resetActive(true);

      const found = findWrap(target);
      if (!found) return;

      activeWrap = found.wrap;
      activeFg = found.fg;

      dragging = true;
      startX = x; startY = y;
      currentX = 0;
      lockedAxis = null;

      activeFg.style.transition = "none";
    }

    function onMove(x, y, ev) {
      if (!dragging || !activeFg) return;

      const dx = x - startX;
      const dy = y - startY;

      if (!lockedAxis) {
        const adx = Math.abs(dx), ady = Math.abs(dy);
        if (adx > 6 && adx > ady * 0.75) lockedAxis = "x";
        else if (ady > 10 && ady > adx * 1.2) lockedAxis = "y";
        else return;
      }
      if (lockedAxis !== "x") return;

      // allow swipe even if user started on input: blur active element
      const ae = document.activeElement;
      if (ae && (ae.tagName === "INPUT" || ae.tagName === "TEXTAREA")) ae.blur();

      ev.preventDefault();

      currentX = clamp(dx, -SWIPE_LIMIT, SWIPE_LIMIT);
      activeFg.style.transform = `translateX(${currentX}px)`;

      if (Math.abs(currentX) > 90) activeWrap.classList.add("is-armed");
      else activeWrap.classList.remove("is-armed");
    }

    function onEnd() {
      if (!dragging || !activeWrap) return;

      const id = activeWrap.dataset.id;
      const items = loadLocal();
      const it = items.find(x => x.id === id);

      // reset position
      activeFg.style.transition = "transform 180ms ease";
      activeFg.style.transform = "translateX(0px)";
      activeWrap.classList.remove("is-armed");

      const x = currentX;
      resetActive(false);

      if (!it) return;

      // LEFT: delete or undo bought
      if (x <= -SWIPE_COMMIT) {
        if (it.bought) {
          const ok = confirm("æ˜¯å¦å–æ¶ˆå·²å®Œæˆç‹€æ…‹ï¼Ÿ");
          if (!ok) return;
          it.bought = false;
          persist(items);

          const card = rootEl.querySelector(`.shop-card[data-id="${id}"]`);
          if (card) card.classList.remove("is-bought");
        } else {
          const ok = confirm("æ˜¯å¦ç§»é™¤é€™å€‹å“é …ï¼Ÿ");
          if (!ok) return;

          const idx = items.findIndex(x => x.id === id);
          if (idx >= 0) items.splice(idx, 1);

          persist(items);
          render(items);
        }
        return;
      }

      // RIGHT: mark bought
      if (x >= SWIPE_COMMIT) {
        if (!it.bought) {
          const ok = confirm("ç¢ºå®šè²·å°æ±è¥¿é½ï¼Ÿ");
          if (!ok) return;
          it.bought = true;
          persist(items);

          const card = rootEl.querySelector(`.shop-card[data-id="${id}"]`);
          if (card) card.classList.add("is-bought");
        }
      }
    }

    if ("PointerEvent" in window) {
      rootEl.addEventListener("pointerdown", (e) => {
        if (e.pointerType === "mouse" && e.button !== 0) return;
        onStart(e.clientX, e.clientY, e.target);
      });
      rootEl.addEventListener("pointermove", (e) => onMove(e.clientX, e.clientY, e), { passive:false });
      rootEl.addEventListener("pointerup", onEnd);
      rootEl.addEventListener("pointercancel", () => resetActive(true));
    } else {
      rootEl.addEventListener("touchstart", (e) => {
        const t = e.touches[0];
        onStart(t.clientX, t.clientY, e.target);
      }, { passive:true });

      rootEl.addEventListener("touchmove", (e) => {
        const t = e.touches[0];
        onMove(t.clientX, t.clientY, e);
      }, { passive:false });

      rootEl.addEventListener("touchend", onEnd, { passive:true });
      rootEl.addEventListener("touchcancel", () => resetActive(true), { passive:true });
    }
  }

  /* =========================
     Utilities
  ========================= */
  function uid() {
    return (crypto && crypto.randomUUID) ? crypto.randomUUID() : String(Date.now() + Math.random());
  }

  function clamp(n, a, b) {
    return Math.max(a, Math.min(b, n));
  }

  function toNumber(v) {
    const n = Number(String(v ?? "").replace(/[^\d.-]/g, ""));
    return Number.isFinite(n) ? n : 0;
  }

  function fmtMoney(v) {
    const n = toNumber(v);
    return n ? `${CURRENCY} ${n.toLocaleString()}` : "";
  }

  function esc(s) {
    return String(s ?? "")
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;")
      .replaceAll('"',"&quot;");
  }

  function fileToDataURL(file) {
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(String(r.result));
      r.onerror = rej;
      r.readAsDataURL(file);
    });
  }

  function safeParseItems(payload) {
    try {
      const arr = JSON.parse(payload || "[]");
      return Array.isArray(arr) ? arr : [];
    } catch {
      return [];
    }
  }

  function sleep(ms) { return new Promise(r => setTimeout(r, ms)); }

})();
</script>



	<script>
  function syncBarsHeight(){
    const topbar = document.getElementById("topbar");
    const bottom = document.querySelector(".bottom-nav");

    const topH = topbar ? topbar.getBoundingClientRect().height : 0;
    const botH = bottom ? bottom.getBoundingClientRect().height : 0;

    document.documentElement.style.setProperty("--topbar-h", `${topH}px`);
    document.documentElement.style.setProperty("--bottom-nav-h", `${botH}px`);
  }

  // â­ ä¸ç”¨ DOMContentLoadedï¼Œå› ç‚º script åœ¨ body æœ€å¾Œ
  syncBarsHeight();
  window.addEventListener("resize", syncBarsHeight);

	let wxWeatherInFlight = false;

async function loadAndRenderWeather(){
  if (wxWeatherInFlight) return;          // âœ… é˜²é‡è¤‡
  wxWeatherInFlight = true;
   // âœ… å¦‚æœç›®å‰é¸çš„æ˜¯ã€Œç›®å‰ä½ç½®ã€ï¼Œå…ˆå˜—è©¦æŠ“å®šä½
  if (WX_CITIES[wxCityIndex]?.kind === "geo") {
    try {
      setBroadcastText("æ­£åœ¨å–å¾—ç›®å‰ä½ç½®â€¦");
      const pos = await WX_getCurrentPositionOnce();

      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;

      WX_CITIES[0].lat = lat;
      WX_CITIES[0].lon = lon;

      // ï¼ˆå¯é¸ï¼‰æƒ³é¡¯ç¤ºæ¯”è¼ƒåƒäººé¡çœ‹çš„åœ°åï¼šä¹‹å¾Œå¯åŠ åæŸ¥åœ°å
      // WX_CITIES[0].name = "ç›®å‰ä½ç½®";

    } catch (e) {
      console.warn("å®šä½å¤±æ•—/è¢«æ‹’çµ•ï¼Œæ”¹ç”¨æœ­å¹Œ", e);
      wxCityIndex = 1; // fallbackï¼šæœ­å¹Œ
    }
  }
  const isDay = data?.current_weather?.is_day; // 0 / 1

// âœ… å…ˆæ±ºå®šã€Œæ—¥ or å¤œã€ï¼ˆæœ€é‡è¦ã€æœ€ç©©ï¼‰
if (isDay === 0) {
  setBgClass(page, "bg-night");
} else {
  setBgClass(page, "bg-day");
}

// âœ… åªæœ‰åœ¨æ—¥å‡º / æ—¥è½æ™‚é–“é™„è¿‘ï¼Œæ‰ç”¨ phase è¦†è“‹
if (
  isDay === 1 &&                      // ç™½å¤©æ‰éœ€è¦æ—¥å‡º/æ—¥è½éæ¸¡
  Number.isFinite(sunriseMs) &&
  Number.isFinite(sunsetMs)
) {
  const phase = getDayPhase(nowMs, sunriseMs, sunsetMs, 45);

  if (phase === "sunrise" || phase === "sunset") {
    setBgClass(page, `bg-${phase}`);
  }
}

  const page = $("weather-page");
  const city = WX_CITIES[wxCityIndex];
  if (!page || !city) { wxWeatherInFlight = false; return; }



  try{
    const data = await fetch(buildWeatherApiUrl(city)).then(r=>r.json());
    const offsetSec = Number(data?.utc_offset_seconds ?? 0);
    const nowLocalMs = Date.now() + offsetSec*1000;

    const sunByDate = buildSunByDate(data?.daily, offsetSec);
    const todayKey = localDateKey(nowLocalMs);
    const sunToday = sunByDate.get(todayKey) || Array.from(sunByDate.values())[0];

    if (sunToday){
      const phase = getDayPhase(nowLocalMs, sunToday.sunriseLocalMs, sunToday.sunsetLocalMs, 45);
      setBgClass(page, `bg-${phase}`);
    }

    const tempNow = data?.current_weather?.temperature;
    const windNow = data?.current_weather?.windspeed;
    const codeNow = data?.current_weather?.weathercode;
    const codeNowN = normalizeWeatherCode(codeNow, tempNow);

    const dayMax = Number.isFinite(data?.daily?.temperature_2m_max?.[0]) ? Math.round(data.daily.temperature_2m_max[0]) : NaN;
    const dayMin = Number.isFinite(data?.daily?.temperature_2m_min?.[0]) ? Math.round(data.daily.temperature_2m_min[0]) : NaN;

    renderHeader({
      cityName: city.name,
      tempNowInt: Number.isFinite(tempNow) ? Math.round(tempNow) : NaN,
  descText,
      codeNow: codeNowN,
      hiInt: dayMax,
      loInt: dayMin
    });

    // snow canvas + mode
    const mode = getSnowModeFromCode(codeNowN);
    applySnowModeClass(page, mode);

    const canvas = ensureSnowCanvas();
    if (!wxSnowBg) wxSnowBg = new SnowBackground({ canvas, mode });
    else wxSnowBg.setMode(mode);

    // hourly slice from now-hour
    const hUnix  = data?.hourly?.time || [];
    const hTemps = data?.hourly?.temperature_2m || [];
    const hCodes = data?.hourly?.weathercode || [];

    if (!hUnix.length){
      setBroadcastText("æ²’æœ‰æŠ“åˆ°æ¯å°æ™‚è³‡æ–™");
      wxWeatherInFlight = false;
      return;
    }

    const nowFloorLocal = floorToHourLocal(nowLocalMs);

    let startIdx = 0;
    for (let i=0;i<hUnix.length;i++){
      const ms = localMsFromUnix(hUnix[i], offsetSec);
      if (ms >= nowFloorLocal){ startIdx = i; break; }
    }

    const sliceUnix  = hUnix.slice(startIdx, startIdx+24);
    const sliceTemps = hTemps.slice(startIdx, startIdx+24);
    const sliceCodes = hCodes.slice(startIdx, startIdx+24);

   // âœ… é€™è£¡åªæ›´æ–°ä¸€æ¬¡ finalï¼ˆä¸å†åšå…¶ä»–ä¸­é–“å¥ï¼‰
let finalText = buildSmartBroadcast({
  tempNow,
  windNow,
  codeNowN,
  dayMin,
  dayMax,
  sliceUnix,
  sliceTemps,
  sliceCodes,
  offsetSec
});

/* =========================
   âœ… å¤œé–“æ¨¡å¼æ’­å ±ï¼šæ™šä¸Š/æ·±å¤œä¸è¦å‡ºç¾ã€Œæ—©ä¸Š/ä¸‹åˆã€
   è¦å‰‡ï¼š
   - è‹¥ç¾åœ¨æ˜¯ã€Œæ™šä¸Š/æ·±å¤œã€â†’ åªä¿ç•™å«ã€Œä»Šæ™š/æ™šä¸Š/æ·±å¤œã€çš„å¥å­
   - è‹¥å…§å®¹é‚„æ˜¯å«ã€Œæ—©ä¸Š/ä¸‹åˆã€â†’ ç›´æ¥æ”¹æˆå¤œé–“æç¤ºå¥ï¼ˆä¸ææ—©ä¸Šä¸‹åˆï¼‰
========================= */
const nowPeriod = getPeriodLabel(nowLocalMs); // æœƒå›å‚³ æ—©ä¸Š/ä¸‹åˆ/æ™šä¸Š/æ·±å¤œ

if (nowPeriod === "æ™šä¸Š" || nowPeriod === "æ·±å¤œ") {
  // 1) å¦‚æœæ˜¯ã€Œè®ŠåŒ–å¥ã€(å«ã€Œä»Šæ—¥æ—©ä¸Š/ä»Šæ—¥ä¸‹åˆã€) å°±æ”¹å¯«æˆå¤œé–“ç‰ˆæœ¬
  if (/ä»Šæ—¥æ—©ä¸Š|ä»Šæ—¥ä¸‹åˆ/.test(finalText)) {
    finalText = finalText
      .replace(/ä»Šæ—¥æ—©ä¸Š/g, "ä»Šæ™š")
      .replace(/ä»Šæ—¥ä¸‹åˆé–‹å§‹/g, "ä»Šæ™šé–‹å§‹")
      .replace(/ä»Šæ—¥ä¸‹åˆ/g, "ä»Šæ™š");
  }

  // 2) å¦‚æœä»ç„¶æåˆ°æ—©ä¸Š/ä¸‹åˆï¼ˆä¾‹å¦‚ tips æˆ–å…¶ä»–ä¾†æºï¼‰ï¼Œå°±æ”¹æˆå¤œé–“å°ˆç”¨æç¤º
  if (/æ—©ä¸Š|ä¸‹åˆ/.test(finalText)) {
    // ä½ å¯ä»¥ä¾éœ€è¦å†åŠ æ›´å¤šå¤œé–“å¥
    if (isSnowCode(codeNowN)) {
      finalText = "ä»Šæ™šåˆ°æ˜æ™¨å¯èƒ½é™é›ªï¼Œè·¯é¢æ˜“çµå†°æˆ–æ¿•æ»‘ï¼Œè¡Œèµ°èˆ‡è¡Œè»Šè«‹æ”¾æ…¢é€Ÿåº¦ä¸¦æ³¨æ„ä¿æš–ã€‚";
    } else if (isRainCode(codeNowN)) {
      finalText = "ä»Šæ™šåˆ°æ˜æ™¨å¯èƒ½é™é›¨ï¼Œå¤–å‡ºè«‹æ”œå¸¶é›¨å…·ä¸¦ç•™æ„è·¯é¢æ¿•æ»‘ã€‚";
    } else if (Number.isFinite(dayMin) && dayMin <= -5) {
      finalText = "ä»Šæ™šåˆ°æ˜æ™¨ä½æº«æ˜é¡¯ï¼Œå¤–å‡ºè«‹ç‰¹åˆ¥æ³¨æ„ä¿æš–ã€‚";
    } else if (Number.isFinite(tempNow) && tempNow <= 0) {
      finalText = "ä»Šæ™šæ°£æº«åä½ï¼Œå»ºè­°åŠ ä»¶å¤–å¥—ä¸¦æ³¨æ„ä¿æš–ã€‚";
    } else {
      finalText = "ä»Šæ™šå¤©æ°£è®ŠåŒ–ä¸å¤§ï¼Œå¤–å‡ºå‰å¯å†ç¢ºèªå³æ™‚å¤©æ°£ã€‚";
    }
  }
}

setBroadcastText(finalText);

renderHourly24({
  hourlyUnix: sliceUnix,
  temps: sliceTemps,
  codes: sliceCodes,
  offsetSec,
  sunByDate,
  nowLocalMs,
  current: {
    temp: Math.round(tempNow),
    code: codeNowN
  }
});

   renderWeek({ daily: data?.daily, nowLocalMs, offsetSec });


  }catch(err){
    console.error(err);
    setBroadcastText("å¤©æ°£è¼‰å…¥å¤±æ•—ï¼ˆè«‹çœ‹ consoleï¼‰");
  }finally{
    wxWeatherInFlight = false;
  }
}

</script>
<script>
	const SHEET_NAME = "Sheet1";

function doGet(e) {
  const code = String((e.parameter && e.parameter.code) || "").trim();
  const cb = String((e.parameter && e.parameter.callback) || "").trim();

  const result = readRow_(code);

  // JSONPï¼šå›å‚³ callback({...});
  if (cb) {
    const js = `${cb}(${JSON.stringify(result)});`;
    return ContentService.createTextOutput(js)
      .setMimeType(ContentService.MimeType.JAVASCRIPT);
  }

  // ä¸€èˆ¬ JSON
  return ContentService.createTextOutput(JSON.stringify(result))
    .setMimeType(ContentService.MimeType.JSON);
}

function doPost(e) {
  const text = (e.postData && e.postData.contents) ? String(e.postData.contents) : "";
  let body = null;
  try { body = JSON.parse(text); } catch (err) {}

  if (!body) {
    return ContentService.createTextOutput(JSON.stringify({ ok:false, error:"bad_json" }))
      .setMimeType(ContentService.MimeType.JSON);
  }

  const code = String(body.code || "").trim();
  const payload = String(body.payload || "");
  const updatedAt = Number(body.updatedAt || Date.now()) || Date.now();

  if (!code) {
    return ContentService.createTextOutput(JSON.stringify({ ok:false, error:"missing_code" }))
      .setMimeType(ContentService.MimeType.JSON);
  }

  upsertRow_(code, payload, updatedAt);

  return ContentService.createTextOutput(JSON.stringify({ ok:true, updatedAt }))
    .setMimeType(ContentService.MimeType.JSON);
}

/* ===== helpers ===== */
function readRow_(code){
  if (!code) return { ok:true, code:"", payload:"", updatedAt:0, empty:true };

  const sh = SpreadsheetApp.getActive().getSheetByName(SHEET_NAME);
  if (!sh) return { ok:false, error:"missing_sheet", sheet:SHEET_NAME };

  const values = sh.getDataRange().getValues();
  for (let i = 1; i < values.length; i++) {
    if (String(values[i][0]).trim() === code) {
      return {
        ok: true,
        code,
        payload: String(values[i][1] || ""),
        updatedAt: Number(values[i][2] || 0) || 0,
        empty: false
      };
    }
  }
  return { ok:true, code, payload:"", updatedAt:0, empty:true };
}

function upsertRow_(code, payload, updatedAt){
  const sh = SpreadsheetApp.getActive().getSheetByName(SHEET_NAME);
  const values = sh.getDataRange().getValues();

  for (let i = 1; i < values.length; i++) {
    if (String(values[i][0]).trim() === code) {
      sh.getRange(i+1, 2).setValue(payload);
      sh.getRange(i+1, 3).setValue(updatedAt);
      return;
    }
  }
  sh.appendRow([code, payload, updatedAt]);
}
function syncDomToLocalItems() {
  const items = loadLocal();
  const list = document.getElementById("shopList");
  if (!list) return items;

  list.querySelectorAll(".shop-card[data-id]").forEach(card => {
    const id = card.dataset.id;
    const it = items.find(x => x.id === id);
    if (!it) return;

    const nameEl = card.querySelector('input[data-k="name"]');
    const locEl  = card.querySelector('input[data-k="location"]');
    const priceEl= card.querySelector('input[data-k="price"]');

    if (nameEl) it.name = nameEl.value;
    if (locEl)  it.location = locEl.value;
    if (priceEl) it.price = toNumber(priceEl.value);
  });
/* =========================
   Local storage helpersï¼ˆè£œé½Šï¼‰
========================= */
function loadLocal(){
  try {
    return JSON.parse(localStorage.getItem("shop_items_local_v1") || "[]");
  } catch {
    return [];
  }
}

function saveLocal(items){
  localStorage.setItem("shop_items_local_v1", JSON.stringify(items || []));
}

  saveLocal(items);
  return items;
	
}

</script>
</body>
</html>
